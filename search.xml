<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[lamp、博客搭建]]></title>
      <url>/2018/02/09/lamp%E3%80%81%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">centos7版本；</span><br><span class="line">1、配置两台虚拟机，仅主机模式；</span><br><span class="line">node1：192.168.170.11</span><br><span class="line">node2：192.168.170.12</span><br><span class="line">2、关闭防火墙及selinux；</span><br><span class="line">3、安装服务；</span><br><span class="line">node1：yum install mariadb-server</span><br><span class="line">node2: yum install httpd php mariadb php-mysql</span><br><span class="line">4、网络下载PHPMyAdmin,注意版本兼容，4.4版本；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">启动服务；</span><br><span class="line">getenforce---查看SElinux状态；</span><br><span class="line">setenforce 0 ---将selinux改为permissive</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">node1：</span><br><span class="line">systemctl start mariadb</span><br><span class="line">node2:</span><br><span class="line">systemctl start  httpd</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">创建root用户密码及权限；</span><br><span class="line">node1:</span><br><span class="line">mysql_secure_installation</span><br><span class="line">enter current password for root (inter for none): ---输入口令，空口令；</span><br><span class="line">set root password? 【y/n】y---设置口令；</span><br><span class="line">new password;</span><br><span class="line">re-enter new password;</span><br><span class="line">remove anonymous user?【y/n】y---删除匿名账户；</span><br><span class="line">disallow root login remotely?【y/n】n---不禁用远程登入；</span><br><span class="line">remove test database and access to  it ?【y/n】n---是否测试数据库；</span><br><span class="line">relaod privilage table now?【y/n】y 刷新用户特权；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">登入mysql并创建用户密码；</span><br><span class="line">mysql -uroot -p111111</span><br><span class="line">show databases;</span><br><span class="line">select host,user,password,garant_priv,super_priv from mysql.user;---查看用户及密码，主机相关信息；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node2；</span><br><span class="line">mysql -uroot -h192.168.170.11 -p111111</span><br><span class="line">grant all on *.* to bai@&quot;192.168.%.%&quot; identified by &quot;111111&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">从网上下载phpmyadmin;</span><br><span class="line">上传并解压到/root下，将解压文件移动到、/var/www/html/目录下改名为pma</span><br><span class="line">mv phpmyadmin /var/www/html/pma</span><br><span class="line">更改配置文件；</span><br><span class="line">cp config.sample.inc.php config.inc.php</span><br><span class="line">vim config.inc.php</span><br><span class="line"></span><br><span class="line">$cfg[&apos;blowfish_secret&apos;] = &apos;A35FqCYIW6ktF8Jz1XGIBNhiNaBJjmi&apos;;</span><br><span class="line">/* YOU MUST FILL IN THIS FOR COOKIE AUTH! */---生成随机密码添加</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Servers configuration</span><br><span class="line"> */</span><br><span class="line">$i = 0;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * First server</span><br><span class="line"> */</span><br><span class="line">$i++;</span><br><span class="line">/* Authentication type */</span><br><span class="line">$cfg[&apos;Servers&apos;][$i][&apos;auth_type&apos;] = &apos;cookie&apos;;</span><br><span class="line">/* Server parameters */</span><br><span class="line">$cfg[&apos;Servers&apos;][$i][&apos;host&apos;] = &apos;192.168.170.11&apos;;---添加所连接的ip地址；</span><br><span class="line">$cfg[&apos;Servers&apos;][$i][&apos;connect_type&apos;] = &apos;tcp&apos;;</span><br><span class="line">$cfg[&apos;Servers&apos;][$i][&apos;compress&apos;] = false;</span><br><span class="line">$cfg[&apos;Servers&apos;][$i][&apos;AllowNoPassword&apos;] = false;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">生成随机密码；openssl rand -base64 21</span><br><span class="line">需要下载一个mbstring扩展包；</span><br><span class="line">yum install php-mbstring</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">查询用户权限管理；</span><br><span class="line">mysql -uroot -h192.168.170.11 -p111111</span><br><span class="line">select host，user，password,grant_priv,super_priv from mysql.user;</span><br><span class="line">[root@localhost ~]# mysql -uroot -h192.168.170.11 -p111111</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 128</span><br><span class="line">Server version: 5.5.56-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select host,user,password,grant_priv,super_priv from mysql.user</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-------------+-------------+-------------------------------------------+------------+------------+</span><br><span class="line">| host        | user        | password                                  | grant_priv | super_priv |</span><br><span class="line">+-------------+-------------+-------------------------------------------+------------+------------+</span><br><span class="line">| localhost   | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| 127.0.0.1   | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| ::1         | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| 192.168.%.% | bai         | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | N          | Y          |</span><br><span class="line">| %           | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | N          | Y          |</span><br><span class="line">| 127.0.0.1   | wordpreuser | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 | N          | N          |</span><br><span class="line">+-------------+-------------+-------------------------------------------+------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*从此项可以看出，root授权没有打开，需更改；*</span><br><span class="line">update mysql.user set grant_priv=&quot;y&quot;,super_priv=&quot;y&quot; where user=&quot;root&quot;;</span><br><span class="line">flush privileges;---滚动刷新；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; update mysql.user set grant_priv=&quot;y&quot;,super_priv=&quot;y&quot; where user=&quot;root&quot;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 4  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select host,user,password,grant_priv,super_priv from mysql.user;</span><br><span class="line">+-------------+-------------+-------------------------------------------+------------+------------+</span><br><span class="line">| host        | user        | password                                  | grant_priv | super_priv |</span><br><span class="line">+-------------+-------------+-------------------------------------------+------------+------------+</span><br><span class="line">| localhost   | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| 127.0.0.1   | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| ::1         | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| 192.168.%.% | bai         | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | N          | Y          |</span><br><span class="line">| %           | root        | *FD571203974BA9AFE270FE62151AE967ECA5E0AA | Y          | Y          |</span><br><span class="line">| 127.0.0.1   | wordpreuser | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 | N          | N          |</span><br><span class="line">+-------------+-------------+-------------------------------------------+------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">网页打开phpmyadmin;创建数据库blogdb;</span><br><span class="line">创建用户wordpreuser</span><br><span class="line">并进行blogdb数据库授权；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">当没有检查root授权情况，会出现以下错误；</span><br><span class="line">创建用户wordpreuser;选数据库blogdb,选择权限、全选；</span><br><span class="line"></span><br><span class="line">SQL 查询：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON `blogdb`.* TO &apos;wordpreuser&apos;@&apos;127.0.0.1&apos; WITH GRANT OPTION</span><br><span class="line">MySQL 返回： 文档</span><br><span class="line"></span><br><span class="line">#1044 - Access denied for user &apos;root&apos;@&apos;%&apos; to database &apos;blogdb&apos;</span><br><span class="line">这时需要查看root授权情况；</span><br><span class="line">select host,user,password，grant_priv,super_priv from mysql.user；</span><br><span class="line">更改授权；</span><br><span class="line">update mysql.user grant_priv=&quot;y&quot;,super_priv=&quot;y&quot; where user=&quot;root&quot;；</span><br><span class="line">滚动刷新数据库；</span><br><span class="line">flush privileges;</span><br><span class="line">登入phpmyadmin可以成功实现更改；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">创建表格；</span><br><span class="line">show databases;</span><br><span class="line">use blogdb；---使用数据库；</span><br><span class="line">create table baitable （id int,name char(20)）;</span><br><span class="line">desc baitable;---查看表格；</span><br><span class="line">drop table baitable;---删除表格；</span><br><span class="line">desc baitable;---查看表格；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">从官网下载wordpress;解压到/var/www/html/blog/下；</span><br><span class="line">phpmyadmin创建mysql用户名，设置权限；</span><br><span class="line">mysql用户名，host192.168.170.%;</span><br><span class="line">登入网页；</span><br><span class="line">192.168.170.12/blog</span><br><span class="line">填写数据库名；</span><br><span class="line">mysql用户名；</span><br><span class="line">填写ip地址；192.168.170.11</span><br><span class="line">创建博客；填写相关信息；</span><br><span class="line">创建博客用户名，密码；</span><br><span class="line">登入，管理博客平台；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">登入管理平台可以写博客了；</span><br><span class="line">http://192.168.170.12/blog/wp-admin/</span><br></pre></td></tr></table></figure>
<p><img src=".png" alt=""></p>
]]></content>
      
        
        <tags>
            
            <tag> lamp </tag>
            
            <tag> mysql服务及客户端，phpmyadmin </tag>
            
            <tag> wordpress </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[httpd创建虚拟机及添加web页面登入用户和密码]]></title>
      <url>/2018/01/09/httpd%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%8A%E6%B7%BB%E5%8A%A0web%E9%A1%B5%E9%9D%A2%E7%99%BB%E5%85%A5%E7%94%A8%E6%88%B7%E5%92%8C%E5%AF%86%E7%A0%81/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Centos6：httpd2.2版本；不支持同时编译MPM多道处理模块；</span><br><span class="line">Centos7：httpd2.4版本；支持MPM多道处理模块；</span><br><span class="line">MPM：preforc,worker,event</span><br><span class="line"></span><br><span class="line">httpd2.2：创建虚拟机，添加用户</span><br><span class="line">1、安装httpd2.2；</span><br><span class="line">2、关闭防火墙及Selinux;</span><br><span class="line">3、更改配置文件；</span><br><span class="line">4、eth0网卡添加ip地址；ip addr add 192.168.170.130/24 dev eth0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">配置文件；</span><br><span class="line">/etc/sysconfig/httpd---更改MPM工作模型</span><br><span class="line">/etc/httpd/conf/httpd.conf---添加用户，虚拟机，网页路径，软连接路径管理等；</span><br><span class="line">/etc/httpd/conf.d/*.conf---添加用户文件.htpasswd ,.htgroup</span><br><span class="line">将配置文件中的DocumentRoot注释掉；</span><br><span class="line">配置文件最底部；VirtualHost配置段下：</span><br><span class="line">#&lt;/VirtualHost&gt;</span><br><span class="line">&lt;VirtualHost 192.168.170.130:80&gt;</span><br><span class="line"> ServerName web1.baiyunfei.com</span><br><span class="line"> DocumentRoot &quot;/vhosts/web1/htdocs&quot;</span><br><span class="line">&lt;Directory &quot;/vhosts/web1/htdocs&quot;&gt;</span><br><span class="line"> Options None</span><br><span class="line"> AllowOverride None</span><br><span class="line"> AuthType Basic</span><br><span class="line"> AuthName &quot;Administator private&quot;</span><br><span class="line"> AuthUserFile &quot;/etc/httpd/conf.d/.htpasswd&quot;</span><br><span class="line"> AuthGroupFile &quot;/etc/httpd/conf.d/.htgroup&quot;</span><br><span class="line"> Require Group web1.admin</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost 192.168.170.129:80&gt;</span><br><span class="line"> ServerName web2.baiyunfei.com</span><br><span class="line"> DocumentRoot &quot;/vhosts/web2/htdocs&quot;</span><br><span class="line">&lt;Directory &quot;/vhosts/web2/htdocs&quot;&gt;</span><br><span class="line"> Options None</span><br><span class="line"> AllowOverride None</span><br><span class="line"> AuthType Basic</span><br><span class="line"> AuthName &quot;Administator private&quot;</span><br><span class="line"> AuthUserFile &quot;/etc/httpd/conf.d/.htpasswd&quot;</span><br><span class="line"> AuthGroupFile &quot;/etc/httpd/conf.d/.htgroup&quot;</span><br><span class="line"> Require Group web2.admin</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">          </span><br><span class="line">&lt;VirtualHost 192.168.170.130:8080&gt;</span><br><span class="line"> ServerName web3.baiyunfei.com</span><br><span class="line"> DocumentRoot &quot;/vhosts/web3/htdocs&quot;</span><br><span class="line">&lt;Directory &quot;/vhosts/web3/htdocs&quot;&gt;</span><br><span class="line"> Options None</span><br><span class="line"> AllowOverride None</span><br><span class="line"> AuthType Basic</span><br><span class="line"> AuthName &quot;Administator private&quot;</span><br><span class="line"> AuthUserFile &quot;/etc/httpd/conf.d/.htpasswd&quot;</span><br><span class="line"> AuthGroupFile &quot;/etc/httpd/conf.d/.htgroup&quot;</span><br><span class="line"> Require Group web3.admin</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#htpasswd -c -m /etc/httpd/conf.d/.htpasswd  wang.....---md5加密重复命令添加用户，密码；</span><br><span class="line">#vim /etc/httpd/conf.d/.htgroup---添加组成员；</span><br><span class="line">web1.admin : wang  bai</span><br><span class="line">wab2.admin：zhang li</span><br><span class="line">wab3.admin：qian sun</span><br><span class="line">#httpd -t</span><br><span class="line">#service httpd reload</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、创建网页；</span><br><span class="line">#mkdir -pv /vhosts/web&#123;1,2,3&#125;/htdocs</span><br><span class="line">#vim index.html</span><br><span class="line">2、访问网页；</span><br><span class="line">![image.png](http://upload-images.jianshu.io/upload_images/6132998-32319fcd36a79570.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> httpd的web账号密码管理 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[OSI模型的七层结构和tcp网络连接创建虚拟通道]]></title>
      <url>/2018/01/09/OSI%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%83%E5%B1%82%E7%BB%93%E6%9E%84%E5%92%8Ctcp%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E9%80%9A%E9%81%93/</url>
      <content type="html"><![CDATA[<p>OSI模型的七层结构;</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0f1ae16ee3962437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>1、物理层；二进制传输</p>
<pre><code>- 为启动，维护以及关闭物理链路定义了电气规范、机械规范、过程规范和功能规范
</code></pre><p>2、数据链路层；访问介质</p>
<pre><code>- 定义如何格式化数据以便进行传输以及如何控制对网络的访问
- 支持错误检测
</code></pre><p>3、网络层；数据传输</p>
<pre><code>- 路由数据包
- 选择传递数据的最佳路径
- 支持逻辑寻址和路径选择
</code></pre><p>4、传输层；传输问题</p>
<pre><code>- 确保数据传输的可靠性
- 建立、维护和终止虚拟路由
- 通过错误检测和恢复
- 信息流量控制来保障可靠性
</code></pre><p>5、会话层；主机间通信</p>
<pre><code>- 建立、管理和终止在应用程序之间的会话
</code></pre><p>6、表示层；数据表示</p>
<pre><code>- 确保接收系统可以读取该数据
- 格式化数据
- 构建数据
- 协商用于应用层的数据传输语法
- 提供加密
</code></pre><p>7、应用层；网络进程访问应用层</p>
<pre><code>- 为应用程序进程（例如，电子邮件、文件传输和终端仿真）提供网络服务
- 提供用户身份认证
</code></pre><p>物理拓扑分类</p>
<pre><code>- 总线拓扑
所有设备均可接收信号
- 环状拓扑
信号环绕传输
单一故障点
- 双环拓扑
信号沿相反的方向传输
比单一的复原能力更强
- 星型拓扑
通过中心点传输
单一故障点
- 扩展星型拓扑
比星型拓扑的恢复能力更强
- 全网状拓扑
容错能力强
实时成本高
- 部分网状拓扑
在容错能力与成本之间寻求平衡
</code></pre><p>逻辑拓扑</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2f3167942e415ee4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>三种通信模式；<br>1、单播<br>2、广播<br>3、组播<br>LAN    (局域网)<br>WAN  (广域网)</p>
<p>Tcp/ip协议栈；除应用层外的，传输层、网络层、数据链路层、物理层划分到tcp/ip协议栈；</p>
<p>Tcp三次握手；<br>Syn=1—表示发送端希望双方建立同步处理，主动要连接到对方；<br>Ack=1—表示相应数据包<br>Seq=x—表示数据包序列号<br>ACK=X+1—表示回应序列号</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-10fa2bbc933a678a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>Tcp四次挥手；<br>Syn=1—表示发送端希望双方建立同步处理，主动要连接到对方；<br>Ack=1—表示相应数据包<br>Seq=x—表示数据包序列号<br>ACK=X+1—表示回应序列号<br>FIN=1—表示传输结束</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-804bae7f34864e90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<pre><code>- LISTEN：侦听来自远方的TCP端口的连接请求
- SYN-SENT：在发送连接请求后等待匹配的连接请求
- SYN-RECEIVED：在收到和发送一个连接请求后等待对方对链请求的确认
- ESTABLISHED：代表一个打开的连接
- FIN-WAIT-1：等待远程TCP连接中断请求，或先前的链接中断请求的确认
- FIN-WAIT：从远程TCP等待连接中断请求
- CLOSE-WAIT：等待从本地用户发来的连接中断请求
- CLOSING：等待远程TCP对连接中断的确认
- LAST-ACK：等待原来的发送远程TCP的连接中断请求的确认
- TIME-WAIT：等待足够的时间以确保远程tcp接收到连接中断请求的确认
</code></pre><p>CLOSED：没有任何连接状态；</p>
]]></content>
      
        
        <tags>
            
            <tag> OSI模型的七层结构 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[zabbix-server/zabbix-agent]]></title>
      <url>/2018/01/09/zabbix-server-zabbix-agent/</url>
      <content type="html"><![CDATA[<p>######1、Node4：Zabbix-Server<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">安装zabbix；</span><br><span class="line">1、同步时间；</span><br><span class="line">2、从官网下载yum源配置文件；</span><br><span class="line">3、下载；zabbix-server-mysql zabbix-web-mysql zabbix-agent zabbix-get zabbix-agent zabbix-sender</span><br><span class="line">4、数据存储需要安装mysql(mariadb-server)</span><br><span class="line">5、简单配置mysql配置选项；</span><br><span class="line">【mysqld-5.5】</span><br><span class="line">skip——name_resolve=NO</span><br><span class="line">Innidb_file_per_table=NO</span><br><span class="line"></span><br><span class="line">Max_connections=3000</span><br><span class="line">6、启动mysql服务；</span><br><span class="line">Systemctl start mariadb.service</span><br><span class="line">注意本机文件路径；mysql.sock文件</span><br><span class="line">/var/lib/mysql</span><br><span class="line"></span><br><span class="line">7、zabbix连入数据库需创建用户；</span><br><span class="line"># mysql</span><br><span class="line">CREATE DATABASE zabbix CHARACTER SET &apos;utf8&apos; ;</span><br><span class="line">CRANT ALL ON zabbix.* TO &apos;zabbix&apos; @&apos;127.0.0.1&apos;      IDENTIFIED BY &apos;zbxpass&apos;</span><br><span class="line">GRANT ALL ON zabbix.* TO &apos;ZABBIX&apos;@&apos;172.16.0.%&apos; IDENTIFIED BY &apos;zbxpass&apos; ;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node4 grub]#rpm -ql zabbix-server-mysql</span><br><span class="line">/etc/logrotate.d/zabbix-server</span><br><span class="line">/etc/zabbix/zabbix_server.conf</span><br><span class="line">/usr/lib/systemd/system/zabbix-server.service</span><br><span class="line">/usr/lib/tmpfiles.d/zabbix-server.conf ----主配置文件</span><br><span class="line">/usr/lib/zabbix/alertscripts ----- 告警脚本</span><br><span class="line">/usr/lib/zabbix/externalscripts----外部脚本</span><br><span class="line">/usr/sbin/zabbix_server_mysql----主程序</span><br><span class="line"></span><br><span class="line">/usr/share/doc/zabbix-server-mysql-3.4.2/create.sql.gz-----生成表的sql脚本</span><br><span class="line"></span><br><span class="line">8、将生成表的sql脚本压缩文件展开；</span><br><span class="line">#cp /usr/share/doc/zabbix-server-mysql-3.4.2/create.sql.gz ./</span><br><span class="line">#gzip -d  create.sql.gz</span><br><span class="line">9、导入zabbix数据库；</span><br><span class="line">#mysql -uzabbix -hlocalhost -pzbxpass zabbix &lt; create.sql</span><br><span class="line"></span><br><span class="line">10、连入mysql查看表；</span><br><span class="line">#mysql</span><br><span class="line">#use zabbix</span><br><span class="line">#SHOW TABLES;</span><br><span class="line">#exit</span><br><span class="line"></span><br><span class="line">11、查看配置文件；</span><br><span class="line">#Cd /etc/zabbix</span><br><span class="line">#ls</span><br><span class="line">[root@node4 zabbix]#ls</span><br><span class="line">web  zabbix_agentd.conf  zabbix_agentd.d  zabbix_server.conf</span><br><span class="line">agent端配置文件；</span><br><span class="line">zabbix端配置文件；</span><br><span class="line"></span><br><span class="line">[root@node4 zabbix]#grep -i &quot;^#####&quot; zabbix_server.conf</span><br><span class="line">############ GENERAL PARAMETERS #################</span><br><span class="line">############ ADVANCED PARAMETERS ################</span><br><span class="line">####### LOADABLE MODULES #######</span><br><span class="line">####### TLS-RELATED PARAMETERS #######</span><br><span class="line">Zabbix_server.conf配置文件中的配置端；</span><br><span class="line">通用配置项；</span><br><span class="line">高级配置项；</span><br><span class="line">可装载模块；</span><br><span class="line">配置ssl如何使用；</span><br><span class="line">11、配置zabbix_server.conf；</span><br><span class="line"></span><br><span class="line">#Cp zabbix_server.conf&#123;,.abk&#125;</span><br><span class="line"> #vim  zabbix_server.conf</span><br><span class="line">############ GENERAL PARAMETERS #################</span><br><span class="line">	- 通用配置端；</span><br><span class="line">	 - 监听端口；</span><br><span class="line">	Listenport=10051</span><br><span class="line">	 - 服务器端源地址；</span><br><span class="line">	 sourceip=</span><br><span class="line">	-日志类型；</span><br><span class="line">	 logtype=file</span><br><span class="line">	日志文件目录路径；logfile=/var/log/zabbix/zabbix_server.log</span><br><span class="line">	-日志文件滚动项；设置日志文件大小；</span><br><span class="line">	 logfilesize=0</span><br><span class="line">	-调试选项；</span><br><span class="line">	 Debuglevel=3</span><br><span class="line">	-PIDfile；pidfile文件路径；</span><br><span class="line">	-socketdir；使用与本机通信；</span><br><span class="line">	根mysql一样用于本机通信，文件路径；</span><br><span class="line">	Socketdir=/var/run/zabbix</span><br><span class="line">	-option:Dbhost---定义mysql服务器主机的地址；</span><br><span class="line">	DBHost=127.0.0.1---mysql安装在本及时；</span><br><span class="line">	-option：Dbname ---数据库名；</span><br><span class="line">	DBSchema=zabbix ----当前设置的数据库名；</span><br><span class="line">	-option  :DBUser---数据库用户名；</span><br><span class="line">	Dbuser=zabbix----当前自定义设置</span><br><span class="line">	-option： Dbpassword---数据库用户设定的密码；</span><br><span class="line">	Dbpassword=zbxpass---自定义</span><br><span class="line">	 -Option：Dbsocket---编辑mysql--sockt文件路径；</span><br><span class="line">	当mysql数据库在当前主机时，添加sockt路径或创建连接；</span><br><span class="line">	#Dbsocket=/tmp/mysql.sockt</span><br><span class="line">	Dbsocket=/var/lib/mysql/mysql.sock</span><br><span class="line">	创建连接；</span><br><span class="line">	Ln -sv /var/lib/mysql/mysql.sock /tmp/mysql.sockt</span><br><span class="line">	DBhost不是本地主机，不用配置此项。</span><br><span class="line">12、配置完成zabbix-server.conf文件后，启动zabbix-server.sevice服务；</span><br><span class="line">      设置mysql---ip ;127.0.0.1</span><br><span class="line">             mysql用户；zabbix</span><br><span class="line">             mysql密码；zaxpass</span><br><span class="line">            设置socket路径；</span><br><span class="line">        启动服务，查看端口；</span><br><span class="line">        systemctl restart zabbix-server.service</span><br><span class="line">        #ss -ntulp</span><br><span class="line"></span><br><span class="line">[root@node4 ~]#systemctl restart zabbix-server.service</span><br><span class="line">[root@node4 ~]#ss -ntl</span><br><span class="line">State      Recv-Q Send-Q Local Address:Port               Peer Address:Port</span><br><span class="line">LISTEN     0      50               *:3306                         *:*</span><br><span class="line">LISTEN     0      128              *:22                           *:*</span><br><span class="line">LISTEN     0      100      127.0.0.1:25                           *:*</span><br><span class="line">LISTEN     0      128              *:10051                        *:*</span><br><span class="line">LISTEN     0      128             :::22                          :::*</span><br><span class="line">LISTEN     0      100            ::1:25                          :::*</span><br><span class="line">LISTEN     0      128             :::10051                       :::*</span><br><span class="line"></span><br><span class="line">Alerter ----报警器， housekeeper----清理组件， timer----计时器， syncer----时间同步 poller---采集数据  trapper---等待数据进行记录  self-monitoring----自我监控</span><br><span class="line"></span><br><span class="line">图形界面；zabbix-web</span><br><span class="line">配置文件/etc/httpd/conf.d/zabbix.conf----到哪里去加载配置定义；</span><br><span class="line">配置文件；/etc/zabbix/web/zabbix.conf.php</span><br><span class="line">                       /etc/zabbix/web/maintenance.inc.php</span><br><span class="line"></span><br><span class="line">定义显示文件路径及时区；</span><br><span class="line">	- /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">      Alias /zabbix /usr/share/zabbix----显示文件的路径</span><br><span class="line">    # php_value date.timezone Europe/Riga----定义时区</span><br><span class="line">    将时区更改为上海时区；</span><br><span class="line">    再此配置文件中定义时区将会在所有php模板生效；</span><br><span class="line">    -  也可以在php的配置文件/etc/php.ini中定义时区，进行更改；</span><br><span class="line">    [Date]</span><br><span class="line">; Defines the default timezone used by the date functions</span><br><span class="line">; http://php.net/date.timezone</span><br><span class="line">;date.timezone = 添加更改内容；</span><br><span class="line"></span><br><span class="line">限制从外网访问，防范数据信息泄漏；</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/share/zabbix/conf&quot;&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/share/zabbix/app&quot;&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/share/zabbix/include&quot;&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/usr/share/zabbix/local&quot;&gt;</span><br><span class="line">    Require all denied</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">	- 1、添加配置内容</span><br><span class="line">	Vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line">	Php_value date.timezone  Asia/Shanghai</span><br><span class="line">	- 启动服务；</span><br><span class="line">	Systemctl start httpd.service</span><br><span class="line">	- 2、访问web网页文件；</span><br><span class="line">	- 输入；172.16.88.4：/zabbix 回车；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-b904f083d1816ea5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">点击 Next step，检测依赖的环境；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">登入界面；</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1e34b7bffd3acf05.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下一步；</span><br><span class="line">默认账号密码；admin;zabbix</span><br></pre></td></tr></table></figure></p>
<p>######2、Node1 ： Zabbix-Agent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">安装zabbix-Agent zabbix-sender包；监控node1主机；</span><br><span class="line">从www.zabbix.com 官网安装配置文件，跟node4一样；</span><br><span class="line">安装zabbix-Agent zabbix-sender包；</span><br><span class="line"></span><br><span class="line">[root@node1 ~]#yum install zabbix-agent zabbix-sender</span><br><span class="line"> 1、查看配置文件；</span><br><span class="line">#rpm -ql zabbix-agent</span><br><span class="line">[root@node1 ~]#rpm -ql zabbix-agent</span><br><span class="line">/etc/logrotate.d/zabbix-agent</span><br><span class="line">/etc/zabbix/zabbix_agentd.conf----主配置文件；</span><br><span class="line">/etc/zabbix/zabbix_agentd.d</span><br><span class="line">/etc/zabbix/zabbix_agentd.d/userparameter_mysql.conf</span><br><span class="line">/usr/lib/systemd/system/zabbix-agent.service</span><br><span class="line">/usr/lib/tmpfiles.d/zabbix-agent.conf</span><br><span class="line">/usr/sbin/zabbix_agentd-------------主程序</span><br><span class="line">/usr/share/doc/zabbix-agent-3.4.2</span><br><span class="line">/usr/share/doc/zabbix-agent-3.4.2/AUTHORS</span><br><span class="line">/usr/share/doc/zabbix-agent-3.4.2/COPYING</span><br><span class="line">/usr/share/doc/zabbix-agent-3.4.2/ChangeLog</span><br><span class="line">/usr/share/doc/zabbix-agent-3.4.2/NEWS</span><br><span class="line">/usr/share/doc/zabbix-agent-3.4.2/README</span><br><span class="line">/usr/share/man/man8/zabbix_agentd.8.gz</span><br><span class="line">/var/log/zabbix---------------------------日志文件</span><br><span class="line">/var/run/zabbix</span><br><span class="line"></span><br><span class="line">2、查看配置端；</span><br><span class="line">#grep -I &quot;^####&quot; zabbix_agentd.conf</span><br><span class="line">[root@node1 ~]#grep -i &quot;^####&quot; /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">############ GENERAL PARAMETERS #################---通用配置端</span><br><span class="line">##### Passive checks related----被动监控</span><br><span class="line">##### Active checks related------主动监控</span><br><span class="line">############ ADVANCED PARAMETERS #################-----高级配置端</span><br><span class="line">####### USER-DEFINED MONITORED PARAMETERS #######------用户自定义监控参数</span><br><span class="line">####### LOADABLE MODULES #######----可装载模块</span><br><span class="line">####### TLS-RELATED PARAMETERS #######----</span><br><span class="line"></span><br><span class="line">3、配置参数；</span><br><span class="line">#Vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line"> Passive checks related---被动监控端；</span><br><span class="line">server=172.16.88.4</span><br><span class="line">Option：serverActive -----主动监控端</span><br><span class="line">serverActive=172.16.88.4</span><br><span class="line">Hostname=node1.mageedu.com---当前主机名</span><br><span class="line">重启服务；</span><br><span class="line">#Systemctl start  zabbix-agent.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### Passive checks related</span><br><span class="line">Server=IP1, IP2, ...</span><br><span class="line">	ListenPort=10050</span><br><span class="line">	ListenIP=0.0.0.0</span><br><span class="line">	StartAgents=3</span><br><span class="line"></span><br><span class="line">##### Active checks related</span><br><span class="line">	ServerActive=IP1[:port], IP2[:port], ...</span><br><span class="line">	Hostname=Unique_HOSTNAME</span><br><span class="line">		必须与服务器配置的监控主机的主机名称保持一致；</span><br><span class="line">4、web界面添加监控端node1</span><br><span class="line">Note1.mageedu.com</span><br><span class="line">Node1</span><br><span class="line">172.16.88.1</span><br><span class="line">添加即可；</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4e57ef21d58f5056.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5、添加监控项；</span><br><span class="line">配置---主机---监控项---创建监控项；</span><br><span class="line">Key---脚本或命令，zabbix有内置的命令选项；</span><br><span class="line">举例选择CPU switches；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8465afa2d834c4d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">添加完成后，点击最新数据,点击主机选项，可以查看到监控选项有哪些；</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-3574dcb45a3ab0d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-fab9d2ad37ae5a2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">点击图形，可以查看到内置的图形；</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c539f4721d963057.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、systemctl start httpd.service</span><br><span class="line">   systemctl start zabbix-server.service</span><br><span class="line">   systemctl start mariadb.service</span><br><span class="line">2、systemctl start zabbix-agent.service</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> zabbix-server/zabbix-agent </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Ansible-playbook-角色]]></title>
      <url>/2018/01/09/Ansible-playbook-%E8%A7%92%E8%89%B2/</url>
      <content type="html"><![CDATA[<p>```<br>Ansible-playbok的核心元素之一；角色<br>角色（roles）:<br>     角色集合：<br>             roles/<br>                mysql/<br>                httpd/<br>                nginx/<br>                memcached/<br>每个角色，以特定的层级目路结构进行组织；<br>如； mysql/</p>
<pre><code>-  files/: 存放由copy或script模块等调用的文件；
- Templates/:template模块查找所需要模板文件的目录；
- Tasks/:至少应该包含一个名为mail.yml的文件；其他的文件需要在此文件中通过include进行包含；
- Handlers/:   至少应该包含一个名为mail.yml的文件；其他的文件需要在此文件中通过include进行包含；
- Vars/：至少应该包含一个名为mail.yml的文件；其他的文件需要在此文件中通过include进行包含；
- Meta/：至少应该包含一个名为mail.yml的文件；定义当前角色的特殊定义及依赖关系；其他的文件需要在此文件中通过include进行包含；
- Default/:设定默认变量时使用此目录中的main.yml文件；

在playbook中的调用方法1；
- Hosts: webserver
Remote_user:root
Roles:
 - mysql
 - memcached
 - nginx
</code></pre><p>举例；<br>创建目录；如；</p>
<pre><code>- mkdir nginx/{tasks,files,vars,templates}
</code></pre><p>[root@localhost ~]#mkdir nginx/{tasks,files,vars,templates} -pv<br>mkdir: created directory ‘nginx’<br>mkdir: created directory ‘nginx/tasks’<br>mkdir: created directory ‘nginx/files’<br>mkdir: created directory ‘nginx/vars’<br>mkdir: created directory ‘nginx/templates’</p>
<p>在/etc/ansible/ansible.cfg文件中定义—模板，角色路径放置位置；</p>
<p>#roles_path    = /etc/ansible/roles</p>
<p>创建目录，mkdir -pv /etc/ansible/roles/nginx/{files,templates,tasks,vars,handlers,meta,default}</p>
<p>[root@localhost playbooks]#mkdir -pv /etc/ansible/roles/nginx/{files,tasks,handlers,templates,default,meta}<br>mkdir: created directory ‘/etc/ansible/roles/nginx/files’<br>mkdir: created directory ‘/etc/ansible/roles/nginx/tasks’<br>mkdir: created directory ‘/etc/ansible/roles/nginx/handlers’<br>mkdir: created directory ‘/etc/ansible/roles/nginx/templates’<br>mkdir: created directory ‘/etc/ansible/roles/nginx/default’<br>mkdir: created directory ‘/etc/ansible/roles/nginx/meta’</p>
<p>创建任务；</p>
<p>#Cd /etc/ansible/roles/nginx/tasks/<br>Vim main.yml<br>-name: install nginx<br>  yum： name=nginx state=latest<br> when: ansible_os_family== “ReHat”</p>
<p>创建playbook调用的配置文件；</p>
<p>#cd</p>
<p>#vim nginx.yaml<br>-hosts: webserver<br>  remote_user:root<br>  roles:</p>
<ul>
<li>nginx</li>
</ul>
<p>[root@localhost ~]#ansible-playbook –syntax-check nginx.yml</p>
<p>playbook: nginx.yml<br>[root@localhost ~]#ansible-playbook -C  nginx.yml</p>
<p>PLAY [webserver] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>TASK [setup] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [172.16.88.1]<br>ok: [172.16.88.2]</p>
<p>TASK [nginx : install nginx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>skipping: [172.16.88.1]<br>skipping: [172.16.88.2]</p>
<p>PLAY RECAP <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>172.16.88.1                : ok=1    changed=0    unreachable=0    failed=0<br>172.16.88.2                : ok=1    changed=0    unreachable=0    failed=0</p>
<p>ansible上编辑nginx配置文件模板；<br>Cd  /etc/ansible/roles/nginx/templates/<br>Vim vhost1.yml<br>Service{<br>            listen 80:<br>            server_name ;<br>            location / {<br>                   root “/www/ngxdata/vhost1”;<br>           }<br>}<br>Cp /etc/ansible/roles/nginx/templates/<br>Vim vhost1.yml{,.j2}</p>
<p>添加任务—编辑vim roles/nginx/tasks/main.yml<br>Vim main.yml<br>-name: install nginx<br>  yum： name=nginx state=latest<br> when: ansible_os_family== “ReHat”<br>-name: install conf<br> template: src=vhost1.j2 dest=/etc/nginx/conf.d/vhost1.conf</p>
<p>Tags: conf<br>Notify: restart nginx—————配置完文件以后创建站点家目录<br>-name: install site home directory<br> file: path= state=directory<br>-name: install index page<br>Copy: src=index.html dest=/</p>
<p>-name: start nginx<br> service: name=nginx state=started</p>
<pre><code>Ø handlers--定义handlers -条件设定;
</code></pre><p>Cd roles/nginx/handlers<br>Vim main.yml<br>-name: restart nginx<br> service: name=nginx state=restarted</p>
<pre><code>Ø 定义变量vars；
</code></pre><p>Cd roles/nginx/vars<br>Vim  main.yml<br>ngxroot: /ngxdata/vhost1—-变量需要字典来定义，不需要加-横线；</p>
<pre><code>Ø 定义网页文件files；
</code></pre><p>Cd roles/nginx/files/index.html</p>
<h1> vhost1</h1>


<p>将监听端口设定改为8080：—自己创建的网页文件路径与默认网页文件路径所指定的端口冲突，默认监听端口为80，所以需要更改监听端口，否则无法访问到页面；</p>
<p>重新启动服务；<br>Ansible-playbook -t tage nginx.yml</p>
<p>[root@localhost ~]#ansible-playbook   nginx.yml</p>
<p>PLAY [webserver] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>TASK [setup] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [172.16.88.2]<br>ok: [172.16.88.1]</p>
<p>TASK [nginx : install nginx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [172.16.88.2]<br>ok: [172.16.88.1]</p>
<p>TASK [nginx : install conf vhost1.conf.j2] <strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [172.16.88.1]<br>ok: [172.16.88.2]</p>
<p>TASK [nginx : install site  home  directory] <strong><strong><strong><strong><strong><strong><strong><strong><em>*</em></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [172.16.88.1]<br>changed: [172.16.88.2]</p>
<p>TASK [nginx : install  index.html page] <strong><strong><strong><strong><strong><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>changed: [172.16.88.2]<br>changed: [172.16.88.1]</p>
<p>TASK [nginx : start nginx] <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>ok: [172.16.88.2]<br>ok: [172.16.88.1]</p>
<p>PLAY RECAP <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>*</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>172.16.88.1                : ok=6    changed=2    unreachable=0    failed=0<br>172.16.88.2                : ok=6    changed=2    unreachable=0    failed=0</p>
<p>ansible的配置文件；<br>Ansible.cfg文件；<br>【defaults】<br>默认选项；</p>
<pre><code>- Forks =5 ----默认管控的主机数量；
- Remote_port =22----ssh连接设定的端口，为了安全可以更默认端口；
</code></pre><p>Roles_path=/etc/ansible/roles—-角色的存放路径；<br>Module_name=command 默认指定的模块<br>Executable= /bin/sh  执行command时默认使用的shell解释执行；<br>Connection_plugins=/usr/share/ansible/plugins/connection—-将使用的插件存放到此目录下，如果没有此文件创建生成，将使用的插件模块存放到此目录下；</p>
<p>【privilege escalation】—用户升级</p>
<p>#become=true — 启用become升级</p>
<p>#become_method=sudo —-shdo 方式</p>
<p>#become_user=root  ————提升为root用户</p>
<p>#become_ask_pass=false—-需要提供密码与否</p>
<p>【paramiko_connection】<br>Python 指定库连接个目标主机的选项；<br>【ssh_coniction】<br>ssh连接时的专用选项；<br>【persistent_connection】<br>持久连接；<br>【accelerate】<br>加速选项<br>【selinux】<br>【colors】<br> 显示结果，定义颜色</p>
<pre><code>Ø 当配置完成ansible后,可以设定任务计划，每隔多少时间执行一次，如果远程主机配置文件文件被改动可以还原，并保持正常运行；
Ø 如果客户端主机(ˇˍˇ） 想检测自己的配置文件是否跟ansible主机上的配置文件是否一致，需安装第三方组件，ansible_vsc，使用ansible-pull 命令；
当需要使用此模型时，应该更换使用saltstack （使用python编写，兼容性好）或pupet（应用广泛）
比ansible简单易用；

实验；
主备模式高可用keeplived+nginx(proxy)
两台主机：httpd+php
一台主机：mysql-server或mariadb_server

实验；
nginx反代 tomcat 使用ansible

准备四台主机；
- node1：nginx
- Node2: tamcat
- Node3: tamcat
- Node4: ansible

Node4;
1、安装ansible
2、定义主机；
- [lb]-----负载均衡器
Node1.mageedu.com
- [tcsrvs]
Node[2:3].mageedu.com
3、生成秘钥传送到远程主机，实现无密码传递。
Ssh-keygen -t rsa -P &apos; &apos;  ----生成蜜钥
Ssh-copy-id -I ~/.ssh/id_rsa.pub root@node{1，2,3}--传送到远程主机；
4、使用ansible，查看使用主机是否存在；
Ansible all --list-host
5、创建角色目录；
Mkdir -pv roles/{nginx,tomcat}/{files,templates,tasks,vars,handlers,meta,default,}

Cd roles/nginx/tasks
Vim main.yml
-name: install nginx
 yum: name=nginx state=latest
When: ansible_os_family == &quot;RadHat&quot;
 -name: install conf
  copy：src=lb.conf dest=/etc/nginx/conf.d/
  tags: conf
Notify: restart ngnix
-name: start ngnix
 service: name=nginx state=started enabled=yes

#cd roles/nginx/handlers/
Vim  main.yml
-name：restart nginx
 service: name=nginx state=restarted

#Cd roles/nginx/files/
#vim  lb.conf
Upstream tcsevs {
Server node2.magedu.com:8080;
Server node3.magedu.com:8080;
}
Server {
    listen 80；
    server_name node4.mageedu.com;
    location / {
                proxy_pass http://tcsrvs;
    }
}


#Cd
#mkdir playbooks
#cd playbooks
#vim nt.yml
      -hosts: lb
        remote_user:root
        roles:
       -nginx

       #ansible-playbook -C nt.yml
</code></pre><p>配置tomcat 配置文件；</p>
<p>#cd roles/tamcat/tasks<br>Vim  main.yml<br>-name: install package<br> yum: name= state=latest<br> with_items:</p>
<pre><code>- Tomcat
- Tomcat -admin-webapps
- Tomcat-docs-webapp
- Tomcat-webapps
</code></pre><p>When: ansible_os_family == “RadHat”<br>-name: start tomcat<br> service: name=tomcat state=started enabled=yes</p>
<p>#Cd roles/</p>
<h1 id="mkdir-jdk-tasks-templates-vars-meta-handlers-default-files"><a href="#mkdir-jdk-tasks-templates-vars-meta-handlers-default-files" class="headerlink" title="mkdir jdk/{tasks,templates,vars,meta,handlers,default,files}"></a>mkdir jdk/{tasks,templates,vars,meta,handlers,default,files}</h1><p>#cd roles/jdk/tasks/</p>
<p>#vim mian.yml<br>-name: install openjdk<br> yum: name=java--openjdk-devel state=latest<br>-name: install env file<br> copy: src=java.sh dest=/etc/profile.d/</p>
<p>#cd roles/jdk/files<br>Vim java,sh<br>Export JAVA_HOME=/usr</p>
<p>#cd roles/jdk/vars/</p>
<p>#vim main.yml<br> varsion: 1.8.0</p>
]]></content>
      
        
        <tags>
            
            <tag> Ansible角色 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Ansible命令行中的应用]]></title>
      <url>/2018/01/09/Ansible%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      <content type="html"><![CDATA[<p>######ansible远程管理工具；<br>时间同步<br>名字解析<br>```<br>1、安装ansible;</p>
<h1 id="Yum-install-ansible"><a href="#Yum-install-ansible" class="headerlink" title="Yum install ansible"></a>Yum install ansible</h1><h1 id="Package-Arch-Version-Repository-Size"><a href="#Package-Arch-Version-Repository-Size" class="headerlink" title=" Package                                                     Arch                           Version                                  Repository                   Size"></a> Package                                                     Arch                           Version                                  Repository                   Size</h1><p>Installing:<br> ansible                                                     noarch                         2.2.1.0-1.el7                            web                         4.6 M<br>Installing for dependencies:<br> PyYAML                                                      x86_64                         3.10-11.el7                              dev                         153 k<br> libtomcrypt                                                 x86_64                         1.17-23.el7                              web                         224 k<br> libtommath                                                  x86_64                         0.42.0-4.el7                             web                          35 k<br> libyaml                                                     x86_64                         0.1.4-11.el7_0                           dev                          55 k<br> python-babel                                                noarch                         0.9.6-8.el7                              dev                         1.4 M<br> python-backports                                            x86_64                         1.0-8.el7                                dev                         5.8 k<br> python-backports-ssl_match_hostname                         noarch                         3.4.0.2-4.el7                            dev                          12 k<br> python-httplib2                                             noarch                         0.7.7-3.el7                              web                          70 k<br> python-jinja2                                               noarch                         2.7.2-2.el7                              dev                         515 k<br> python-keyczar                                              noarch                         0.71c-2.el7                              web                         218 k<br> python-markupsafe                                           x86_64                         0.11-10.el7                              dev                          25 k<br> python-setuptools                                           noarch                         0.9.8-4.el7                              dev                         396 k<br> python-six                                                  noarch                         1.9.0-2.el7                              dev                          29 k<br> python2-crypto                                              x86_64                         2.6.1-13.el7                             web                         476 k<br> python2-ecdsa                                               noarch                         0.13-4.el7                               web                          83 k<br> python2-paramiko                                            noarch                         1.16.1-2.el7                             web                         258 k<br> python2-pyasn1                                              noarch                         0.1.9-7.el7                              dev                         100 k<br> sshpass                                                     x86_64                         1.06-1.el7                               web                          21 k</p>
<h1 id="Transaction-Summary"><a href="#Transaction-Summary" class="headerlink" title="Transaction Summary"></a>Transaction Summary</h1><p>Install  1 Package (+18 Dependent packages)</p>
<p>/etc/ansible     —————配置文件所在目录位置<br>/etc/ansible/ansible.cfg —主配置文件<br>/etc/ansible/hosts———-主机清单<br>/etc/ansible/roles———–角色目录<br>/usr/bin/ansible————-主程序<br>/usr/bin/ansible-console<br>/usr/bin/ansible-doc<br>/usr/bin/ansible-galaxy<br>/usr/bin/ansible-playbook<br>/usr/bin/ansible-pull——–从客户端拉取工具<br>/usr/bin/ansible-vault</p>
<p>/etc/ansible/ansible.cfg —主配置文件，关于自身的配置文件；</p>
<p>Ansible 一两种方式完成管理，命令行或剧本方式完成</p>
<p>命令行；<br>Ansible host-pattern  options<br>Ansible -a  -m   传递模块参数<br>Ansible -C          测试执行<br>Ansible -f        默认管控5个<br>ansible  -I       指明主机清单<br>Ansible  -l          列出主机<br>Ansible -t       将日志记录与指定的位置文件中</p>
<p>连接命令选项；</p>
<p>Ansible -c        指定以什么方式连接目标主机<br>Ansible -u        指明目标主机使用连接时的用户；默认为none;</p>
<p>权限升级方式；Privilege escalation options;</p>
<p>ansible     -s      切换sudo操作；<br>Ansible    -U      su到某个用户进行操作；<br>Ansible    -b      转变至某个用户操作；</p>
<p>秘钥认证；</p>
<p>#ssh-keygen -t rsa -P “”<br>将生成的蜜钥发送另两台主机；</p>
<p>#ssh-copy-id -I ~/.ssh/id_rsa.pub root@172.16.88.2</p>
<p>#ssh-copy-id -I ~/.ssh/id_rsa.pub root@172.16.88.3</p>
<p>[root@localhost ~]#ssh-keygen -t rsa -P “”<br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/root/.ssh/id_rsa):<br>Your identification has been saved in /root/.ssh/id_rsa.<br>Your public key has been saved in /root/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>2f:3d:fc:15:67:32:4d:89:59:6b:05:2c:73:bb:fe:51 root@localhost.localdomain<br>The key’s randomart image is:<br>+–[ RSA 2048]—-+<br>|             ..o.|<br>|            o <em> +|<br>|             </em> =.|<br>|              oo |<br>|        S     +.E|<br>|         +    .*.|<br>|        . =  … |<br>|         . o .. .|<br>|            .  ..|<br>+—————–+</p>
<p>[root@localhost ~]#ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.88.2<br>The authenticity of host ‘172.16.88.2 (172.16.88.2)’ can’t be established.<br>ECDSA key fingerprint is 75:9e:e0:a9:31:ce:cb:73:ed:8a:17:d6:9d:3d:6a:2b.<br>Are you sure you want to continue connecting (yes/no)? yes<br>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed – if you are prompted now it is to install the new keys<br>root@172.16.88.2’s password:</p>
<p>Number of key(s) added: 1</p>
<p>Now try logging into the machine, with:   “ssh ‘root@172.16.88.2’”<br>and check to make sure that only the key(s) you wanted were added.</p>
<p>[root@localhost ~]#ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.88.1<br>The authenticity of host ‘172.16.88.1 (172.16.88.1)’ can’t be established.<br>ECDSA key fingerprint is ce:2d:bd:83:46:37:94:45:27:2d:65:b8:71:f3:32:93.<br>Are you sure you want to continue connecting (yes/no)? yes<br>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed<br>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed – if you are prompted now it is to install the new keys<br>root@172.16.88.1’s password:</p>
<p>Number of key(s) added: 1</p>
<p>Now try logging into the machine, with:   “ssh ‘root@172.16.88.1’”<br>and check to make sure that only the key(s) you wanted were added.</p>
<p>设置名字解析；<br>[root@localhost ~]#scp /etc/hosts root@172.16.88.2:/etc/hosts<br>The authenticity of host ‘172.16.88.2 (172.16.88.2)’ can’t be established.<br>ECDSA key fingerprint is 75:9e:e0:a9:31:ce:cb:73:ed:8a:17:d6:9d:3d:6a:2b.<br>Are you sure you want to continue connecting (yes/no)? yes<br>Warning: Permanently added ‘172.16.88.2’ (ECDSA) to the list of known hosts.<br>root@172.16.88.2’s password:<br>hosts<br>[root@localhost ~]#cat /etc/hosts<br>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4<br>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6<br>172.16.88.1 node1.mageedu.com  node1<br>172.16.88.2 node2.mageedu.com  node2<br>172.16.88.3 node3.mageedu.com  node3<br>172.16.88.4 node4.mageedu.com  node4</p>
<p>定义管控的主机，编辑配置文件；<br>Vim /etc/ansible/hosts<br>[Websrvs]<br>172.16.88.2<br>172.16.88.3<br>[dbsrvs]<br>172.16.88.3</p>
<p>命令行；<br>列出控制的主机；<br>[root@localhost ansible]#ansible all -m ping –list-hosts<br>  hosts (2):<br>    172.16.88.1<br>    172.16.88.2<br>探测目标主机是否可频通；<br>[root@localhost ansible]#ansible all -m ping -C<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: false,<br>    “ping”: “pong”<br>}<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: false,<br>    “ping”: “pong”</p>
<p>[root@localhost ansible]#ansible-doc –help<br>Usage: ansible-doc [options] [module…]</p>
<p>Options:<br>  -h, –help            show this help message and exit<br>  -l, –list            List available modules<br>  -M MODULE_PATH, –module-path=MODULE_PATH<br>                        specify path(s) to module library (default=None)<br>  -s, –snippet         Show playbook snippet for specified module(s)<br>  -v, –verbose         verbose mode (-vvv for more, -vvvv to enable<br>                        connection debugging)<br>  –version             show program’s version number and exit</p>
<p>Ansible-doc -a  显示所有模块文档<br>Ansible-doc -l   列出所有可用模块<br>Ansible-doc -M<br>Ansible-doc -s  显示playbooks当中使用的选项；</p>
<pre><code>Ø group模块，查看定义组的选项；
</code></pre><p>[root@localhost ansible]#ansible-doc -s group</p>
<ul>
<li>name: Add or remove groups<br>action: group<pre><code>gid                    # Optional `GID&apos; to set for the group.
name=                  # Name of the group to manage.
state                  # Whether the group should be present or not on the remote host.
system                 # If `yes&apos;, indicates that the group created is a system group.
</code></pre>[root@localhost ansible]#</li>
</ul>
<p>State—可以创建或删除</p>
<p>Ansible all -m group -a “gid=1012 name=mygrp state=present system=no”</p>
<p>[root@localhost ~]#tail -1 /etc/group<br>mygrp:x:1012:</p>
<p>Ansible all -m group -a “gid=1012 name=mygrp state=absent system=no”</p>
<pre><code>Ø user模块，查看创建用户选项；
</code></pre><p>#Ansible-doc -s<br>Name=<br>Comment—注释信息<br>Expires——过期时间<br>Group——-基本组<br>Groups——附加组<br>Home——-家目录<br>Password—-密码<br>Shell———shell类型<br>State ——–创建，删除 persent,absent<br>System ———是否为系统用户<br>Uid———–用户id<br>Move home—-当创建家目录是原有的文件是否移动过来，等于no时创建新的家目录，原有的文件不会移动过来<br>Generate_ssh_key—创建用户是自动生成一对蜜钥，原来有蜜钥不会覆盖，重新创建一对蜜钥</p>
<p>创建用户，添加附加组<br>[root@localhost ansible]#ansible all -m user -a “uid=5000 name=testuser state=present system=no groups=mygrp shell=/bin/tcsh”<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “comment”: “”,<br>    “createhome”: true,<br>    “group”: 5000,<br>    “groups”: “mygrp”,<br>    “home”: “/home/testuser”,<br>    “name”: “testuser”,<br>    “shell”: “/bin/tcsh”,<br>    “state”: “present”,<br>    “system”: false,<br>    “uid”: 5000<br>}<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “comment”: “”,<br>    “createhome”: true,<br>    “group”: 5000,<br>    “groups”: “mygrp”,<br>    “home”: “/home/testuser”,<br>    “name”: “testuser”,<br>    “shell”: “/bin/tcsh”,<br>    “state”: “present”,<br>    “system”: false,<br>    “uid”: 5000<br>}</p>
<pre><code>Ø copy模块
</code></pre><p>[root@localhost ~]#ansible-doc -s copy<br>Ansible —-dest= 目标路径，远程主机的绝对路径<br>Ansible——–Src—–源可以相对，也可以是绝对的，源文件以斜线结尾、/ 将目录中的内容复制过去，不带斜线，将整个目录递归复制过去。<br>Ansible——-Owner属主<br>Ansible——-group属组<br>Ansible—-mode——–权限<br>Ansible——Remode src—从远程复制到远程<br>Ansible ——content —-指定内容生成目标文件生成的内容，不用指定src源文件；</p>
<p>拷贝内容到远程主机；<br>[root@localhost ansible]#ansible all -m copy -a  “ src=/etc/fstab dest=/tmp/fstab.ansibled mode=600 “<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “checksum”: “38e9d94be631342601af30347dca5d61ae09172c”,<br>    “dest”: “/tmp/fstab.ansibled”,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “md5sum”: “b91107d726fc7502b6d74ffce58a6dd0”,<br>    “mode”: “0600”,<br>    “owner”: “root”,<br>    “secontext”: “unconfined_u:object_r:admin_home_t:s0”,<br>    “size”: 541,<br>    “src”: “/root/.ansible/tmp/ansible-tmp-1505840510.12-83854192085881/source”,<br>    “state”: “file”,<br>    “uid”: 0<br>}<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “checksum”: “38e9d94be631342601af30347dca5d61ae09172c”,<br>    “dest”: “/tmp/fstab.ansibled”,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “md5sum”: “b91107d726fc7502b6d74ffce58a6dd0”,<br>    “mode”: “0600”,<br>    “owner”: “root”,<br>    “secontext”: “unconfined_u:object_r:admin_home_t:s0”,<br>    “size”: 541,<br>    “src”: “/root/.ansible/tmp/ansible-tmp-1505840510.12-83768663591640/source”,<br>    “state”: “file”,<br>    “uid”: 0<br>}</p>
<p>Ansible all -m copy -a “src=/etc/pam.d/ dest=/tmp/“<br>Ansible all -m copy -a “src=/etc/pam.d dest=/tmp/“<br>两种复制的区别在于，复制文件和复制目录</p>
<p>给定内容拷贝到远程主机；<br>[root@localhost ansible]#ansible all -m copy -a “content=’hi there\n’ dest=/tmp/hi.txt”<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “checksum”: “56170f5429b35dea081bb659b884b475ca9329a9”,<br>    “dest”: “/tmp/hi.txt”,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “md5sum”: “fd33e2e8ad3cb1bdd3ea8f5633fcf5c7”,<br>    “mode”: “0644”,<br>    “owner”: “root”,<br>    “secontext”: “unconfined_u:object_r:admin_home_t:s0”,<br>    “size”: 8,<br>    “src”: “/root/.ansible/tmp/ansible-tmp-1505841223.02-222568091857457/source”,<br>    “state”: “file”,<br>    “uid”: 0<br>}<br>将属主，属组改变为现有的testuser,mygrp<br>[root@localhost ansible]#ansible all -m copy -a “content=’hi there\n’ dest=/tmp/hi.txt owner=testuser group=mygrp”<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “checksum”: “279d9035886d4c0427549863c4c2101e4a63e041”,<br>    “dest”: “/tmp/hi.txt”,<br>    “gid”: 1032,<br>    “group”: “mygrp”,<br>    “mode”: “0644”,<br>    “owner”: “testuser”,<br>    “path”: “/tmp/hi.txt”,<br>    “secontext”: “unconfined_u:object_r:admin_home_t:s0”,<br>    “size”: 9,<br>    “state”: “file”,<br>    “uid”: 5000<br>}<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “checksum”: “279d9035886d4c0427549863c4c2101e4a63e041”,<br>    “dest”: “/tmp/hi.txt”,<br>    “gid”: 1032,<br>    “group”: “mygrp”,<br>    “mode”: “0644”,<br>    “owner”: “testuser”,<br>    “path”: “/tmp/hi.txt”,<br>    “secontext”: “unconfined_u:object_r:admin_home_t:s0”,<br>    “size”: 9,<br>    “state”: “file”,<br>    “uid”: 5000<br>}<br>没有创建的用户和组时将会出现错误；</p>
<pre><code>Ø fetch模块；
</code></pre><p>从远程主机复制文件到本地；远程主机不能指定多个。<br>    Ø command模块；<br>Ansible-doc -s command<br>在远程主机执行命令，<br>Ansible —–chdir 切换目录执行；<br>Ansible ——executable执行程序，执行命令有shell发起，指定shell类型；<br>Ansible —-free from  自有格式执行；</p>
<p>[root@localhost ansible]#ansible all -m command -a “ifconfig”<br>172.16.88.1 | SUCCESS | rc=0 &gt;&gt;<br>ens33: flags=4163<up,broadcast,running,multicast>  mtu 1500<br>        inet 192.168.226.150  netmask 255.255.255.0  broadcast 192.168.226.255<br>        inet6 fe80::cf19:b710:2fcd:be00  prefixlen 64  scopeid 0x20<link><br>        ether 00:0c:29:f6:4b:b1  txqueuelen 1000  (Ethernet)<br>        RX packets 3699  bytes 386609 (377.5 KiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 1201  bytes 197899 (193.2 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>172.16.88.2 | SUCCESS | rc=0 &gt;&gt;<br>ens33: flags=4163<up,broadcast,running,multicast>  mtu 1500<br>        inet 192.168.226.152  netmask 255.255.255.0  broadcast 192.168.226.255<br>        inet6 fe80::6f38:23ba:a34b:3a29  prefixlen 64  scopeid 0x20<link><br>        ether 00:0c:29:58:50:18  txqueuelen 1000  (Ethernet)<br>        RX packets 2593  bytes 258093 (252.0 KiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 450  bytes 68915 (67.2 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</up,broadcast,running,multicast></up,broadcast,running,multicast></p>
<p>切换目录并创建目录；<br>Ansible all -m command -a “chdir=/var/tmp  mkdir hi.dir”<br>[root@localhost ~]#ansible all -m command -a “chdir=/var/tmp/ mkdir hi.dir”<br>172.16.88.2 | SUCCESS | rc=0 &gt;&gt;</p>
<p>172.16.88.1 | SUCCESS | rc=0 &gt;&gt;</p>
<p>[root@localhost ~]#ansible all -m command -a “chdir=/var/tmp/ mkdir hi.dir”<br>172.16.88.1 | FAILED | rc=1 &gt;&gt;<br>mkdir: cannot create directory ‘hi.dir’: File exists</p>
<p>172.16.88.2 | FAILED | rc=1 &gt;&gt;<br>mkdir: cannot create directory ‘hi.dir’: File exists</p>
<p>不是幂等的，再次创建将会出现失败；</p>
<p>远程主机设置密码；<br>[root@localhost ~]#ansible all -m command -a “echo mageedu | password –stdin mageedu”<br>172.16.88.1 | SUCCESS | rc=0 &gt;&gt;<br>mageedu | password –stdin mageedu</p>
<p>172.16.88.2 | SUCCESS | rc=0 &gt;&gt;<br>mageedu | password –stdin mageedu</p>
<p>指定shell类型；<br>[root@localhost ~]#ansible all -m command -a “echo mageedu | password –stdin mageedu excutable=/bin/bash”<br>172.16.88.1 | SUCCESS | rc=0 &gt;&gt;<br>mageedu | password –stdin mageedu excutable=/bin/bash</p>
<p>172.16.88.2 | SUCCESS | rc=0 &gt;&gt;<br>mageedu | password –stdin mageedu excutable=/bin/bash</p>
<p>Command 无法解析|的功能，无法使用设置密码；</p>
<pre><code>Ø Ansible-doc -s shell
</code></pre><p>查看shell模块选项；</p>
<p>使用shell模块添加用户密码；<br>[root@localhost ~]#ansible all -m command -a “useradd mageedu”<br>172.16.88.2 | SUCCESS | rc=0 &gt;&gt;</p>
<p>172.16.88.1 | SUCCESS | rc=0 &gt;&gt;</p>
<p>[root@localhost ~]#ansible all -m shell -a “echo mageedu | passwd –stdin mageedu”<br>172.16.88.2 | SUCCESS | rc=0 &gt;&gt;<br>Changing password for user mageedu.<br>passwd: all authentication tokens updated successfully.</p>
<p>172.16.88.1 | SUCCESS | rc=0 &gt;&gt;<br>Changing password for user mageedu.<br>passwd: all authentication tokens updated successfully.</p>
<pre><code>Ø Ansible-doc -s file
</code></pre><p>创建目录；<br>Ansible all -m file -a “path=/var/tmp/hello.dir state=directory”</p>
<p>[root@localhost ~]#ansible all -m file -a “path=/var/tmp/hello.dir state=directory”<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “mode”: “0755”,<br>    “owner”: “root”,<br>    “path”: “/var/tmp/hello.dir”,<br>    “secontext”: “unconfined_u:object_r:user_tmp_t:s0”,<br>    “size”: 6,<br>    “state”: “directory”,<br>    “uid”: 0<br>}</p>
<p>创建文件；<br>[root@localhost ~]#ansible all -m file -a “path=/var/tmp/hello.txt state=file”<br>172.16.88.1 | FAILED! =&gt; {<br>    “changed”: false,<br>    “failed”: true,<br>    “msg”: “file (/var/tmp/hello.txt) is absent, cannot continue”,<br>    “path”: “/var/tmp/hello.txt”,<br>    “state”: “absent”<br>}<br>172.16.88.2 | FAILED! =&gt; {<br>    “changed”: false,<br>    “failed”: true,<br>    “msg”: “file (/var/tmp/hello.txt) is absent, cannot continue”,<br>    “path”: “/var/tmp/hello.txt”,<br>    “state”: “absent”<br>}<br>创建空文件，不建议使用file模块，使用copy命令，countent 为空，即可拷贝空文件；</p>
<p>file模块可以创建符号链接；<br>复制一个文件，创建符号链接；<br>[root@localhost ~]#ansible all -m copy -a “src=/etc/fstab dest=/var/tmp/fstab.ansible”<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “checksum”: “38e9d94be631342601af30347dca5d61ae09172c”,<br>    “dest”: “/var/tmp/fstab.ansible”,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “md5sum”: “b91107d726fc7502b6d74ffce58a6dd0”,<br>    “mode”: “0644”,<br>    “owner”: “root”,<br>    “secontext”: “unconfined_u:object_r:admin_home_t:s0”,<br>    “size”: 541,<br>    “src”: “/root/.ansible/tmp/ansible-tmp-1505911110.34-137908123845802/source”,<br>    “state”: “file”,<br>    “uid”: 0<br>}<br>创建符号链接；<br>[root@localhost ~]#ansible all -m file -a “src=/var/tmp/fstab.ansible dest=/var/tmp/fstab.link state=link”<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “dest”: “/var/tmp/fstab.link”,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “mode”: “0777”,<br>    “owner”: “root”,<br>    “secontext”: “unconfined_u:object_r:user_tmp_t:s0”,<br>    “size”: 22,<br>    “src”: “/var/tmp/fstab.ansible”,<br>    “state”: “link”,<br>    “uid”: 0<br>}<br>[root@localhost tmp]#ll<br>总用量 4<br>-rw-r–r–. 1 root root 541 9月  20 20:38 fstab.ansible<br>lrwxrwxrwx. 1 root root  22 9月  20 20:41 fstab.link -&gt; /var/tmp/fstab.ansible</p>
<p>指明目标符号链接，state=link</p>
<p>File 模块设定文件属性；<br>Group,mode,owner….</p>
<pre><code>Ø Ansible-doc -s cron
</code></pre><p>cron模块—定义计划任务；</p>
<p>[root@localhost ~]#ansible all -m cron -a “minute=*/3 job=’/usr/sbin/update 172.16.0.1 &amp;&gt; /dev/null’ “<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “envs”: [],<br>    “jobs”: [<br>        “None”<br>    ]<br>}</p>
<p>同步时间；<br>[root@localhost tmp]#crontab -l</p>
<p>#Ansible: None<br><em>/3 </em> <em> </em> * /usr/sbin/update 172.16.0.1 &amp;&gt; /dev/null<br>在node1上查看信息；</p>
<p>删除设定的任务；<br>[root@localhost ~]#ansible all -m cron -a “minute=<em>/3 job=’/usr/sbin/update 172.16.0.1 &amp;&gt; /dev/null’ state=absent”<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: false,<br>    “envs”: [],<br>    “jobs”: [<br>        “None”<br>    ]<br>}<br>需要指明名字；<br>[root@localhost ~]#ansible all -m cron -a “minute=</em>/3 job=’/usr/sbin/update 172.16.0.1 &amp;&gt;/dev/null’ name=None state=absent”<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “envs”: [],<br>    “jobs”: []<br>}<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “envs”: [],<br>    “jobs”: []<br>}<br>[root@localhost tmp]# crontab -l<br>[root@localhost tmp]#<br>删除设定任务成功；</p>
<pre><code>Ø Ansible-doc -s yum
</code></pre><p>Yum 模块<br>State= 选项—install(present , installed , latest)<br>都表示安装；<br>remove（absent , removed）–都表示卸载；<br>Disbalerepo 禁用某个仓库<br>Enablerepo 启用没偶个仓库<br>Disable_gpg_check 禁用秘钥检测</p>
<p>两个主机各自安装一个nginx;<br>[root@localhost ~]#ansible all -m yum -a “name=nginx state=installed”<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “msg”: “”,<br>    “rc”: 0,<br>    “results”: [<br>[root@localhost ~]#rpm -q nginx<br>nginx-1.10.2-1.el7.x86_64</p>
<pre><code>Ø Ansible-doc -s service
</code></pre><p>service模块；<br>[root@localhost ~]#ansible all -m service -a “name=nginx state=started  “<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “name”: “nginx”,<br>    “state”: “started”,<br>[root@localhost ~]#ansible all -m service -a “name=nginx state=stopped  “<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “name”: “nginx”,<br>    “state”: “stopped”,<br>查看剩余模块；<br>Ansible-doc -l|less</p>
<pre><code>Ø Ansible-doc -s script
</code></pre><p>script模块；<br>指定脚本路径，执行脚本<br>[root@localhost ~]#ansible all -m script -a “/tmp/test.sh”<br>172.16.88.1 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “rc”: 0,<br>    “stderr”: “Shared connection to 172.16.88.1 closed.\r\n”,<br>    “stdout”: “”,<br>    “stdout_lines”: []<br>}<br>172.16.88.2 | SUCCESS =&gt; {<br>    “changed”: true,<br>    “rc”: 0,<br>    “stderr”: “Shared connection to 172.16.88.2 closed.\r\n”,<br>    “stdout”: “”,<br>    “stdout_lines”: []<br>}<br>[root@localhost tmp]#cat /tmp/ansible.txt<br>ansible script<br>执行脚本在远程主机执行。</p>
]]></content>
      
        
        <tags>
            
            <tag> Ansible命令行中的应用 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mysql主从复制]]></title>
      <url>/2018/01/09/Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、将yum源、firewalld、Selinux、同步时间，相关设置配置完成；</span><br><span class="line">2、安装mysql(mariadb);</span><br><span class="line">3、准备两个虚拟机（note1,note2）;</span><br><span class="line">4、配置主从配置文件/etc/my.cnf.d/server.cnf</span><br><span class="line">5、在note1主服务器上创建MYSQL账户；</span><br><span class="line">6、note2从服务器开启复制功能，在note2从服务器上连接至主服务器;</span><br><span class="line">7、在 note1主服务器上创建数据库mydb及表格；</span><br><span class="line">8、查看从服务器是否已同步；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">编辑/etc/my.cnf.d/server.cnf</span><br><span class="line">note1;</span><br><span class="line">[mysqld]</span><br><span class="line">Server-id=1</span><br><span class="line">Log-bin=master-log</span><br><span class="line">Skip_name_resolve=ON</span><br><span class="line">note2；</span><br><span class="line">【mysqld】</span><br><span class="line">Server-id=2</span><br><span class="line">Relay-log=relay-log</span><br><span class="line">Skip_name_resolve=ON</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">主note1 ；创建Mysql账户</span><br><span class="line">[root@note1 mysql]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.52-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW MASTER STATUS;</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| master-log.000003 |      245 |              |                  |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; GRANT REPLICATION CLIENT, REPLICATION SLAVE ON *.* TO &apos;reluser&apos;@&apos;172.16.253.%&apos; IDENTIFIED BY &apos;replpass&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW MASTER STATUS;</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| master-log.000003 |      498 |              |                  |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW BINLOG EVENTS IN &apos;master-log.000003&apos;;</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Log_name          | Pos | Event_type  | Server_id | End_log_pos | Info                                                                                                    |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------+</span><br><span class="line">| master-log.000003 |   4 | Format_desc |         1 |         245 | Server ver: 5.5.52-MariaDB, Binlog ver: 4                                                               |</span><br><span class="line">| master-log.000003 | 245 | Query       |         1 |         423 | GRANT REPLICATION CLIENT, REPLICATION SLAVE ON *.* TO &apos;reluser&apos;@&apos;172.16.253.%&apos; IDENTIFIED BY &apos;replpass&apos; |</span><br><span class="line">| master-log.000003 | 423 | Query       |         1 |         498 | FLUSH PRIVILEGES                                                                                        |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------------------------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">note2;开启从服务器复制功能；</span><br><span class="line">[root@note2 mysql]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.52-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; help CHANGE MASTER TO</span><br><span class="line">Name: &apos;CHANGE MASTER TO&apos;</span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">CHANGE MASTER TO option [, option] ...</span><br><span class="line">MariaDB [(none)]&gt; CHANGE MASTER TO MASTER_HOST=&apos;172.16.253.10&apos;,MASTER_USER=&apos;reluser&apos;,MASTER_PASSWORD=&apos;replpass&apos;,MASTER_LOG_FILE=&apos;master_log.000003&apos;,MASTER_LOG_POS=496;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">MariaDB [(none)]&gt; SHOW SLAVE STATUS\G ---查看从服务器状态；</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State:</span><br><span class="line">                  Master_Host: 172.16.253.10</span><br><span class="line">                  Master_User: reluser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: master_log.000003</span><br><span class="line">          Read_Master_Log_Pos: 496</span><br><span class="line">               Relay_Log_File: relay-log.000001</span><br><span class="line">                Relay_Log_Pos: 4</span><br><span class="line">        Relay_Master_Log_File: master_log.000003</span><br><span class="line">             Slave_IO_Running: No------</span><br><span class="line">            Slave_SQL_Running: No----没有真正启动</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line">          Replicate_Ignore_DB:</span><br><span class="line">           Replicate_Do_Table:</span><br><span class="line">       Replicate_Ignore_Table:</span><br><span class="line">      Replicate_Wild_Do_Table:</span><br><span class="line">  Replicate_Wild_Ignore_Table:</span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error:</span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 496</span><br><span class="line">              Relay_Log_Space: 245</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File:</span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File:</span><br><span class="line">           Master_SSL_CA_Path:</span><br><span class="line">              Master_SSL_Cert:</span><br><span class="line">            Master_SSL_Cipher:</span><br><span class="line">               Master_SSL_Key:</span><br><span class="line">        Seconds_Behind_Master: NULL</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error:</span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error:</span><br><span class="line">  Replicate_Ignore_Server_Ids:</span><br><span class="line">             Master_Server_Id: 0</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; START SLAVE</span><br><span class="line">    -&gt; ;         ------------------启动复制；</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">MariaDB [(none)]&gt; SHOW SLAVE STATUS\G ---再一次查看状态；</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Connecting to master</span><br><span class="line">                  Master_Host: 172.16.253.10</span><br><span class="line">                  Master_User: reluser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: master_log.000003</span><br><span class="line">          Read_Master_Log_Pos: 496</span><br><span class="line">               Relay_Log_File: relay-log.000001</span><br><span class="line">                Relay_Log_Pos: 4</span><br><span class="line">        Relay_Master_Log_File: master_log.000003</span><br><span class="line">             Slave_IO_Running: Connecting------</span><br><span class="line">            Slave_SQL_Running: Yes-----已开启</span><br><span class="line">              Replicate_Do_DB:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@note2 ~]# cd /var/lib/mysql/</span><br><span class="line">[root@note2 mysql]# ls</span><br><span class="line">aria_log.00000001  ib_logfile0  mysql               relay-log.000001  test</span><br><span class="line">aria_log_control   ib_logfile1  mysql.sock          relay-log.index</span><br><span class="line">ibdata1            master.info  performance_schema  relay-log.info</span><br><span class="line">[root@note2 mysql]# cat master.info</span><br><span class="line">18</span><br><span class="line">master-log.000003</span><br><span class="line">496</span><br><span class="line">172.16.253.10</span><br><span class="line">repluser</span><br><span class="line">replpass</span><br><span class="line">3306</span><br><span class="line">60</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">1800.000</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">[root@note2 mysql]# cat relay-log.info</span><br><span class="line">./relay-log.000001</span><br><span class="line">4</span><br><span class="line">master-log.000003</span><br><span class="line">496</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">note1;主服务器创建数据库；</span><br><span class="line"> MariaDB [(none)]&gt; CREATE DATABASE mydb</span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use mydb;</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mydb]&gt; CREATE TABLE tbl1 (id INT,name CHAR(50));</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">MariaDB [mydb]&gt; INSERT INTO tbl1 VALUES (1,&apos;WU MING&apos;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">note2;从服务器查看；</span><br><span class="line">MariaDB [(none)]&gt; SHOW SLAVE STATUS\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Connecting to master</span><br><span class="line">                  Master_Host: 172.16.253.10</span><br><span class="line">                  Master_User: repluser</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: master-log.000003</span><br><span class="line">          Read_Master_Log_Pos: 496</span><br><span class="line">               Relay_Log_File: relay-log.000001</span><br><span class="line">                Relay_Log_Pos: 4</span><br><span class="line">        Relay_Master_Log_File: master-log.000003</span><br><span class="line">             Slave_IO_Running: Connecting</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line"></span><br><span class="line">#SHOW TABLES;</span><br><span class="line">#SELECT *FROM tbl1;</span><br></pre></td></tr></table></figure>
<p>```</p>
]]></content>
      
        
        <tags>
            
            <tag> Mysql主从复制 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mysqldump数据库恢复]]></title>
      <url>/2018/01/09/Mysqldump%E6%95%B0%E6%8D%AE%E5%BA%93%E6%81%A2%E5%A4%8D/</url>
      <content type="html"><![CDATA[<p>######知识点；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysqldump；</span><br><span class="line">innoDB;热备 、温备</span><br><span class="line">Myism; 温备</span><br><span class="line"></span><br><span class="line">#mysql TAB键补全可以看到mysql;</span><br><span class="line"></span><br><span class="line">Mysqldump options [db name]库  [tbl name]表</span><br><span class="line"></span><br><span class="line">mysqldump [OPTIONS] database [tables]</span><br><span class="line">				OR     mysqldump [OPTIONS] --databases [OPTIONS] DB1 [DB2 DB3...]</span><br><span class="line">				OR     mysqldump [OPTIONS] --all-databases [OPTIONS]</span><br><span class="line">三种备份方式；</span><br><span class="line">1、指定库或库的表，不用选项 ，单库同时可以指定表</span><br><span class="line">2、--databases 指定数据库名，指定多库</span><br><span class="line">3、--all-databases 指定全部数据库，全部备份</span><br><span class="line"></span><br><span class="line">将所有的数据文本化，如果将二进制数据文本化将丢失数据，所以不太理想；</span><br><span class="line">1、mysqldump能指定数据库备份；</span><br><span class="line">2、--databases 不能自己指定数据库恢复（在mysql中手动新创建数据库将备份的数据文件导入）</span><br><span class="line">备份多个库；</span><br><span class="line">#Mysqldump --databases mydb testdb mysql &gt;/tmp/mydb-testdb-mysql-fullbackup-$(date +%F-%H-%M-%S)</span><br><span class="line">Less /tmp/mydb-testdb-mysql ---TAB</span><br></pre></td></tr></table></figure></p>
<p>######简单mysql数据库恢复操作；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#mysqldump mydb ---备份mydb数据库</span><br><span class="line">#mysqldump mydb |less---查看数据库内容</span><br><span class="line"></span><br><span class="line">#mysqldump mydb &gt; /tmp/mydb-fullbackup-$(date +%F-%H-%M-%S)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ls  tmp</span><br><span class="line"></span><br><span class="line">#mysql</span><br><span class="line">create DATABASE TESTDB;</span><br><span class="line">exit</span><br><span class="line">#mysql&lt; /TMP/mydb-fullbackup_200</span><br><span class="line">#mysql testdb&lt;/tem/mydb-fullbackuo-2017-</span><br><span class="line">#mysql</span><br><span class="line">Use testdb;</span><br><span class="line">Show tables;</span><br><span class="line">SELECT * FROM  students ;</span><br><span class="line">Exit</span><br><span class="line">（熟悉命令）</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">myisam存储引擎；支持温备，备份时要锁定表；</span><br><span class="line">-x, --lock-all-tables;锁定所有库的所有表；</span><br><span class="line">-l, --lock-tables:锁定指定库所有表；</span><br><span class="line">InnaDB存储引擎；支持温备或热备；</span><br><span class="line">--single-transaction;创建一个事物，基于此快照执行备份；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第二节点；</span><br><span class="line">创建数据库；</span><br><span class="line">Mysql;</span><br><span class="line">#CRANT ALL ON *.* TO &apos;admin&apos;@&apos;172.16.0.%&apos; IDENTIFIED BY &apos;admin&apos;;</span><br><span class="line">#FLUSH PRIVILEGES;</span><br><span class="line"> #GRANT ALL ON *.* TO &apos;admin&apos;@&apos;%magedu.com&apos; IDENTIFIED BY &apos;admin&apos;;</span><br><span class="line"></span><br><span class="line">#FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">#EXIT</span><br><span class="line"></span><br><span class="line">节点一；</span><br><span class="line">Mysql -uadmin -172.16.0.68 -padmin &lt; /tmp/mydb-testdb-mysql-fullbackup-2017-…..</span><br><span class="line"></span><br><span class="line">节点二；</span><br><span class="line">#mysql</span><br><span class="line">SHOW DATABASES;</span><br><span class="line"></span><br><span class="line">节点一；</span><br><span class="line">#mysql;</span><br><span class="line">Use mydb;</span><br><span class="line">SHOW TABLE STATUS\G ----查看存储引擎命令；</span><br><span class="line">SHOW TABLE STATUS WHERE Engine=&apos;Innodb&apos;\G---过滤出Innodb存储引擎；</span><br><span class="line"></span><br><span class="line">SHOW TABLE STATUS WHERE Engine!=&apos;Innodb&apos;\G;----列出除Innodb引擎外的；</span><br><span class="line"></span><br><span class="line">没有除Innodb的引擎，就可以进行热备；</span><br><span class="line">Mysqldump --single-transaction --databases mydb----适用于单一的事物；----备份完成后自动关闭锁提交事务；</span><br><span class="line">热备，不影响线上业务；</span><br><span class="line"></span><br><span class="line">也可以使用温备；</span><br><span class="line">-x 锁定所有库的表；</span><br><span class="line">-l  锁定指定库的所有表；</span><br><span class="line">在线的热备必须加选项.</span><br><span class="line"></span><br><span class="line">其它选项；</span><br><span class="line"> -R，--routines; 备份指定库的存储过程和储存函数；</span><br><span class="line">--triggers ；        备份指定库的触发器；</span><br><span class="line">-E,--events ；        备份指定库的事件调度器；</span><br><span class="line"></span><br><span class="line">--master-data 此选项将备份的位置记录并将回放时自动从记录的位置往后回放；</span><br><span class="line">--flush-logs; 恢复完成后在mysql二进制日志中自动滚动，生成新的二进制日志；</span><br></pre></td></tr></table></figure>
<h6 id="完整备份方式；"><a href="#完整备份方式；" class="headerlink" title="完整备份方式；"></a>完整备份方式；</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">节点一；</span><br><span class="line">  1、连接mysql;</span><br><span class="line">#mysql</span><br><span class="line">FLUSH TABLE WITH READ LOCK;  ----锁定所有库</span><br><span class="line">FLUSH LOGS;                                    ----滚动一下二进制日志数据库</span><br><span class="line">SHOW MASTER LOGS;                   -----查看二进制日志有几个；</span><br><span class="line"></span><br><span class="line">SHOW MASTER STATUS;              ------现在处于那个文件的那个位置</span><br><span class="line">Exit;</span><br><span class="line"></span><br><span class="line">在命令行；</span><br><span class="line">#mysqldump -x -R -E --triggers --all-databases --master-data=1||2 |less       ----可以查看执行后的内容；</span><br><span class="line"></span><br><span class="line">1为创建数据库</span><br><span class="line">2为注释掉；</span><br><span class="line"></span><br><span class="line">#mysqldump -x -R -E --triggers --all-databases --master-data=2 --flush-logs &gt; /tmp/alldatabases-fullbackup-$(date +%F-%H-%M-%S)</span><br><span class="line"></span><br><span class="line">#less   /tmp/alldatabases-fullbackup-$(date +%F-%H-%M-%S                                -----查看备份的文件内容</span><br><span class="line"></span><br><span class="line">连入数据库；</span><br><span class="line">#mysql</span><br><span class="line">Use mydb</span><br><span class="line">CREATE TABLE teachers (tid INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,name VARCHAR(200));</span><br><span class="line"></span><br><span class="line">INSERT INTO teachers (name) VALUES (&apos;ouyang feng &apos;),(&apos;song jiang&apos;);</span><br><span class="line"></span><br><span class="line">HSOW MASTER STATUS</span><br><span class="line"></span><br><span class="line">EXIT</span><br><span class="line"></span><br><span class="line">#SYStemctl stop mariadb</span><br><span class="line">#Cd /var/lib/mysql</span><br><span class="line">#ll</span><br><span class="line">#mysqlbinlog master-log.000005----读一下二进制文件；</span><br><span class="line">在此前备份时以滚动过一次，所以000005二进制日志为新的二进制文件，备份时只需将000005二进制文件备份即可；</span><br><span class="line"></span><br><span class="line">#mysqlbinlog master-log.000005&gt; /tem/alldatabase-binlog</span><br><span class="line"></span><br><span class="line">模拟服务器崩溃；</span><br><span class="line">#Rm -rf /var/bin/mysql/*</span><br><span class="line">#cd /var/bin/mysql</span><br><span class="line">#ll</span><br><span class="line">#systemctl start mariadb</span><br><span class="line"></span><br><span class="line">连入mysql;</span><br><span class="line">#mysql</span><br><span class="line">SHOW DATABASES;</span><br><span class="line"></span><br><span class="line">当将备份文件写入时，不需要写入操作的二进制日志，将二进制日志关闭；</span><br><span class="line">Set @@session.sql_log_bin=OFF</span><br><span class="line">\. /tmp/alldatabases-fullbackup-$(date +%F-%H-%M-%S                                 ----将备份的文件导入；</span><br><span class="line"></span><br><span class="line">再将另一个二进制日志000005，导入到mysql中；</span><br><span class="line">Set @@session.sql_log_bin=OFF</span><br><span class="line">\. /tmp/alldatabases-fullbackup-000005</span><br><span class="line"></span><br><span class="line">Use mydb</span><br><span class="line">SHOW TABLES;</span><br><span class="line"></span><br><span class="line">SELECT * FROM teachers;</span><br><span class="line">Exit;</span><br><span class="line"></span><br><span class="line">命令行；</span><br><span class="line">Vim /etc/my.cf.d/server.cnf</span><br><span class="line">将二进制文件启用；</span><br><span class="line"></span><br><span class="line">二进制日志文件，可以再配置文件中修改启停，也可以在mysql连接中使用；</span><br><span class="line">Set @@session.sql_log_bin=ON||OFF</span><br><span class="line"></span><br><span class="line">恢复完成；</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> Mysqldump数据库恢复 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Xtrabackup对mysql进行备份及数据恢复]]></title>
      <url>/2018/01/09/Xtrabackup%E5%AF%B9mysql%E8%BF%9B%E8%A1%8C%E5%A4%87%E4%BB%BD%E5%8F%8A%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/</url>
      <content type="html"><![CDATA[<p>######xtrabackup对mysql进行备份，恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mysql启用状态；</span><br><span class="line">1、全量备份，恢复</span><br><span class="line">2、全量备份，增量备份，恢复</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">1、全量备份及模拟故障恢复；</span><br><span class="line"></span><br><span class="line">下载xtrabackup;</span><br><span class="line">[root@note2 ~]# lftp 172.16.0.1/pub</span><br><span class="line">cd 成功, 当前目录=/pub</span><br><span class="line">lftp 172.16.0.1:/pub&gt; cd Sources/7.x86_64/percona/</span><br><span class="line">lftp 172.16.0.1:/pub/Sources/7.x86_64/percona&gt; ls</span><br><span class="line">-rw-r--r--    1 0        0         7732612 Aug 21 09:15 percona-xtrabackup-24-2.4.7-2.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--    1 0        0          932280 Aug 21 09:15 percona-xtrabackup-test-2.3.2-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--    1 0        0        13568540 Aug 21 09:15 percona-xtrabackup-test-24-2.4.7-2.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--    1 0        0           28236 Aug 21 09:15 percona-zabbix-templates-1.1.7-2.noarch.rpm</span><br><span class="line">lftp 172.16.0.1:/pub/Sources/7.x86_64/percona&gt; mget percona-xtrabackup-24-2.4.7-2.el7.x86_64.rpm</span><br><span class="line">安装xtrabackup;</span><br><span class="line">[root@note2 ~]# yum install ./percona-xtrabackup-24-2.4.7-2.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">查看配置文件；</span><br><span class="line">[root@note2 ~]# rpm -ql percona-xtrabackup-24</span><br><span class="line">/usr/bin/innobackupex---------二次封装脚本</span><br><span class="line">/usr/bin/xbcloud--------------备份到云端的工具</span><br><span class="line">/usr/bin/xbcloud_osenv</span><br><span class="line">/usr/bin/xbcrypt--------------加密工具</span><br><span class="line">/usr/bin/xbstream-------------流式划工具</span><br><span class="line">/usr/bin/xtrabackup-----------主程序</span><br><span class="line">/usr/share/doc/percona-xtrabackup-24-2.4.7</span><br><span class="line">/usr/share/doc/percona-xtrabackup-24-2.4.7/COPYING</span><br><span class="line">/usr/share/man/man1/innobackupex.1.gz</span><br><span class="line">/usr/share/man/man1/xbcrypt.1.gz</span><br><span class="line">/usr/share/man/man1/xbstream.1.gz</span><br><span class="line">/usr/share/man/man1/xtrabackup.1.gz</span><br><span class="line"></span><br><span class="line">查看man帮助</span><br><span class="line">[root@note2 ~]# man innobackupex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">备份 全备；</span><br><span class="line">创建目录</span><br><span class="line">[root@note2 mariadb]# cd /var/lib/mysql</span><br><span class="line">[root@note2 mysql]# ls</span><br><span class="line">aria_log.00000001  ib_logfile1        mydb        note2-slow.log</span><br><span class="line">aria_log_control   master_log.000001  mysql       performance_schema</span><br><span class="line">ibdata1            master_log.000002  mysql.sock  test</span><br><span class="line">ib_logfile0        master_log.index   note2.log</span><br><span class="line">[root@note2 mysql]# mkdir /mydata/xbdata -pv</span><br><span class="line">备份；</span><br><span class="line">[root@note2 mysql]# innobackupex --user=root --host=localhost /mydata/xbdata/</span><br><span class="line">170912 20:14:28 innobackupex: Starting the backup operation</span><br><span class="line"></span><br><span class="line">IMPORTANT: Please check that the backup run completes successfully.</span><br><span class="line">           At the end of a successful backup run innobackupex</span><br><span class="line">           prints &quot;completed OK!&quot;.</span><br><span class="line">备份成功后会出现completed OK!否则没有成功；</span><br><span class="line"></span><br><span class="line">生成的备份文件；</span><br><span class="line">[root@note2 mysql]# ls /mydata/xbdata/</span><br><span class="line">2017-09-12_20-14-28---此目录下有相关配置文件；</span><br><span class="line">[root@note2 mysql]# ls /mydata/xbdata/2017-09-12_20-14-28/</span><br><span class="line">backup-my.cnf  performance_schema      xtrabackup_info</span><br><span class="line">ibdata1        test                    xtrabackup_logfile</span><br><span class="line">mydb           xtrabackup_binlog_info</span><br><span class="line">mysql          xtrabackup_checkpoints</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">模拟恢复数据，将mysql停掉；</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# less backup-my.cnf ^C</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# less xtrabackup_binlog_info ^C</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# less xtrabackup_checkpoints ^C</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# less xtrabackup_info ^C</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# systemctl stop mariadb.service</span><br><span class="line"></span><br><span class="line">将日志文件删除；</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# cd /var/lib/mysql</span><br><span class="line">[root@note2 mysql]# ls</span><br><span class="line">aria_log.00000001  ib_logfile1        mydb            performance_schema</span><br><span class="line">aria_log_control   master_log.000001  mysql           test</span><br><span class="line">ibdata1            master_log.000002  note2.log</span><br><span class="line">ib_logfile0        master_log.index   note2-slow.log</span><br><span class="line">[root@note2 mysql]# rm -rf ./*</span><br><span class="line"></span><br><span class="line">[root@note2 mysql]# cd /mydata/xbdata/</span><br><span class="line">[root@note2 xbdata]# cd /mydata/xbdata/2017-09-12_20-14-28/</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# ls</span><br><span class="line">backup-my.cnf  performance_schema      xtrabackup_info</span><br><span class="line">ibdata1        test                    xtrabackup_logfile</span><br><span class="line">mydb           xtrabackup_binlog_info</span><br><span class="line">mysql          xtrabackup_checkpoints</span><br><span class="line"></span><br><span class="line">执行准备操作；</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# innobackupex --apply-log ./</span><br><span class="line"></span><br><span class="line">InnoDB: 32 non-redo rollback segment(s) are active.</span><br><span class="line">InnoDB: Waiting for purge to start</span><br><span class="line">InnoDB: 5.7.13 started; log sequence number 2259989</span><br><span class="line">xtrabackup: starting shutdown with innodb_fast_shutdown = 1</span><br><span class="line">InnoDB: FTS optimize thread exiting.</span><br><span class="line">InnoDB: Starting shutdown...</span><br><span class="line">InnoDB: Shutdown completed; log sequence number 2260017</span><br><span class="line">170912 20:30:31 completed OK!</span><br><span class="line"></span><br><span class="line">还原；</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# innobackupex --copy-back ./</span><br><span class="line"></span><br><span class="line">170912 20:33:49 [01]        ...done</span><br><span class="line">170912 20:33:49 [01] Copying ./xtrabackup_binlog_pos_innodb to /var/lib/mysql/xtrabackup_binlog_pos_innodb</span><br><span class="line">170912 20:33:49 [01]        ...done</span><br><span class="line">170912 20:33:49 [01] Copying ./ibtmp1 to /var/lib/mysql/ibtmp1</span><br><span class="line">170912 20:33:49 [01]        ...done</span><br><span class="line">170912 20:33:49 completed OK!</span><br><span class="line"></span><br><span class="line">查看恢复回来的文件；</span><br><span class="line">[root@note2 2017-09-12_20-14-28]# cd /var/lib/mysql</span><br><span class="line">[root@note2 mysql]# ls</span><br><span class="line">ibdata1      ibtmp1  performance_schema            xtrabackup_info</span><br><span class="line">ib_logfile0  mydb    test</span><br><span class="line">ib_logfile1  mysql   xtrabackup_binlog_pos_innodb</span><br><span class="line"></span><br><span class="line">[root@note2 ~]# cd /var/lib/mysql/</span><br><span class="line">[root@note2 mysql]# ll</span><br><span class="line">总用量 40976</span><br><span class="line">-rw-r-----. 1 root  root  18874368 9月  12 20:33 ibdata1</span><br><span class="line">-rw-r-----. 1 root  root   5242880 9月  12 20:33 ib_logfile0</span><br><span class="line">-rw-r-----. 1 root  root   5242880 9月  12 20:33 ib_logfile1</span><br><span class="line">-rw-r-----. 1 root  root  12582912 9月  12 20:33 ibtmp1</span><br><span class="line">-rw-rw----. 1 mysql mysql        0 9月  12 20:39 master_log.index</span><br><span class="line">drwxr-x---. 2 root  root        59 9月  12 20:33 mydb</span><br><span class="line">drwxr-x---. 2 root  root      4096 9月  12 20:33 mysql</span><br><span class="line">drwxr-x---. 2 root  root      4096 9月  12 20:33 performance_schema</span><br><span class="line">drwxr-x---. 2 root  root        20 9月  12 20:33 test</span><br><span class="line">-rw-r-----. 1 root  root        24 9月  12 20:33 xtrabackup_binlog_pos_innodb</span><br><span class="line">-rw-r-----. 1 root  root       478 9月  12 20:33 xtrabackup_info</span><br><span class="line">属者，属组需要要改为mysql;</span><br><span class="line">[root@note2 mysql]# chown -R mysql.mysql ./*</span><br><span class="line"></span><br><span class="line">启动服务查看状态；</span><br><span class="line">[root@note2 mysql]# systemctl start mariadb</span><br><span class="line">[root@note2 mysql]# systemctl status mariadb</span><br><span class="line">● mariadb.service - MariaDB database server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 二 2017-09-12 20:51:58 CST; 39s ago</span><br><span class="line">  Process: 20637 ExecStartPost=/usr/libexec/mariadb-wait-ready $MAINPID (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 20609 ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 20636 (mysqld_safe)</span><br><span class="line">   CGroup: /system.slice/mariadb.service</span><br><span class="line">           ├─20636 /bin/sh /usr/bin/mysqld_safe --basedir=/usr</span><br><span class="line">           └─20806 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/m...</span><br><span class="line"></span><br><span class="line">9月 12 20:51:56 note2 systemd[1]: Starting MariaDB database server...</span><br><span class="line">9月 12 20:51:56 note2 mysqld_safe[20636]: 170912 20:51:56 mysqld_safe Lo....</span><br><span class="line">9月 12 20:51:56 note2 mysqld_safe[20636]: 170912 20:51:56 mysqld_safe St...l</span><br><span class="line">9月 12 20:51:58 note2 systemd[1]: Started MariaDB database server.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>
<p>```<br>2、全量备份，增量备份，模拟故障恢复；<br>在启动状态下备份；</p>
<p>[root@note2 mysql]# innobackupex /mydata/xbdata/<br>全量备份；</p>
<p>xtrabackup: Transaction log of lsn (2260017) to (2260017) was copied.<br>170912 20:57:00 completed OK!</p>
<p>查看日志序列号；<br>[root@note2 xbdata]# ls<br>2017-09-12_20-14-28  2017-09-12_20-56-58</p>
<p>[root@note2 xbdata]# cat /mydata/xbdata/2017-09-12_20-56-58/xtrabackup_checkpoints<br>backup_type = full-backuped<br>from_lsn = 0<br>to_lsn = 2260017<br>last_lsn = 2260017<br>compact = 0<br>recover_binlog_info = 0</p>
<p>删除学员信息，做增量备份；<br>[root@note2 ~]# mysql<br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection id is 5<br>Server version: 5.5.52-MariaDB MariaDB Server</p>
<p>Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</p>
<p>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.</p>
<p>MariaDB [(none)]&gt; use mydb<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</p>
<p>Database changed<br>MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=1300;<br>Query OK, 1 row affected (0.00 sec)</p>
<p>MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=1400;<br>Query OK, 1 row affected (0.00 sec)</p>
<p>MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=1500;<br>Query OK, 1 row affected (0.01 sec)</p>
<p>MariaDB [mydb]&gt;</p>
<p>增量基于谁做增量；incremental-basedir=/mydata/xbdata/2017-09-12_20-56-58/</p>
<p>[root@note2 ~]# ls /mydata/xbdata/<br>2017-09-12_20-14-28  2017-09-12_20-56-58<br>[root@note2 ~]# innobackupex –incremental /mydata/xtrdata –incremental-basedir=/mydata/xbdata/2017-09-12_20-<br>2017-09-12_20-14-28/ 2017-09-12_20-56-58/<br>[root@note2 ~]# innobackupex –incremental /data/backups –incremental-basedir=/mydata/xbdata/2017-09-12_20-56-58/</p>
<p>查看增量；<br>[root@note2 ~]# ls /mydata/xbdata/<br>2017-09-12_20-14-28  2017-09-12_20-56-58  2017-09-12_21-11-23</p>
<p>[root@note2 2017-09-12_21-11-23]# ls<br>backup-my.cnf  mysql                   xtrabackup_checkpoints<br>ibdata1.delta  performance_schema      xtrabackup_info<br>ibdata1.meta   test                    xtrabackup_logfile<br>mydb           xtrabackup_binlog_info</p>
<p>[root@note2 2017-09-12_21-11-23]# cat xtrabackup_checkpoints<br>backup_type = incremental<br>from_lsn = 2260017<br>to_lsn = 2262366<br>last_lsn = 2262366<br>compact = 0<br>recover_binlog_info = 0</p>
<p>上一个全量备份日志序列号与增量对序列号对比<br>；<br>[root@note2 xbdata]# cat 2017-09-12_20-56-58/xtrabackup_checkpoints<br>backup_type = full-backuped<br>from_lsn = 0<br>to_lsn = 2260017<br>last_lsn = 2260017<br>compact = 0<br>recover_binlog_info = 0</p>
<p>在创建一个学生列表；并删除；<br>MariaDB [mydb]&gt; INSERT INTO students (name) VALUES (‘JIAO DA’);<br>MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=3001;<br>Query OK, 1 row affected (0.00 sec)</p>
<p>查看最后增量；<br>[root@note2 xbdata]# ls<br>2017-09-12_20-14-28  2017-09-12_20-56-58  2017-09-12_21-11-23<br>[root@note2 xbdata]# cat 2017-09-12_21-11-23/xtrabackup_info<br>uuid = e172b661-97bb-11e7-b798-000c2980ce95<br>name =<br>tool_name = innobackupex<br>tool_command = –incremental /mydata/xbdata/ –incremental-basedir=/mydata/xbdata/2017-09-12_20-56-58/<br>tool_version = 2.4.7<br>ibbackup_version = 2.4.7<br>server_version = 5.5.52-MariaDB<br>start_time = 2017-09-12 21:11:23<br>end_time = 2017-09-12 21:11:25<br>lock_time = 0<br>binlog_pos = filename ‘master_log.000001’, position ‘830’<br>innodb_from_lsn = 2260017<br>innodb_to_lsn = 2262366<br>partial = N<br>incremental = Y<br>format = file<br>compact = N<br>compressed = N<br>encrypted = N<br>[root@note2 xbdata]# mysqlbinlog -j 830 /var/lib/mysql/master_log.000001<br>/<em>!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1</em>/;<br>/<em>!40019 SET @@session.max_insert_delayed_threads=0</em>/;<br>/<em>!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0</em>/;<br>DELIMITER /<em>!</em>/;</p>
<h1 id="at-4"><a href="#at-4" class="headerlink" title="at 4"></a>at 4</h1><p>#170912 20:51:57 server id 1  end_log_pos 245   Start: binlog v 4, server v 5.5.52-MariaDB created 170912 20:51:57 at startup</p>
<h1 id="Warning-this-binlog-is-either-in-use-or-was-not-closed-properly"><a href="#Warning-this-binlog-is-either-in-use-or-was-not-closed-properly" class="headerlink" title="Warning: this binlog is either in use or was not closed properly."></a>Warning: this binlog is either in use or was not closed properly.</h1><p>ROLLBACK/<em>!</em>/;<br>BINLOG ‘<br>bdi3WQ8BAAAA8QAAAPUAAAABAAQANS41LjUyLU1hcmlhREIAbG9nAAAAAAAAAAAAAAAAAAAAAAAA<br>AAAAAAAAAAAAAAAAAABt2LdZEzgNAAgAEgAEBAQEEgAA2QAEGggAAAAICAgCAAAAAAAAAAAAAAAA<br>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA<br>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA<br>AAAAAAAAAAAAi0NoCA==<br>‘/<em>!</em>/;</p>
<p>创建临时文件；<br>[root@note2 xbdata]# mkdir /mydata/binlogs</p>
<p>将增量内容保存；<br>[root@note2 xbdata]# mysqlbinlog -j 830 /var/lib/mysql/master_log.000001 &gt;/mydata/binlogs/2017-09-12_21-11-23-binlog</p>
<p>模拟故障，停止服务；<br>[root@note2 xbdata]# systemctl stop mariadb<br>[root@note2 xbdata]# cd<br>[root@note2 ~]# rm -rf /var/lib/mysql/*</p>
<p>恢复；<br>1、同步、重做功能；</p>
<p>[root@note2 xbdata]# ls<br>2017-09-12_20-14-28  2017-09-12_20-56-58  2017-09-12_21-11-23<br>[root@note2 xbdata]# cd 2017-09-12_20-56-58/<br>[root@note2 2017-09-12_20-56-58]# innobackupex –apply-log –redo-only  ./</p>
<p>和并增量；<br>[root@note2 2017-09-12_20-56-58]# innobackupex –apply-log –redo-only ./ –incremental-dir=/mydata/xbdata/2017-09-12_21-11-23/</p>
<p>检查全量备份有无改动；<br>[root@note2 2017-09-12_20-56-58]# cat xtrabackup_checkpoints<br>backup_type = log-applied<br>from_lsn = 0<br>to_lsn = 2262366<br>last_lsn = 2262366<br>compact = 0<br>recover_binlog_info = 0</p>
<p>最后回滚；<br>[root@note2 2017-09-12_20-56-58]# innobackupex –apply-log ./</p>
<p>InnoDB: Setting file ‘./ibtmp1’ size to 12 MB. Physically writing the file full; Please wait …<br>InnoDB: File ‘./ibtmp1’ size is now 12 MB.<br>InnoDB: 96 redo rollback segment(s) found. 1 redo rollback segment(s) are active.<br>InnoDB: 32 non-redo rollback segment(s) are active.<br>InnoDB: Waiting for purge to start<br>InnoDB: 5.7.13 started; log sequence number 2262577<br>xtrabackup: starting shutdown with innodb_fast_shutdown = 1<br>InnoDB: FTS optimize thread exiting.<br>InnoDB: Starting shutdown…<br>InnoDB: Shutdown completed; log sequence number 2262596<br>170912 22:18:20 completed OK!</p>
<p>恢复<br>[root@note2 2017-09-12_20-56-58]# innobackupex –copy-back ./<br>170912 22:21:24 [01]        …done<br>170912 22:21:24 [01] Copying ./xtrabackup_binlog_pos_innodb to /var/lib/mysql/xtrabackup_binlog_pos_innodb<br>170912 22:21:24 [01]        …done<br>170912 22:21:24 [01] Copying ./xtrabackup_info to /var/lib/mysql/xtrabackup_info<br>170912 22:21:24 [01]        …done<br>170912 22:21:24 [01] Copying ./ibtmp1 to /var/lib/mysql/ibtmp1<br>170912 22:21:24 [01]        …done<br>170912 22:21:24 completed OK!</p>
<p>查看文件所属；<br>[root@note2 2017-09-12_20-56-58]# cd /var/lib/mysql<br>[root@note2 mysql]# ll<br>总用量 40976<br>-rw-r—–. 1 root root 18874368 9月  12 22:21 ibdata1<br>-rw-r—–. 1 root root  5242880 9月  12 22:21 ib_logfile0<br>-rw-r—–. 1 root root  5242880 9月  12 22:21 ib_logfile1<br>-rw-r—–. 1 root root 12582912 9月  12 22:21 ibtmp1<br>drwxr-x—. 2 root root       59 9月  12 22:21 mydb<br>drwxr-x—. 2 root root     4096 9月  12 22:21 mysql<br>drwxr-x—. 2 root root     4096 9月  12 22:21 performance_schema<br>drwxr-x—. 2 root root       20 9月  12 22:21 test<br>-rw-r—–. 1 root root       24 9月  12 22:21 xtrabackup_binlog_pos_innodb<br>-rw-r—–. 1 root root      527 9月  12 22:21 xtrabackup_info</p>
<p>更改所属者，所属组；<br>[root@note2 mysql]# chown -R mysql.mysql ./*<br>[root@note2 mysql]# ll<br>总用量 40976<br>-rw-r—–. 1 mysql mysql 18874368 9月  12 22:21 ibdata1<br>-rw-r—–. 1 mysql mysql  5242880 9月  12 22:21 ib_logfile0<br>-rw-r—–. 1 mysql mysql  5242880 9月  12 22:21 ib_logfile1<br>-rw-r—–. 1 mysql mysql 12582912 9月  12 22:21 ibtmp1<br>drwxr-x—. 2 mysql mysql       59 9月  12 22:21 mydb<br>drwxr-x—. 2 mysql mysql     4096 9月  12 22:21 mysql<br>drwxr-x—. 2 mysql mysql     4096 9月  12 22:21 performance_schema<br>drwxr-x—. 2 mysql mysql       20 9月  12 22:21 test<br>-rw-r—–. 1 mysql mysql       24 9月  12 22:21 xtrabackup_binlog_pos_innodb<br>-rw-r—–. 1 mysql mysql      527 9月  12 22:21 xtrabackup_info</p>
<p>启动服务；<br>[root@note2 mysql]# systemctl start mariadb<br>[root@note2 mysql]# mysql<br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection id is 2<br>Server version: 5.5.52-MariaDB MariaDB Server</p>
<p>Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</p>
<p>Type ‘help;’ or ‘\h’ for help. Type ‘\c’ to clear the current input statement.</p>
<p>MariaDB [(none)]&gt; use mydb<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A</p>
<p>Database changed<br>MariaDB [mydb]&gt; SELECT * FROM students WHERE stuid=1200;<br>+——-+———+——+——–+———–+<br>| stuid | name    | age  | gender | major     |<br>+——-+———+——+——–+———–+<br>|  1200 | stu1200 |   74 | M      | major1200 |<br>+——-+———+——+——–+———–+<br>1 row in set (0.00 sec)</p>
<p>MariaDB [mydb]&gt; SELECT * FROM students WHERE stuid=1300;<br>Empty set (0.00 sec)</p>
<p>MariaDB [mydb]&gt; SELECT * FROM students WHERE stuid=1400;<br>Empty set (0.00 sec)</p>
<p>关掉二进制日志；<br>MariaDB [mydb]&gt; SET @@session.sql_log_bin=OFF;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>MariaDB [mydb]&gt; . /mydata/binlogs/2017-09-12_21-11-23-binlog<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Charset changed<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Database changed<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 1 row affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.01 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 1 row affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>Query OK, 0 rows affected (0.00 sec)</p>
<p>MariaDB [mydb]&gt; SET @@session.sql_log_bin=ON;<br>Query OK, 0 rows affected (0.00 sec)</p>
<p>在做一次全量备份；</p>
<p>innobackupex –user=DBUSER –password=DBUSERPASS /PATH/TO/BACKUP-DIR/</p>
]]></content>
      
        
        <tags>
            
            <tag> 数据备份及数据恢复 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[创建mysql数据库索引]]></title>
      <url>/2018/01/09/%E5%88%9B%E5%BB%BAmysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br><span class="line"></span><br><span class="line">创建数据库</span><br><span class="line">CREATE DATABASE mydb;</span><br><span class="line"></span><br><span class="line">使用数据库</span><br><span class="line">use mydb;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建表格</span><br><span class="line">CREATE TABLE students (stuid INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,name VARCHAR(200),age TINYINT UNSIGNED,gender ENUM(&apos;F&apos;,&apos;M&apos;),major VARCHAR(200));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">添加键值</span><br><span class="line"> INSERT INTO students (name,age,gender,major) VALUES(&apos;jia baoyu&apos;,17,&apos;M&apos;,&apos;pixie jianfa&apos;),(&apos;linchong&apos;,37,&apos;M&apos;,&apos;xianglong shiba zhang&apos;),(&apos;XImen&apos;,31,&apos;M&apos;,&apos;kuihua baodian&apos;),(&apos;linchong&apos;,27,&apos;F&apos;,&apos;wuxiang shengong&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">列出表格</span><br><span class="line"> SELECT * FROM students;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">添加键值</span><br><span class="line"> for i in &#123;5..1000&#125;;do mysql -e &quot;INSERT INTO mydb.students VALUES (&apos;$i&apos;,&apos;stu$i&apos;,$[$RANDOM%100+1],&apos;F&apos;,&apos;major$i&apos;)&quot;;done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in &#123;1001..2000&#125;;do mysql -e &quot;INSERT INTO mydb.students VALUES (&apos;$i&apos;,&apos;stu$i&apos;,$[$RANDOM%100+1],&apos;M&apos;,&apos;major$i&apos;)&quot;;done</span><br><span class="line"></span><br><span class="line">for i in &#123;2001..3000&#125;;do mysql -e &quot;INSERT INTO mydb.students VALUES (&apos;$i&apos;,&apos;stu$i&apos;,$[$RANDOM%100+1],&apos;M&apos;,&apos;major$i&apos;)&quot;;done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看大于等于15年龄的段落</span><br><span class="line"></span><br><span class="line">SELECT name,age FROM students WHERE age&gt;= 15;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查询到数据的来源（如在那个表，标的类型）</span><br><span class="line"> EXPLAIN SELECT name,age FROM students WHERE age&gt;= 15;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EXPLAIN SELECT *FROM students  WHERE name = &apos;stu1002&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查询数量   计算学号count(stuid)</span><br><span class="line">SELECT count(stuid) FROM students;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建缩影，</span><br><span class="line">CREATE INDEX name ON students(name);</span><br><span class="line">查看缩影</span><br><span class="line">SHOW INDEXES FROM students---生成stuid主键缩影和name缩影</span><br><span class="line"></span><br><span class="line">再次查询name=stu1002的内容；</span><br><span class="line"></span><br><span class="line">EXPLAIN SELECT *FROM students WHERE name= &apos;stu1002&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查询包含100的行数有多少；</span><br><span class="line"> EXPLAIN SELECT * FROM students WHERE name LIKE &apos;stu100%&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建name和age的缩影</span><br><span class="line">CREATE INDEX name_and_age ON students(name,age);</span><br><span class="line">查看生成的缩影类型；</span><br><span class="line"> EXPLAIN SELECT * FROM students WHERE name LIKE &apos;STU100%&apos;</span><br><span class="line"></span><br><span class="line">单个条件搜索时；</span><br><span class="line">MariaDB [mydb]&gt; EXPLAIN SELECT * FROM students WHERE age &gt;= 50;</span><br><span class="line">+------+-------------+----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">| id   | select_type | table    | type | possible_keys | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+------+-------------+----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">|    1 | SIMPLE      | students | ALL  | NULL          | NULL | NULL    | NULL | 3714 | Using where |</span><br><span class="line">+------+-------------+----------+------+---------------+------+---------+------+------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">两个条件搜索时；</span><br><span class="line">MariaDB [mydb]&gt; EXPLAIN SELECT * FROM students WHERE name LIKE &apos;stu%&apos; AND age &gt;=50;</span><br><span class="line">+------+-------------+----------+------+-------------------+------+---------+------+------+-------------+</span><br><span class="line">| id   | select_type | table    | type | possible_keys     | key  | key_len | ref  | rows | Extra       |</span><br><span class="line">+------+-------------+----------+------+-------------------+------+---------+------+------+-------------+</span><br><span class="line">|    1 | SIMPLE      | students | ALL  | name,name_and_age | NULL | NULL    | NULL | 3714 | Using where |</span><br><span class="line">+------+-------------+----------+------+-------------------+------+---------+------+------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">CREATE INDEX name_and_age ON students(name,age);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">联合查询；判断年龄与序号</span><br><span class="line"> SELECT * FROM students WHERE age &gt;=99 UNION SELECT * FROM  students WHERE  name LIKE ;stu;NION SELECT * FROM  students WHERE  name LIKE &apos;stu100%&apos;;</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 创建mysql数据库索引 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[mysql日志]]></title>
      <url>/2018/01/09/mysql%E6%97%A5%E5%BF%97/</url>
      <content type="html"><![CDATA[<p>######日志：</p>
<pre><code>查询日志：general_log
慢查询日志：log_slow_queries
错误日志：log_error， log_warnings
二进制日志：binlog
中继日志：relay_log
事务日志：innodb_log
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br></pre></td><td class="code"><pre><span class="line">查看查询日状态，是否开启及日志输出到的文件路径位置；相对路径 note2.log</span><br><span class="line">show global variables like &apos;general%&apos; ;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| Variable_name    | Value     |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| general_log      | OFF       |</span><br><span class="line">| general_log_file | note2.log |</span><br><span class="line">+------------------+-----------+</span><br><span class="line"></span><br><span class="line">日志输出到的位置FILE类型；</span><br><span class="line">MariaDB [mydb]&gt; SHOW GLOBAL VARIABLES LIKE &apos;log_output&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_output    | FILE  |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">开启查询日志功能；</span><br><span class="line">MariaDB [mydb]&gt; SET GLOBAL general_log=ON;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看日志文件类型；FILE</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; SHOW GLOBAL VARIABLES LIKE &apos;log_output&apos;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_output    | FILE  |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看查询日志是否开，与日志保存路径；</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; SHOW GLOBAL VARIABLES LIKE &apos;general%&apos;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| Variable_name    | Value     |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| general_log      | ON        |</span><br><span class="line">| general_log_file | note2.log |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">开启查询语句后；当查询会生成日志；</span><br><span class="line">MariaDB [mydb]&gt; SELECT * FROM mydb.students WHERE stuid=3;</span><br><span class="line">+-------+-------+------+--------+----------------+</span><br><span class="line">| stuid | name  | age  | gender | major          |</span><br><span class="line">+-------+-------+------+--------+----------------+</span><br><span class="line">|     3 | XImen |   31 | M      | kuihua baodian |</span><br><span class="line">+-------+-------+------+--------+----------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">查看生成的日志；</span><br><span class="line">[root@note2 mysql]# tail note2.log</span><br><span class="line">/usr/libexec/mysqld, Version: 5.5.52-MariaDB (MariaDB Server). started with:</span><br><span class="line">Tcp port: 3306  Unix socket: /var/lib/mysql/mysql.sock</span><br><span class="line">Time                 Id Command    Argument</span><br><span class="line">170912 14:41:28     2 Query     SHOW GLOBAL VARIABLES LIKE &apos;log_output&apos;</span><br><span class="line">170912 14:42:23     2 Query     SHOW GLOBAL VARIABLES LIKE &apos;general%&apos;</span><br><span class="line">170912 14:53:42     2 Query     SELECT * FROM mydb.students WHERE stuid=3</span><br><span class="line"></span><br><span class="line">更改表的存放形式；table</span><br><span class="line">MariaDB [mydb]&gt; SET @@global.log_output=&apos;TABLE&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看查询日志的输出到的位置；</span><br><span class="line">MariaDB [mydb]&gt; SHOW GLOBAL VARIABLES LIKE &apos;log_output&apos;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_output    | TABLE |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查询生成的日志；</span><br><span class="line">MariaDB [mydb]&gt; SELECT * FROM mysql.general_log;</span><br><span class="line">+----------------------------+---------------------------+-----------+-----------+--------------+-----------------------------------------+</span><br><span class="line">| event_time                 | user_host                 | thread_id | server_id | command_type | argument                                |</span><br><span class="line">+----------------------------+---------------------------+-----------+-----------+--------------+-----------------------------------------+</span><br><span class="line">| 2017-09-12 15:14:57.591377 | root[root] @ localhost [] |         2 |         0 | Query        | SELECT * FROM mysql.general_log         |</span><br><span class="line">| 2017-09-12 15:16:21.876954 | root[root] @ localhost [] |         2 |         0 | Query        | SHOW GLOBAL VARIABLES LIKE &apos;log_output&apos; |</span><br><span class="line">| 2017-09-12 15:18:39.473597 | root[root] @ localhost [] |         2 |         0 | Query        | SELECT * FROM mysql.general_log         |</span><br><span class="line">+----------------------------+---------------------------+-----------+-----------+--------------+-----------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">关闭查询日志功能；</span><br><span class="line">MariaDB [mydb]&gt; SET @@global.general_log=OFF</span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">显示所有的数据库</span><br><span class="line">MariaDB [mydb]&gt; SHOW DATABASES</span><br><span class="line">    -&gt; ;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mydb               |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">使用数据库</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; USE mysql</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">列出数据库列表</span><br><span class="line">MariaDB [mysql]&gt; SHOW TABLES</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------------------------+</span><br><span class="line">| Tables_in_mysql           |</span><br><span class="line">+---------------------------+</span><br><span class="line">| columns_priv              |</span><br><span class="line">| db                        |</span><br><span class="line">| event                     |</span><br><span class="line">| func                      |</span><br><span class="line">| general_log               |</span><br><span class="line">| help_category             |</span><br><span class="line">| help_keyword              |</span><br><span class="line">| help_relation             |</span><br><span class="line">| help_topic                |</span><br><span class="line">| host                      |</span><br><span class="line">| ndb_binlog_index          |</span><br><span class="line">| plugin                    |</span><br><span class="line">| proc                      |</span><br><span class="line">| procs_priv                |</span><br><span class="line">| proxies_priv              |</span><br><span class="line">| servers                   |</span><br><span class="line">| slow_log                  |</span><br><span class="line">| tables_priv               |</span><br><span class="line">| time_zone                 |</span><br><span class="line">| time_zone_leap_second     |</span><br><span class="line">| time_zone_name            |</span><br><span class="line">| time_zone_transition      |</span><br><span class="line">| time_zone_transition_type |</span><br><span class="line">| user                      |</span><br><span class="line">+---------------------------+</span><br><span class="line">24 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看慢查询日志的状态；</span><br><span class="line">MariaDB [mysql]&gt; SHOW  GLOBAL VARIABLES LIKE &apos;%slow%&apos;;</span><br><span class="line">+---------------------+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Variable_name       | Value                                                                                                        |</span><br><span class="line">+---------------------+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| log_slow_filter     | admin,filesort,filesort_on_disk,full_join,full_scan,query_cache,query_cache_miss,tmp_table,tmp_table_on_disk |</span><br><span class="line">| log_slow_queries    | OFF                                                                                                          |</span><br><span class="line">| log_slow_rate_limit | 1                                                                                                            |</span><br><span class="line">| log_slow_verbosity  |                                                                                                              |</span><br><span class="line">| slow_launch_time    | 2                                                                                                            |</span><br><span class="line">| slow_query_log      | OFF                                                                                                          |</span><br><span class="line">| slow_query_log_file | note2-slow.log                                                                                               |</span><br><span class="line">+---------------------+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">开启慢查询日志；</span><br><span class="line">MariaDB [mysql]&gt; SET GLOBAL slow_query_log=ON</span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">开启后使用上条命令查看状态；</span><br><span class="line">SHOW GLOBAL VARIABLES LIKE &apos;%slow%&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">想要将文件保存在文件中需修改文件类型；</span><br><span class="line">MariaDB [mysql]&gt; SET @@GLOBAL.log_output=&apos;FILE&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">关闭慢查询，查看状态；</span><br><span class="line">MariaDB [mysql]&gt; SET @@global.log_slow_queries=OFF;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; SHOW GLOBAL VARIABLES LIKE &apos;%slow%&apos;;</span><br><span class="line">+---------------------+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Variable_name       | Value                                                                                                        |</span><br><span class="line">+---------------------+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| log_slow_filter     | admin,filesort,filesort_on_disk,full_join,full_scan,query_cache,query_cache_miss,tmp_table,tmp_table_on_disk |</span><br><span class="line">| log_slow_queries    | OFF                                                                                                          |</span><br><span class="line">| log_slow_rate_limit | 1                                                                                                            |</span><br><span class="line">| log_slow_verbosity  |                                                                                                              |</span><br><span class="line">| slow_launch_time    | 2                                                                                                            |</span><br><span class="line">| slow_query_log      | OFF                                                                                                          |</span><br><span class="line">| slow_query_log_file | note2-slow.log                                                                                               |</span><br><span class="line">+---------------------+--------------------------------------------------------------------------------------------------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查询错误日志状态；</span><br><span class="line">当在log_error对应位置有文件路径即表示一起用，没有文件历经为off时为关闭状态；</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; SHOW GLOBAL VARIABLES LIKE &apos;%error%&apos;;</span><br><span class="line">+--------------------+------------------------------+</span><br><span class="line">| Variable_name      | Value                        |</span><br><span class="line">+--------------------+------------------------------+</span><br><span class="line">| log_error          | /var/log/mariadb/mariadb.log |</span><br><span class="line">| max_connect_errors | 10                           |</span><br><span class="line">| max_error_count    | 64                           |</span><br><span class="line">| slave_skip_errors  | OFF                          |</span><br><span class="line">+--------------------+------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看错误日志；</span><br><span class="line"># tail /var/log/mariadb/mariadb.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">二进制文件；</span><br><span class="line">基于时间戳而改变；</span><br><span class="line">二进制日志文件；分为两种；</span><br><span class="line">STATEMENT;语句---记录结果</span><br><span class="line">ROW;行---详细</span><br><span class="line">一般记录结果，节约空间；</span><br><span class="line">MIXED;以上两种为混编方式；</span><br><span class="line"></span><br><span class="line">查看使用那种类型记录日志；</span><br><span class="line">MariaDB [mysql]&gt; SHOW GLOBAL VARIABLES LIKE &apos;binlog_format&apos;;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| Variable_name | Value     |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| binlog_format | STATEMENT |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看是否启用日志；</span><br><span class="line">MariaDB [mysql]&gt; SHOW MASTER LOGS;</span><br><span class="line">ERROR 1381 (HY000): You are not using binary logging</span><br><span class="line"></span><br><span class="line">没有启动二进制日志文件，需要编写配置文件；</span><br><span class="line">vim /etc/my.cnf.d/server.cnf</span><br><span class="line"></span><br><span class="line">mysql位置添加；</span><br><span class="line">log_bin=master_log</span><br><span class="line">并重启服务；</span><br><span class="line">systemctl restart mariadb.service</span><br><span class="line"></span><br><span class="line">重新连接，并查看二进制日志是否启用；</span><br><span class="line">[root@note2 ~]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 2</span><br><span class="line">Server version: 5.5.52-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW GLOBAL VARIABLES LIKE &apos;%log%bin%&apos;;</span><br><span class="line">+---------------------------------+-------+</span><br><span class="line">| Variable_name                   | Value |</span><br><span class="line">+---------------------------------+-------+</span><br><span class="line">| log_bin                         | ON    |</span><br><span class="line">| log_bin_trust_function_creators | OFF   |</span><br><span class="line">| sql_log_bin                     | ON    |</span><br><span class="line">+---------------------------------+-------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">启用后二进制文件，使用的那个文件；</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW MASTER LOGS</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-------------------+-----------+</span><br><span class="line">| Log_name          | File_size |</span><br><span class="line">+-------------------+-----------+</span><br><span class="line">| master_log.000001 |       245 |</span><br><span class="line">+-------------------+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看当前使用的二年进制文件；</span><br><span class="line">MariaDB [(none)]&gt; SHOW MASTER STATUS;</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| master_log.000001 |      245 |              |                  |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">需要滚动一次；查询二进制日志文件及当前使用的文件；</span><br><span class="line">MariaDB [(none)]&gt; flush logs;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW MASTER STATUS;</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| master_log.000002 |      245 |              |                  |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; SHOW MASTER LOGS;</span><br><span class="line">+-------------------+-----------+</span><br><span class="line">| Log_name          | File_size |</span><br><span class="line">+-------------------+-----------+</span><br><span class="line">| master_log.000001 |       289 |</span><br><span class="line">| master_log.000002 |       245 |</span><br><span class="line">+-------------------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">当查看students表时，二进制日志文件不会改变；</span><br><span class="line">删除表中的一行是发生改变；</span><br><span class="line"></span><br><span class="line">#use mydb;</span><br><span class="line">#SHOW * FROM students;</span><br><span class="line"> MariaDB [mydb]&gt; SHOW MASTER SHATUS;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &apos;SHATUS&apos; at line 1</span><br><span class="line">MariaDB [mydb]&gt; SHOW MASTER STATUS;</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| master_log.000002 |      245 |              |                  |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">当删除一行后发生改变；</span><br><span class="line">MariaDB [mydb]&gt;  DELETE FROM students WHERE stuid=1986;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; SHOW MASTER STATUS</span><br><span class="line">    -&gt; ;</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">| master_log.000002 |      440 |              |                  |</span><br><span class="line">+-------------------+----------+--------------+------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看发生二进制的事件；</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; SHOW BINLOG EVENTS;</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+-------------------------------------------+</span><br><span class="line">| Log_name          | Pos | Event_type  | Server_id | End_log_pos | Info                                      |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+-------------------------------------------+</span><br><span class="line">| master_log.000001 |   4 | Format_desc |         1 |         245 | Server ver: 5.5.52-MariaDB, Binlog ver: 4 |</span><br><span class="line">| master_log.000001 | 245 | Rotate      |         1 |         289 | master_log.000002;pos=4                   |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+-------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看事件发生的内容；</span><br><span class="line">MariaDB [mydb]&gt; SHOW BINLOG EVENTS in &apos;master_log.000002&apos;;</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| Log_name          | Pos | Event_type  | Server_id | End_log_pos | Info                                              |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| master_log.000002 |   4 | Format_desc |         1 |         245 | Server ver: 5.5.52-MariaDB, Binlog ver: 4         |</span><br><span class="line">| master_log.000002 | 245 | Query       |         1 |         313 | BEGIN                                             |</span><br><span class="line">| master_log.000002 | 313 | Query       |         1 |         413 | use `mydb`; DELETE FROM students WHERE stuid=1986 |</span><br><span class="line">| master_log.000002 | 413 | Xid         |         1 |         440 | COMMIT /* xid=24 */                               |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">当测是目的操作不想被记录在我二进制日志文件当中时关掉session会话，不在记录到二进制日志；</span><br><span class="line">MariaDB [mydb]&gt; set @@session.sql_log_bin=OFF;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=2000;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; SHOW BINLOG EVENTS in &apos;master_log.000002&apos;;</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| Log_name          | Pos | Event_type  | Server_id | End_log_pos | Info                                              |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| master_log.000002 |   4 | Format_desc |         1 |         245 | Server ver: 5.5.52-MariaDB, Binlog ver: 4         |</span><br><span class="line">| master_log.000002 | 245 | Query       |         1 |         313 | BEGIN                                             |</span><br><span class="line">| master_log.000002 | 313 | Query       |         1 |         413 | use `mydb`; DELETE FROM students WHERE stuid=1986 |</span><br><span class="line">| master_log.000002 | 413 | Xid         |         1 |         440 | COMMIT /* xid=24 */                               |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">想要把上次删除的操作记录在二进制文件当中，可以开启会话，并在此仅删除操作；</span><br><span class="line">MariaDB [mydb]&gt; SET @@session.sql_log_bin=ON;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=2000:</span><br><span class="line">    -&gt; ;</span><br><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &apos;:&apos; at line 1</span><br><span class="line">MariaDB [mydb]&gt; DELETE FROM students WHERE stuid=2000;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mydb]&gt; SHOW BINLOG EVENTS in &apos;master_log.000002&apos;;</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| Log_name          | Pos | Event_type  | Server_id | End_log_pos | Info                                              |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| master_log.000002 |   4 | Format_desc |         1 |         245 | Server ver: 5.5.52-MariaDB, Binlog ver: 4         |</span><br><span class="line">| master_log.000002 | 245 | Query       |         1 |         313 | BEGIN                                             |</span><br><span class="line">| master_log.000002 | 313 | Query       |         1 |         413 | use `mydb`; DELETE FROM students WHERE stuid=1986 |</span><br><span class="line">| master_log.000002 | 413 | Xid         |         1 |         440 | COMMIT /* xid=24 */                               |</span><br><span class="line">| master_log.000002 | 440 | Query       |         1 |         508 | BEGIN                                             |</span><br><span class="line">| master_log.000002 | 508 | Query       |         1 |         608 | use `mydb`; DELETE FROM students WHERE stuid=2000 |</span><br><span class="line">| master_log.000002 | 608 | Query       |         1 |         677 | COMMIT                                            |</span><br><span class="line">+-------------------+-----+-------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">查看二进制日志某个位置的文件；</span><br><span class="line">MariaDB [mydb]&gt; SHOW BINLOG EVENTS in &apos;master_log.000002&apos; FROM 440;</span><br><span class="line">+-------------------+-----+------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| Log_name          | Pos | Event_type | Server_id | End_log_pos | Info                                              |</span><br><span class="line">+-------------------+-----+------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">| master_log.000002 | 440 | Query      |         1 |         508 | BEGIN                                             |</span><br><span class="line">| master_log.000002 | 508 | Query      |         1 |         608 | use `mydb`; DELETE FROM students WHERE stuid=2000 |</span><br><span class="line">| master_log.000002 | 608 | Query      |         1 |         677 | COMMIT                                            |</span><br><span class="line">+-------------------+-----+------------+-----------+-------------+---------------------------------------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line">给定440位置后，只显示440后面的内容；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">显示当前表中的第一行内容，进行限制显示；</span><br><span class="line">MariaDB [mydb]&gt; SHOW BINLOG EVENTS in &apos;master_log.000002&apos; FROM 440 LIMIT 1;</span><br><span class="line">+-------------------+-----+------------+-----------+-------------+-------+</span><br><span class="line">| Log_name          | Pos | Event_type | Server_id | End_log_pos | Info  |</span><br><span class="line">+-------------------+-----+------------+-----------+-------------+-------+</span><br><span class="line">| master_log.000002 | 440 | Query      |         1 |         508 | BEGIN |</span><br><span class="line">+-------------------+-----+------------+-----------+-------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">日志文件所在的位置；</span><br><span class="line">[root@note2 mysql]# ls</span><br><span class="line">aria_log.00000001  master_log.000001  mysql.sock</span><br><span class="line">aria_log_control   master_log.000002  note2.log</span><br><span class="line">ibdata1            master_log.index   note2-slow.log</span><br><span class="line">ib_logfile0        mydb               performance_schema</span><br><span class="line">ib_logfile1        mysql              test</span><br><span class="line"></span><br><span class="line">命令行查看二进制文件内容，开头为头文件；</span><br><span class="line">[root@note2 mysql]# mysqlbinlog master_log.000002</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;</span><br><span class="line">/*!40019 SET @@session.max_insert_delayed_threads=0*/;</span><br><span class="line">/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;</span><br><span class="line">DELIMITER /*!*/;</span><br><span class="line"># at 4</span><br><span class="line">#170912 16:55:14 server id 1  end_log_pos 245   Start: binlog v 4, server v 5.5.52-MariaDB created 170912 16:55:14</span><br><span class="line"># Warning: this binlog is either in use or was not closed properly.</span><br><span class="line">BINLOG &apos;</span><br><span class="line">8qC3WQ8BAAAA8QAAAPUAAAABAAQANS41LjUyLU1hcmlhREIAbG9nAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAA2QAEGggAAAAICAgCAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAMoi+UA==</span><br><span class="line">&apos;/*!*/;</span><br><span class="line"># at 245</span><br><span class="line">#170912 17:07:26 server id 1  end_log_pos 313   Query   thread_id=2      exec_time=0     error_code=0</span><br><span class="line">SET TIMESTAMP=1505207246/*!*/;</span><br><span class="line"></span><br><span class="line">mysqlbinlog 为客户端命令；</span><br></pre></td></tr></table></figure>
<h6 id="设置二进制日志文件大小；"><a href="#设置二进制日志文件大小；" class="headerlink" title="设置二进制日志文件大小；"></a>设置二进制日志文件大小；</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_binlog_size=1073731824;</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[keepalived高可用集群]]></title>
      <url>/2018/01/09/keepalived%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、双主模型ipvs(keepalived) 高可用集群</span><br><span class="line">2、双主模型nginx(keepalived)高可用集群</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1、准备五个虚拟机(centos7)；</span><br><span class="line">note1、note2、note3、note4、client</span><br><span class="line">2、配置静态ip地址，分别为；</span><br><span class="line">note1;172.16.253.10</span><br><span class="line">note2;172.16.253.11</span><br><span class="line">note3;172.16.253.13</span><br><span class="line">note4;172.16.253.14</span><br><span class="line">3、将防火墙及selinux关闭；</span><br><span class="line">#systemctl stop firewalld</span><br><span class="line">#systemctl disable firewalld</span><br><span class="line">#systemctl is-enabled firewalld</span><br><span class="line">#setenforce 0</span><br><span class="line">#vim /etc/selinux/config</span><br><span class="line">  SELINUX=permissive</span><br><span class="line">#getenforce</span><br><span class="line">4、配置yum源；</span><br><span class="line">5、安装keepalived、ipvsadm、nginx、httpd；</span><br><span class="line">6、同步时间；</span><br><span class="line">vim /etc/chrony</span><br><span class="line">server 172.16.0.1 iburst</span><br><span class="line">systemctl start chronyd.service</span><br><span class="line">chronyc sources---查看同步状态</span><br><span class="line">7、设置/etc/hosts文件，做ip地址解析；</span><br></pre></td></tr></table></figure>
<p>######ipvs(keepalived)<br>1、note1、note2，设置单主模式keepalived<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">配置/etc/keepalived/keepalived.conf文件；</span><br><span class="line">设置全局配置、vrrp_instance虚拟路由器配置</span><br><span class="line">[root@note1 ~]# cat keepalived.conf.shuangzhu</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">   keepalived@note.com</span><br><span class="line">&#125;</span><br><span class="line">   notification_email_from keepalived_admin@note.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id note1</span><br><span class="line">   vrrp_mcast_group4 224.12.0.18</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens34</span><br><span class="line">    virtual_router_id 11</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass yKt4PsOZ</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.16.253.101/16 dev ens34</span><br><span class="line">    &#125;</span><br><span class="line">    notify_master &quot;/etc/keepalived/notify.sh master&quot;</span><br><span class="line">    notify_backup &quot;/etc/keepalived/notify.sh backup&quot;</span><br><span class="line">    notify_fault &quot;/etc/keepalived/notify.sh fault&quot;</span><br><span class="line">&#125;</span><br><span class="line">将note1的此配置文件拷贝到note2上，将配置文件MASTER改为BACKUP(主用改为备用)、将prioirty权重改为95；</span><br><span class="line">[root@note1 ~]#systemctl start keepalived</span><br><span class="line">#ip a l</span><br><span class="line">#mail</span><br><span class="line">[root@note2 ~]#systemctl start keepalived</span><br><span class="line">#ip a l</span><br><span class="line">#mail</span><br><span class="line">将note1主用keepalived停用，查看note2备用keepalived是否升为主用；</span><br></pre></td></tr></table></figure></p>
<p>2、note1、note2，设置双主模式keepalived；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#yum install keepalived</span><br><span class="line">在/etc/keepalived/目录下创建一个脚本,并调用，生成邮件；</span><br><span class="line">#!/bin/bash</span><br><span class="line">contact=&apos;root@localhost&apos;</span><br><span class="line">notify() &#123;</span><br><span class="line">local mailsubject=&quot;$(hostname) to be $1, vip floating&quot;</span><br><span class="line">local mailbody=&quot;$(date +&apos;%F %T&apos;): vrrp transition, $(hostname) changed to be $1&quot;</span><br><span class="line">echo &quot;$mailbody&quot; | mail -s &quot;$mailsubject&quot; $contact</span><br><span class="line">        &#125;</span><br><span class="line">case $1 in</span><br><span class="line">master)</span><br><span class="line">notify master</span><br><span class="line">;;</span><br><span class="line">backup)</span><br><span class="line">notify backup</span><br><span class="line">;;</span><br><span class="line">fault)</span><br><span class="line">notify fault</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo &quot;Usage: $(basename $0) &#123;master|backup|fault&#125;&quot;</span><br><span class="line">exit 1</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line">将原有的配置文件中的vrrp_instance配置段各复制一份，进行修改。如果主备模式三台可以复制三分，并进行设置；</span><br><span class="line">1、将虚拟路由器名称VI_1改为VI_2。</span><br><span class="line">2、设置虚拟路由器id，11改为12。</span><br><span class="line">3、更改身份验证auto_PASS。</span><br><span class="line">4、更改主备设置及权重。</span><br><span class="line">note1配置文件；</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens34</span><br><span class="line">    virtual_router_id 11</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass yKt4PsOZ</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.16.253.101/16 dev ens34</span><br><span class="line">    &#125;</span><br><span class="line">    notify_master &quot;/etc/keepalived/notify.sh master&quot;</span><br><span class="line">    notify_backup &quot;/etc/keepalived/notify.sh backup&quot;</span><br><span class="line">    notify_fault &quot;/etc/keepalived/notify.sh fault&quot;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_2 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens34</span><br><span class="line">    virtual_router_id 12</span><br><span class="line">    priority 95</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass yKt5PsOZ</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.16.253.102/16 dev ens34</span><br><span class="line">    &#125;</span><br><span class="line">    notify_master &quot;/etc/keepalived/notify.sh master&quot;</span><br><span class="line">    notify_backup &quot;/etc/keepalived/notify.sh backup&quot;</span><br><span class="line">    notify_fault &quot;/etc/keepalived/notify.sh fault&quot;</span><br><span class="line">&#125;</span><br><span class="line">#双主模式；有两个虚拟路由器VI_1和VI_2，两个虚拟路由器有各自的ip地址；</span><br><span class="line">*note1;  VI_1 为MASTER，VI_2为BACKUP</span><br><span class="line">*note2;  VI_2 为MASTER，VI_1为BACKUP</span><br><span class="line">测试；tcp -nn -l ens34 host 244.12.0.18</span><br><span class="line">           systemctl stop keepalived</span><br><span class="line">           tcp -nn -l ens34 host 244.12.0.18</span><br></pre></td></tr></table></figure></p>
<p>3、note3、note4，设置网页index.html文件；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#yum install nginx</span><br><span class="line"> 1、将默认网页文件内容删除重新编辑；</span><br><span class="line">note3；vim /usr/share/nginx/html/index.html</span><br><span class="line">             &lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">note4；vim /usr.share/nginx/html/index.html</span><br><span class="line">             &lt;h1&gt;RS2&lt;/h1&gt;</span><br></pre></td></tr></table></figure></p>
<p>4、note3、note4；将虚拟路由器ip添加到回环网卡lo上；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">note3;</span><br><span class="line">编辑一个脚本并执行；</span><br><span class="line">vim setrs.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">vip=172.16.253.101</span><br><span class="line">mask=255.255.255.255</span><br><span class="line">iface=&quot;lo:0&quot;</span><br><span class="line">case $1 in</span><br><span class="line">start)</span><br><span class="line">        echo 1 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        echo 1 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        echo 2 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        echo 2 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line"></span><br><span class="line">        ifconfig $iface $vip netmask $mask broadcast $vip up</span><br><span class="line">        route add -host $vip dev $iface</span><br><span class="line">        ;;</span><br><span class="line">stop)</span><br><span class="line">        ifconfig $iface down</span><br><span class="line"></span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        echo 0 &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        ;;</span><br><span class="line">*)</span><br><span class="line">        echo &quot;Usage: $(basename $0) start|stop&quot;</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line">检查语法；bash -n setrs.sh</span><br><span class="line">检查语法并执行；bash -x setrs.sh start</span><br><span class="line">执行成功后将虚拟路由器ip添加到lo网卡上;</span><br><span class="line">将脚本ip改为172.16.253.102，在lo网卡上添加第二个虚拟路由器ip;</span><br><span class="line">note4;</span><br><span class="line">根据note3步骤将虚拟路由器ip添加到note4后端服务器lo网卡上;</span><br></pre></td></tr></table></figure></p>
<p>5、note1、note2，设置ipvs相关的vs、rs—地址；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1、编辑/etc/keepalived/keepalived.conf文件，设置virtual_server 的vs及rs的地址；</span><br><span class="line">virtual_server 172.16.253.102 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    nat_mask 255.255.0.0</span><br><span class="line">    protocol TCP</span><br><span class="line">    sorry_server 127.0.0.1 80</span><br><span class="line">    real_server 172.16.253.13 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">              status_code 200</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 172.16.253.14 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">              status_code 200</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">note1;在各自的虚拟路由器段，如VI_1、VI_2的vrrp配置段下添加virtual_server段，注意虚拟服务器地址，分别为；172.16.253.101,172.16.253.102.</span><br><span class="line">note2;根据note1配置。</span><br></pre></td></tr></table></figure></p>
<p>6、note1,note2;在配置文件/etc/keepalived/keepaived.conf，virtual-server板块中 sorry_server错误界面选项；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">virtual_server 172.16.253.101 80 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr</span><br><span class="line">    lb_kind DR</span><br><span class="line">    nat_mask 255.255.0.0</span><br><span class="line">    protocol TCP</span><br><span class="line">    sorry_server 127.0.0.1 80</span><br><span class="line">    real_server 172.16.253.13 80 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        HTTP_GET &#123;</span><br><span class="line">安装ngnix或httpd,将默认网页文件改为自己所需要的内容；</span><br><span class="line">[root@note1 ~]# vim  /usr/share/nginx/html/index.html</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">note1,note2都设置此项；</span><br></pre></td></tr></table></figure></p>
<p>7、client测试高可用性；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">访问ip地址；172.16.253.101或172.16.253.101</span><br><span class="line">[root@xjcentos7 ~]# for i  in  &#123;1..10&#125;;do curl http://172.16.253.101;done</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">当将两台后端主机RS服务器停掉，在访问172.16.253.101或172.16.253.102；</span><br><span class="line">[root@xjcentos7 ~]# for i  in  &#123;1..10&#125;;do curl http://172.16.253.101;done</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director1&lt;/h1&gt;</span><br><span class="line">[root@xjcentos7 ~]# for i  in  &#123;1..10&#125;;do curl http://172.16.253.102;done</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;sorry from Director2&lt;/h1&gt;</span><br></pre></td></tr></table></figure></p>
<p>######nginx（keepalived）<br>1、实现单主模型下nginx（keepalived）调用后端RS服务器；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">1、启用nginx调用功能，编写配置文件/etc/nginx/nginx.conf；</span><br><span class="line">note1,note2设置配置文件；</span><br><span class="line"></span><br><span class="line">    upstream websrvs &#123;</span><br><span class="line">             server 172.16.253.13:80</span><br><span class="line">             server 172.16.253.14:80</span><br><span class="line">         &#125;</span><br><span class="line">    # Load modular configuration files from the /etc/nginx/conf.d directory.</span><br><span class="line">    # See http://nginx.org/en/docs/ngx_core_module.html#include</span><br><span class="line">    # for more information.</span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80 default_server;</span><br><span class="line">        listen       [::]:80 default_server;</span><br><span class="line">        server_name  _;</span><br><span class="line">        root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        # Load configuration files for the default server block.</span><br><span class="line">        include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">        proxy_pass http://websrvs;</span><br><span class="line"> &#125;</span><br><span class="line">设置完成后，访问172.16.253.10测试一下；</span><br><span class="line">[root@note1 ~]# curl http://172.16.253.10</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">[root@note1 ~]# curl http://172.16.253.10</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">2、在/etc/keepalived/keepalived.conf文件中调用命令段，实现降权、升权的功能，主备切换的功能；</span><br><span class="line">设置调用脚本或程需命令选项；</span><br><span class="line">查看示例；</span><br><span class="line">[root@note1 ~]# grep -i vrrp_script /usr/share/doc/keepalived-1.2.13/samples/*</span><br><span class="line">/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.vrrp.localcheck:vrrp_script chk_sshd &#123;</span><br><span class="line">/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.vrrp.localcheck:vrrp_script chk_haproxy &#123;</span><br><span class="line">/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.vrrp.localcheck:vrrp_script chk_http_port &#123;</span><br><span class="line">/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.vrrp.localcheck:vrrp_script chk_https_port &#123;</span><br><span class="line">/usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.vrrp.localcheck:vrrp_script chk_smtp_port &#123;</span><br><span class="line">[root@note1 ~]# cat /usr/share/doc/keepalived-1.2.13/samples/keepalived.conf.vrrp.localcheck</span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">vrrp_script chk_sshd &#123;</span><br><span class="line">       script &quot;killall -0 sshd&quot;        # cheaper than pidof</span><br><span class="line">       interval 2                      # check every 2 seconds</span><br><span class="line">       weight -4                       # default prio: -4 if KO</span><br><span class="line">       fall 2                          # require 2 failures for KO</span><br><span class="line">       rise 2                          # require 2 successes for OK</span><br><span class="line">&#125;</span><br><span class="line">设置手动制造故障及设置调用nginx脚本；</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">   keepalived@note.com</span><br><span class="line">&#125;</span><br><span class="line">   notification_email_from keepalived_admin@note.com</span><br><span class="line">   smtp_server 127.0.0.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id note1</span><br><span class="line">   vrrp_mcast_group4 224.12.0.18</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_down &#123;</span><br><span class="line">     script &quot;[[ -f /etc/keepalived/down ]]&quot; &amp;&amp; exit 1 || exit 0&quot;</span><br><span class="line">     interval 1</span><br><span class="line">     weight -10</span><br><span class="line">     fall     2</span><br><span class="line">     rise     2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">     skript &quot;killall -0 nginx&quot;</span><br><span class="line">     interval 2</span><br><span class="line">     weight -10</span><br><span class="line">     fall     2</span><br><span class="line">     rise     2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface ens34</span><br><span class="line">    virtual_router_id 11</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass yKt4PsOZ</span><br><span class="line">    &#125;</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">        172.16.253.101/16 dev ens34</span><br><span class="line">   &#125;</span><br><span class="line">    track_script&#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">        chk_down</span><br><span class="line">   &#125;</span><br><span class="line">    notify_master &quot;/etc/keepalived/notify.sh master&quot;</span><br><span class="line">    notify_backup &quot;/etc/keepalived/notify.sh backup&quot;</span><br><span class="line">    notify_fault &quot;/etc/keepalived/notify.sh fault&quot;</span><br><span class="line">&#125;</span><br><span class="line">3、将配置文件复制到note2上并进行修改；</span><br><span class="line">将MASTER改为BACKUP,单主模式配置完成。</span><br><span class="line">进行访问测试；</span><br><span class="line">[root@xjcentos7 ~]# for i  in  &#123;1..10&#125;;do curl http://172.16.253.101;done</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">[root@note1 ~]# cd /etc/keepalived/</span><br><span class="line">[root@note1 keepalived]# touch down</span><br><span class="line">[root@note1 ~]# tcpdump -i ens34 -nn host 224.12.0.18</span><br><span class="line">11:01:41.580252 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:01:41.580881 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 95, authtype simple, intvl 1s, length 20</span><br><span class="line">11:01:41.581866 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:01:42.583792 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:01:43.587375 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype</span><br></pre></td></tr></table></figure></p>
<p>2、实现双主模式下nginx ( keepalived ) 调用后端RS服务器；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">1、note1; 在配置文件/etc/keepalived/keepalived.conf中, 添加复制一份</span><br><span class="line">virtual_server区域内容，并进行修改。MASTER,BACKUP、权、验证码、虚拟路由器ip(vip)</span><br><span class="line">vrrp_instance VI_2 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens34</span><br><span class="line">    virtual_router_id 11</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass yKt5PsOZ</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        172.16.253.102/16 dev ens34</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    track_script&#123;</span><br><span class="line">        chk_nginx</span><br><span class="line">        chk_down</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">    notify_master &quot;/etc/keepalived/notify.sh master&quot;</span><br><span class="line">    notify_backup &quot;/etc/keepalived/notify.sh backup&quot;</span><br><span class="line">    notify_fault &quot;/etc/keepalived/notify.sh fault&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">note2；按note1的步骤配置、/etc/keepalived/keepalived.conf文件；</span><br><span class="line">2、cilent进行测试，也可在note1和note2端使用touch down来进行检测；</span><br><span class="line">[root@xjcentos7 ~]# for i  in  &#123;1..10&#125;;do curl http://172.16.253.101;done</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">[root@xjcentos7 ~]# for i  in  &#123;1..10&#125;;do curl http://172.16.253.102;done</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS1&lt;/h1&gt;</span><br><span class="line">&lt;h1&gt;RS2&lt;/h1&gt;</span><br><span class="line">[root@note1 keepalived]# touch down</span><br><span class="line">[root@note1 ~]# tcpdump -i ens34 -nn host 224.12.0.18</span><br><span class="line">11:21:53.974338 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:53.976207 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:54.976431 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:54.978223 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:55.978463 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:55.980380 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:56.980566 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:56.982511 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 90, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:56.986256 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 95, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:56.987810 IP 172.16.253.10 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 90, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:56.995422 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 95, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:57.982627 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:57.998655 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 95, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:58.984764 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:59.000745 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 11, prio 95, authtype simple, intvl 1s, length 20</span><br><span class="line">11:21:59.986896 IP 172.16.253.11 &gt; 224.12.0.18: VRRPv2, Advertisement, vrid 12, prio 100, authtype simple, intvl 1s, length 20</span><br><span class="line">3、测试故障修复抢占模式；</span><br><span class="line">note1；/etc/keepalived/keepalied.conf目录中的调用了notify脚本文件，在脚本文件中添加一项内容；systemctl start nginx</span><br><span class="line">在notify backup下添加一行；systemctl start nginx</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        
        <tags>
            
            <tag> keepalived </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[varnish缓存服务]]></title>
      <url>/2018/01/09/varnish%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置epel源及本地光盘yum源；</span><br><span class="line">准备两台虚拟机；</span><br><span class="line">关闭防火墙及SElinux；</span><br><span class="line">编辑配置文件；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1、Varnish主机端 ，备份配置文件</span><br><span class="line">Vim  /etc/varnish/default.vcl</span><br><span class="line">设置默认监听后端主机和端口</span><br><span class="line">backend default &#123;</span><br><span class="line">    .host = &quot;172.16.251.108&quot;;</span><br><span class="line">    .port = &quot;80&quot;;</span><br><span class="line">&#125;</span><br><span class="line">Vim /etc/varnish/varnish.params</span><br><span class="line">设置管理监听主机选项；</span><br><span class="line">端口设置为80；</span><br><span class="line">监听地址默认所有；</span><br><span class="line">2、服务器端，安装httpd php</span><br><span class="line">设置网页</span><br><span class="line">/var/www/html/test.html</span><br><span class="line">&lt;h1&gt;test page @PE note2&lt;/h1&gt;</span><br><span class="line">/var/www/html/info.php</span><br><span class="line">3、设置防火墙，SELINUX，启用varnish,</span><br><span class="line">编辑解释器 命令varnish_reload_vcl</span><br><span class="line">访问网页；</span><br><span class="line"></span><br><span class="line">4、添加客户端请求命中缓存与否；</span><br><span class="line">sub vcl_deliver &#123;</span><br><span class="line">    if (obj.hits&gt;0) &#123;</span><br><span class="line">        set resp.http.X-Cache=&quot;HIT via&quot; +server.ip;</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">        set reso.http.X-Cache=&quot;MISS from&quot; +server.ip;</span><br><span class="line">       &#125;</span><br><span class="line">#varnish_reload_val</span><br><span class="line">生效</span><br><span class="line">F12查看状态；</span><br><span class="line">5、添加用户端访问不检查缓存限制选项；</span><br><span class="line">Vcl_recv&#123;</span><br><span class="line">      if (req.url ~ &quot;(？i)^/login&quot;)&#123;</span><br><span class="line">       return(pass);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">6、将client报文文件的ip信息传送到服务器端；</span><br><span class="line">if (req.restarts == 0)&#123;</span><br><span class="line">       if (req.http.X-Forworded-For)&#123;</span><br><span class="line">       set req.http.X-Forwarded.For=req.http.X-Forworded-For+&quot;,&quot;+client.ip;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line">启用编译解析器---varnish_reload_vcl;</span><br><span class="line">客户端访问varnish代理；</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> varnish </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[lvs负载均衡nat模式]]></title>
      <url>/2018/01/09/lvs%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1nat%E6%A8%A1%E5%BC%8F/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">安装centos</span><br><span class="line">centos7---vs</span><br><span class="line">centos6---RS1、RS2</span><br><span class="line">centos6---client</span><br><span class="line"></span><br><span class="line">最小化安装centos,配置yum源；</span><br><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">rm-rf *</span><br><span class="line">vi base.repo</span><br><span class="line">[base]</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">gpgcheck=0</span><br><span class="line">#yum repolist</span><br><span class="line">#yum makecache</span><br><span class="line">#yum install vim</span><br><span class="line">#yum install autofs</span><br><span class="line">chkconfig autofs on</span><br><span class="line">service autofs start</span><br><span class="line">#vim base.repo</span><br><span class="line">[base]</span><br><span class="line">baseurl=file:///misc/cd</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">设置ip地址，设置为静态ip；</span><br><span class="line">使用VMware 仅主机和自定义模式（仅主机）</span><br><span class="line">1、vs外网网卡设置为自定义模式；ip;192.168.183.151</span><br><span class="line">   vs内网网卡设置为仅主机模式；ip：192.168.226.151</span><br><span class="line">2、RS1；仅主机模式，ip;192.168.226.140</span><br><span class="line">   RS2；仅主机模式，ip;192.168.226.141</span><br><span class="line">3、client;自定义模式；ip;192.168.183.130</span><br><span class="line"></span><br><span class="line">关闭防火墙及SElinux设置；</span><br><span class="line">centos6;</span><br><span class="line">#chkconfig iptables off</span><br><span class="line">#chkconfig list iptables</span><br><span class="line">#vim /etc/selinux/conf</span><br><span class="line">#setenforce 0</span><br><span class="line">#getenforce</span><br><span class="line">centos7;</span><br><span class="line">systemctl enable firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">#vim /etc/selinux/conf</span><br><span class="line">#setenforce 0</span><br><span class="line">#getenforce</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、VS（centos7）安装ipvsadm；</span><br><span class="line">      设置VS服务模式；</span><br><span class="line">      设置VS的算法；</span><br><span class="line">      开启ipv4转发功能；</span><br><span class="line">2、RS（centos6）安装httpd;</span><br><span class="line">      设置简单的网页；</span><br><span class="line">      将RS网关指向VS（192.168.226.151）；</span><br><span class="line">3、client客户端访问vs端网页；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"> 1、VS (centos 7)上安装ipvsadm，设置/etc/sysctl.conf配置文件、设置VS服务模式及算法;</span><br><span class="line"> #yum install ipvsadm</span><br><span class="line"> #Vim /etc/sysctl.conf</span><br><span class="line"> Net.ipv4.ip_forward=1</span><br><span class="line"> #ipvsadm -A -t 192.168.183.151:80 -s rr---模式</span><br><span class="line"> #ipvsadm -a -t 192.168.183.151:80 -r 192.168.226.140 -m ---算法</span><br><span class="line"> #ipvsadm -a -t 192.168.183.151:80 -r 192.168.226.141 -m</span><br><span class="line">2、RS服务器将网关指向VS服务器，安装httpd并启用；</span><br><span class="line"> RS1;</span><br><span class="line"> # vim /etc/sysconfig/network-scripts</span><br><span class="line"> DEVICE=eth0</span><br><span class="line"> IPADDR=192.168.226.140</span><br><span class="line"> PREFIX=24</span><br><span class="line"> GATEWAY=192.168.226.151</span><br><span class="line"> RS2;</span><br><span class="line"> # vim /etc/sysconfig/network-scripts</span><br><span class="line"> DEVICE=eth0</span><br><span class="line"> IPADDR=192.168.226.141</span><br><span class="line"> PREFIX=24</span><br><span class="line"> GATWAY=192.168.226.151</span><br><span class="line"> #yum install httpd</span><br><span class="line"> #service httpd start</span><br><span class="line"> #chkconfig httpd on</span><br><span class="line"> 创建简单的网页；</span><br><span class="line"> echo RS1 SERVER &gt;/var/www/html/index.html</span><br><span class="line"> echo RS2 SERVER &gt;/var/www/html/index.html</span><br><span class="line">3、client客户端访问网页,检测是否成功；</span><br><span class="line"> #curl 192.168.183.151</span><br><span class="line"> #if i in &#123;1..10&#125;;do curl 192.168.183.151;done</span><br><span class="line"> [root@client ~]#for i in &#123;1..10&#125;;do curl 192.168.183.151;sleep 1;done</span><br><span class="line"> RS1 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS1 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS1 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS1 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS1 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line">4、在vs上查看连接状态；</span><br><span class="line"> #Ipvsadm -Ln</span><br><span class="line"> [root@VS1 ~]# ipvsadm -Ln</span><br><span class="line"> IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line"> Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line"> TCP  192.168.183.151:80 rr</span><br><span class="line">  -&gt; 192.168.226.140:80           Masq    1      0          8</span><br><span class="line">  -&gt; 192.168.226.141:80           Masq    1      0          8</span><br><span class="line">5、测试性能；</span><br><span class="line"> [root@client ~]#ab -c 100 -n 10000 http://192.168.183.151/</span><br><span class="line"> This is ApacheBench, Version 2.3 &lt;$Revision: 655654 $&gt;</span><br><span class="line"> Copyright 1996 Adam Twiss, Zeus Technology Ltd,        http://www.zeustech.net/</span><br><span class="line"> Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line"> Benchmarking 192.168.183.151 (be patient)</span><br><span class="line"> Completed 1000 requests</span><br><span class="line"> Completed 2000 requests</span><br><span class="line"> Completed 3000 requests</span><br><span class="line"> Completed 4000 requests</span><br><span class="line"> Completed 5000 requests</span><br><span class="line"> Completed 6000 requests</span><br><span class="line"> Completed 7000 requests</span><br><span class="line"> Completed 8000 requests</span><br><span class="line"> Completed 9000 requests</span><br><span class="line"> Completed 10000 requests</span><br><span class="line"> Finished 10000 requests</span><br><span class="line"> Server Software:        Apache/2.2.15</span><br><span class="line"> Server Hostname:        192.168.183.151</span><br><span class="line"> Server Port:            80</span><br><span class="line"> Document Path:          /</span><br><span class="line"> Document Length:        12 bytes</span><br><span class="line"> Concurrency Level:      100</span><br><span class="line"> Time taken for tests:   4.102 seconds</span><br><span class="line"> Complete requests:      10000</span><br><span class="line"> Failed requests:        0</span><br><span class="line"> Write errors:           0</span><br><span class="line"> Total transferred:      2785829 bytes</span><br><span class="line"> HTML transferred:       120036 bytes</span><br><span class="line"> Requests per second:    2437.62 [#/sec] (mean)</span><br><span class="line"> Time per request:       41.024 [ms] (mean)</span><br><span class="line"> Time per request:       0.410 [ms] (mean, across all concurrent requests)</span><br><span class="line"> Transfer rate:          663.16 [Kbytes/sec] received</span><br><span class="line"> Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line"> Connect:        1    8   9.4      6     188</span><br><span class="line"> Processing:     5   33  16.7     30     231</span><br><span class="line"> Waiting:        3   32  16.2     30     231</span><br><span class="line"> Total:         22   40  19.1     39     240</span><br><span class="line"> Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%     39</span><br><span class="line">  66%     41</span><br><span class="line">  75%     42</span><br><span class="line">  80%     42</span><br><span class="line">  90%     44</span><br><span class="line">  95%     45</span><br><span class="line">  98%     48</span><br><span class="line">  99%     56</span><br><span class="line"> 100%    240 (longest request)</span><br><span class="line">6、查看谁在访问；</span><br><span class="line"> Cat /var/log/httpd/access_log</span><br><span class="line">7、查看谁访问的数量；</span><br><span class="line"> [root@RS1 network-scripts]#cut -d&quot; &quot; -f1 /var/log/httpd/access_log  |sort -  nr|uniq -c|sort -n</span><br><span class="line">      1 192.168.226.140</span><br><span class="line">      3 192.168.226.151</span><br><span class="line">     10 ::1</span><br><span class="line">    102 192.168.183.151</span><br><span class="line">  10328 192.168.183.130</span><br><span class="line">8、查看每秒钟的访问数据平均速度；</span><br><span class="line"> [root@VS1 ~]# ipvsadm -Ln --rate</span><br><span class="line"> IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line"> Prot LocalAddress:Port                 CPS    InPPS   OutPPS    InBPS     OutBPS</span><br><span class="line">  -&gt; RemoteAddress:Port</span><br><span class="line"> TCP  192.168.183.151:80                  1        5        5      447      545</span><br><span class="line">  -&gt; 192.168.226.140:80                  0        3        2      223      272</span><br><span class="line">  -&gt; 192.168.226.141:80                  0        3        2      224      273</span><br><span class="line">9、更改vs算法，更改RS权数；</span><br><span class="line"> Ipvsadm -E -t 192.168.183.151:80 -s wrr</span><br><span class="line"> Ipvsadm -e -t 192.168.183.151:80 -r 192.168.226.141 -m -w 3</span><br><span class="line">再次访问时会有变化；</span><br><span class="line"> [root@client ~]#for i in &#123;1..100&#125;;do curl 192.168.183.151;sleep 1;done</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS1 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS2 SERVICE</span><br><span class="line"> RS1 SERVICE</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> 删除网卡模块；</span><br><span class="line"> /etc/udev/rules.d/70-persistent-ipoib.rules</span><br><span class="line">- 卸载模块</span><br><span class="line">- Rmmod  e1000</span><br><span class="line">- Modprobe e1000</span><br><span class="line">添加ip地址</span><br><span class="line">ip a add 192.168.226.151/24 dev eth0</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> lvs服务nat模式 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[日志服务c/s]]></title>
      <url>/2018/01/09/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1c-s/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、准备虚拟机，centos6、centso7、centos5;</span><br><span class="line">2、将centos7设置成日志服务器端，将centos6设置为日志服务客户端；</span><br><span class="line">3、从centos5虚拟机使用ssh连接centos6生成、/var/log/secure日志文件；</span><br><span class="line">4、将生成的日志文件转送到centos7服务器端；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">1、最小化安装，安装所需要的安装包；</span><br><span class="line">#yum install  openssh</span><br><span class="line">centos6、centos7日志配置文件为---/etc/rsyslog.conf</span><br><span class="line">安装包为rsyslog;</span><br><span class="line">centos5日志配置文件---/etc/syslog.conf</span><br><span class="line">安装包为sysklogd(centos5及之前版本)</span><br><span class="line">同步服务器时间；</span><br><span class="line">ntpdate 172.16.0.1</span><br><span class="line"></span><br><span class="line">2、查看配置文件；</span><br><span class="line">/etc/ssh</span><br><span class="line">[root@centos7 ~]#cat  /etc/ssh/sshd_config |grep -v &quot;^#&quot;|grep -v &quot;^$&quot;</span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ed25519_key</span><br><span class="line">（SyslogFacility AUTHPRIV -----生成日志文件类型，发送到日志）</span><br><span class="line">AuthorizedKeysFile      .ssh/authorized_keys</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line">GSSAPIAuthentication yes</span><br><span class="line">GSSAPICleanupCredentials no</span><br><span class="line">UsePAM yes</span><br><span class="line">X11Forwarding yes</span><br><span class="line">UsePrivilegeSeparation sandbox          # Default for new installations.</span><br><span class="line">AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES</span><br><span class="line">AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT</span><br><span class="line">AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE</span><br><span class="line">AcceptEnv XMODIFIERS</span><br><span class="line">Subsystem       sftp    /usr/libexec/openssh/sftp-server</span><br><span class="line"></span><br><span class="line">/etc/rsyslog.conf</span><br><span class="line">日志文件类型及日志文件</span><br><span class="line">[root@centos6 ~]#cat /etc/rsyslog.conf |grep -v &quot;^#&quot;|grep -v &quot;^$&quot;</span><br><span class="line">$ModLoad imuxsock # provides support for local system logging (e.g. via logger command)</span><br><span class="line">$ModLoad imklog   # provides kernel logging support (previously done by rklogd)</span><br><span class="line">$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat</span><br><span class="line">$IncludeConfig /etc/rsyslog.d/*.conf</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                /var/log/messages</span><br><span class="line">（authpriv.*）                                             /var/log/secure</span><br><span class="line">mail.*                                                  -/var/log/maillog</span><br><span class="line">cron.*                                                  /var/log/cron</span><br><span class="line">*.emerg                                                 *</span><br><span class="line">uucp,news.crit                                          /var/log/spooler</span><br><span class="line">local7.*                                                /var/log/boot.log</span><br><span class="line"></span><br><span class="line">centos5使用ssh连接centos6,查看生成的日志记录；</span><br><span class="line">[root@station1 ~]#ssh 192.168.226.134</span><br><span class="line">root@192.168.226.134&apos;s password:</span><br><span class="line">Last login: Thu Aug 10 21:23:23 2017 from 192.168.226.1</span><br><span class="line">[root@centos6 ~]#</span><br><span class="line"></span><br><span class="line">[root@centos6 ssh]#tail /var/log/secure -f</span><br><span class="line">Aug 10 21:22:50 centos6 sshd[3128]: Accepted password for root from 192.168.226.135 port 34327 ssh2</span><br><span class="line">Aug 10 21:22:50 centos6 sshd[3128]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line">Aug 10 21:23:23 centos6 sshd[3148]: Accepted password for root from 192.168.226.1 port 7141 ssh2</span><br><span class="line">Aug 10 21:23:23 centos6 sshd[3148]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line">Aug 10 21:25:41 centos6 sshd[3128]: pam_unix(sshd:session): session closed for user root</span><br><span class="line">Aug 10 21:26:58 centos6 sshd[3202]: Accepted password for root from 192.168.226.135 port 54649 ssh2</span><br><span class="line">Aug 10 21:26:58 centos6 sshd[3202]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line"></span><br><span class="line">3、修改配置文件；</span><br><span class="line">在配置文件里开启客户端centos6，514端口；</span><br><span class="line"></span><br><span class="line"># Provides UDP syslog reception</span><br><span class="line">$ModLoad imudp</span><br><span class="line">$UDPServerRun 514</span><br><span class="line"></span><br><span class="line"># Provides TCP syslog reception</span><br><span class="line">#$ModLoad imtcp</span><br><span class="line">#$InputTCPServerRun 514</span><br><span class="line"></span><br><span class="line">传送到日志服务器；开启UDP模块时，@IP。开启TCP模块时，@@IP.</span><br><span class="line">authpriv.*                                               @192.168.226.133</span><br><span class="line"></span><br><span class="line">4、centos5使用ssh连接centos6；</span><br><span class="line">centos5虚拟机</span><br><span class="line">[root@station1 ~]#ssh 192.168.226.134</span><br><span class="line">root@192.168.226.134&apos;s password:</span><br><span class="line">Last login: Thu Aug 10 23:12:00 2017 from 192.168.226.134</span><br><span class="line">[root@centos6 ~]#</span><br><span class="line">centos6虚拟机</span><br><span class="line">[root@centos6 ssh]#tail /var/log/secure -f</span><br><span class="line">Aug  9 13:28:13 centos6 unix_chkpwd[3111]: password check failed for user (root)</span><br><span class="line">Aug  9 13:28:13 centos6 sshd[3105]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=192.168.226.135  user=root</span><br><span class="line">Aug  9 13:28:16 centos6 sshd[3105]: Failed password for root from 192.168.226.135 port 36336 ssh2</span><br><span class="line">Aug 10 21:22:50 centos6 sshd[3128]: Accepted password for root from 192.168.226.135 port 34327 ssh2</span><br><span class="line">Aug 10 21:22:50 centos6 sshd[3128]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line">Aug 10 21:23:23 centos6 sshd[3148]: Accepted password for root from 192.168.226.1 port 7141 ssh2</span><br><span class="line">Aug 10 21:23:23 centos6 sshd[3148]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line">Aug 10 21:25:41 centos6 sshd[3128]: pam_unix(sshd:session): session closed for user root</span><br><span class="line">Aug 10 21:26:58 centos6 sshd[3202]: Accepted password for root from 192.168.226.135 port 54649 ssh2</span><br><span class="line">Aug 10 21:26:58 centos6 sshd[3202]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line"></span><br><span class="line">centos7虚拟机</span><br><span class="line">[root@centos7 ~]#tail /var/log/secure -f</span><br><span class="line">Aug 10 19:26:00 centos7 useradd[3851]: new user: name=nfsnobody, UID=65534, GID=65534, home=/var/lib/nfs, shell=/sbin/nologin</span><br><span class="line">Aug 10 23:06:34 centos6 sshd[3469]: Accepted password for root from 192.168.226.134 port 49146 ssh2</span><br><span class="line">Aug 10 23:06:34 centos6 sshd[3469]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line">Aug 10 23:11:29 centos6 sshd[3469]: Received disconnect from 192.168.226.134: 11: disconnected by user</span><br><span class="line">Aug 10 23:11:29 centos6 sshd[3469]: pam_unix(sshd:session): session closed for user root</span><br><span class="line">Aug 10 23:12:00 centos6 sshd[3525]: Accepted password for root from 192.168.226.134 port 49148 ssh2</span><br><span class="line">Aug 10 23:12:00 centos6 sshd[3525]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line">Aug 10 23:12:30 centos6 sshd[3525]: Received disconnect from 192.168.226.134: 11: disconnected by user</span><br><span class="line">Aug 10 23:12:30 centos6 sshd[3525]: pam_unix(sshd:session): session closed for user root</span><br><span class="line">Aug 10 23:13:18 centos6 sshd[3202]: pam_unix(sshd:session): session closed for user root</span><br><span class="line">Aug 10 23:14:09 centos6 sshd[3547]: Accepted password for root from 192.168.226.135 port 46989 ssh2</span><br><span class="line">Aug 10 23:14:09 centos6 sshd[3547]: pam_unix(sshd:session): session opened for user root by (uid=0)</span><br><span class="line"></span><br><span class="line">centos6上的SECURE日志文件将传送到centos7上的/var/log/secure;</span><br><span class="line">日志文件不会留在centos6上，传送到centos7日志服务器上。</span><br></pre></td></tr></table></figure>
<p>######日志相关内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> facility ：设施，从功能或程序上对日志进行 归 类</span><br><span class="line">auth, authpriv, cron, daemon,ftp,kern, lpr, mail,</span><br><span class="line">news, security(auth), user, uucp, local0-local7, syslog</span><br><span class="line"></span><br><span class="line">Priority  优先级别，从低到高排序</span><br><span class="line">debug, info, notice, warn(warning), err(error),</span><br><span class="line">crit(critical), alert, emerg(panic）</span><br><span class="line">配置文件：/etc/rsyslog.conf ，/etc/rsyslog.d/*.con</span><br><span class="line">配置文件格式：由三部分组成</span><br><span class="line">MODULES ：相关模块配置</span><br><span class="line">GLOBAL DIRECTIVES ：全局配置</span><br><span class="line">RULES</span><br><span class="line"></span><br><span class="line">RULES 配置格式： facility.priority; facility.priority… target</span><br><span class="line">facility： ：</span><br><span class="line">*:  所有的facility</span><br><span class="line">facility1,facility2,facility3,... ：指定的facility 列表</span><br><span class="line"> priority： ：</span><br><span class="line">*:  所有级别</span><br><span class="line">none ：没有级别，即不记录</span><br><span class="line">PRIORITY ：指定级别（含）以上的所有级别</span><br><span class="line">=PRIORITY ：仅记录指定级别的日志信息</span><br><span class="line"> target： ：</span><br><span class="line">文件路径：通常在/var/log/ ，文件路径前的- 表示异步写入</span><br><span class="line">用户：将日志事件通知给指定的用户，*  表示登录的所有用户</span><br><span class="line">日志服务器：@host ，把日志送往至指定的远程服务器记录</span><br><span class="line">： 管道： | COMMAND</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">其它的日志文件</span><br><span class="line">/var/log/secure ：系统安装日志，文本格式，应周期性分析</span><br><span class="line"> /var/log/btmp ：当前系统上，用户的失败尝试登录相关的日</span><br><span class="line">志信息，二进制格式，lastb 命令进行查看</span><br><span class="line"> /var/log/wtmp ：当前系统上，用户正常登录系统的相关日志</span><br><span class="line">信息， 二进制格式， ，last 命令可以查看</span><br><span class="line"> /var/log/lastlog: 每一个用户最近一次的登录 信息， 二进制格</span><br><span class="line">式， ，lastlog 命令 可以查看</span><br><span class="line"> /var/log/dmesg ：系统引导过程中的日志信息，文本格式</span><br><span class="line">文本查看工具查看</span><br><span class="line">专用命令dmesg 查看</span><br><span class="line"> /var/log/messages  ：系统中大部分的信息</span><br><span class="line"> /var/log/anaconda : anaconda的日志；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rsyslog 将日志记录于MySQL中;</span><br><span class="line">(1)  准备MySQL Server</span><br><span class="line">(2)  在mysql server 上授权rsyslog 能连接至当前服务器</span><br><span class="line">mysql&gt; GRANT ALL ON Syslog.* TO &apos;USER&apos;@&apos;HOST&apos;</span><br><span class="line">IDENTIFIED BY &apos;PASSWORD&apos;;</span><br><span class="line">(3)  在rsyslog 服务器上安装mysql 模块相关的程序包</span><br><span class="line">yum install rsyslog-mysql</span><br><span class="line">(4)  为rsyslog 创建数据库及表；</span><br><span class="line">mysql -uUSERNAME -hHOST -pPASSWORD &lt;</span><br><span class="line">/usr/share/doc/rsyslog-7.4.7/mysql-createDB.sql</span><br><span class="line">(5)  配置rsyslog 将日志保存到mysql中 中</span><br><span class="line">#### MODULES ####</span><br><span class="line">$ModLoad ommysql</span><br><span class="line">#### RULES ####</span><br><span class="line">facility.priority :ommysql:DBHOST,DBNAME,DBUSER, PASSWORD</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">通过loganalyzer 展示数据库中的日志;</span><br><span class="line"> (1)  在rsyslog 服务器上准备amp 或nmp 组合</span><br><span class="line">yum install httpd php php-mysql php-gd</span><br><span class="line"> (2)  安装LogAnalyzer</span><br><span class="line">tar xf loganalyzer-3.6.5.tar.gz</span><br><span class="line">cp -a loganalyzer-3.6.5/src</span><br><span class="line">/var/www/html/loganalyzer</span><br><span class="line">cd /var/www/html/loganalyzer</span><br><span class="line">touch config.php</span><br><span class="line">chmod 666 config.php</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 日志服务 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[dns转发功能]]></title>
      <url>/2018/01/09/dns%E8%BD%AC%E5%8F%91%E5%8A%9F%E8%83%BD/</url>
      <content type="html"><![CDATA[<p>转发服务器；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">转发服务器------准备3个虚拟机；</span><br><span class="line">将centos6设置为转发服务器；</span><br><span class="line">将centos7设置为DNS服务器；</span><br><span class="line">将centos5设置为客户端；</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、更改/etc/named.conf文件（centos6）;</span><br><span class="line">在option选项里添加；</span><br><span class="line">       forward only;</span><br><span class="line">       forwarders &#123; 192.168.226.133;&#125;;</span><br><span class="line"> 需要更改选项，将yes改为no;</span><br><span class="line">        dnssec-enable no;</span><br><span class="line">        dnssec-validation no;</span><br><span class="line">2、更改/etc/named.rfc1912.zones文件（centos6）;</span><br><span class="line"> zone &quot;magedu.com&quot;&#123;</span><br><span class="line">                type forward;</span><br><span class="line">                forward only;</span><br><span class="line">                forwarders &#123;192.168.226.133;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0f1758b4bf25fa41.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="转发服务器"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">需要注意，centos6的DNS数据库文件，/etc/named.conf,/etc/named.rfc1912.zones;</span><br><span class="line">有无需要注释掉的选项；</span><br></pre></td></tr></table></figure></p>
<p>ACL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">1、准备数据库文件；</span><br><span class="line">#cp -p /var/named/magedu.com.zone /var/named/magedu.com.zone.bj</span><br><span class="line">#cp -p /var/named/magedu.com.zone /var/named/magedu.com.zone.zz</span><br><span class="line">编写数据库文件；</span><br><span class="line">$TTL 1D</span><br><span class="line">@       IN SOA  dns1.magedu.com.  dnsadmin.magedu.com. (</span><br><span class="line">                                        202     ; serial</span><br><span class="line">                                        10M     ; refresh</span><br><span class="line">                                        3M      ; retry</span><br><span class="line">                                        1D      ; expire</span><br><span class="line">                                        3D )    ; minimum</span><br><span class="line">        NS      dns1</span><br><span class="line">        NS      dns2</span><br><span class="line">shanghai    NS  dns3</span><br><span class="line">dns1    A 192.168.226.133</span><br><span class="line">dns2    A 192.168.226.134</span><br><span class="line">dns3    A 192.168.226.134</span><br><span class="line">websrv  A       1.1.1.1------------------只需删除一个websrv 行 ，就可以了；</span><br><span class="line">websrv  A       3.3.3.3------------------</span><br><span class="line">ftpsrv  A       2.2.2.2</span><br><span class="line">www     CNAME   websrv</span><br><span class="line">@       MX  10  mailsrv</span><br><span class="line">@       MX  20  mailsrv</span><br><span class="line">mailsrv1 A      6.6.6.6</span><br><span class="line">mailsrv2 A      7.7.7.7</span><br><span class="line">#都访问magedu.com域；</span><br><span class="line">2、编辑/etc/named.conf文件；</span><br><span class="line">顶行添加；表示所访问的客户端地址；</span><br><span class="line">acl beijing &#123;192.168.226.134;&#125;;</span><br><span class="line">acl zhengzhou &#123;192.168.226.135;&#125;;</span><br><span class="line">acl other &#123;any;&#125;;</span><br><span class="line"></span><br><span class="line">指明客户端访问的数据库路径的配置文件；</span><br><span class="line">view beijingview &#123;</span><br><span class="line">         match-clients &#123;beijing;&#125;;</span><br><span class="line">         include &quot;/etc/beijing.view.zones&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">view zhengzhouview &#123;</span><br><span class="line">        match-clients &#123;zhengzhou;&#125;;</span><br><span class="line">        include &quot;/etc/zhengzhou.view.zones&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">view otherview &#123;</span><br><span class="line">        match-clients&#123;other;&#125;;</span><br><span class="line">        include &quot;/etc/named.rfc1912.zones&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">将指明dns根路径的文件剪切，删除 include &quot;/etc/named.rfc1912.zones“行；</span><br><span class="line">3、将剪切的dns根路径文件复制到/etc/named.rfc1912.zones配置文件里；</span><br><span class="line">zone &quot;.&quot; IN &#123;</span><br><span class="line">        type hint;</span><br><span class="line">        file &quot;named.ca&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">4、编辑beijing、zhengzhou的数据库路径配置文件；</span><br><span class="line">/etc/beijing.view.zones</span><br><span class="line">/etc/zhengzhou.view.zones</span><br><span class="line">#vim /etc/beijing.view.zones</span><br><span class="line">zone &quot;magedu.com&quot;  IN &#123;</span><br><span class="line">          type master;</span><br><span class="line">          flie &quot;magedu.com.zone.bj&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">#vim /etc/zhengzhou.view.zones</span><br><span class="line">zone &quot;magedu.com&quot; IN &#123;</span><br><span class="line">         type master;</span><br><span class="line">         file &quot;magedu.com.zone.zz&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>5、使用centos6、centos5进行访问；</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-9d30f0b2ce07e955.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-63d8ada66663afe9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
]]></content>
      
        
        <tags>
            
            <tag> dns转发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[DNS]]></title>
      <url>/2018/01/09/DNS/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">准备环境；</span><br><span class="line">安装bind包文件，关闭防火墙，更改Selinux配置文件；</span><br><span class="line">centos7为主DNS, centos6为从和子dns;</span><br><span class="line">#yum install bind</span><br><span class="line">#systemctl disable firewalld</span><br><span class="line">#systemctl  stop firewalld</span><br><span class="line">#getenforce</span><br><span class="line">#vim /etc/selinux/config</span><br><span class="line">permissive</span><br><span class="line">#setenforce 0</span><br><span class="line">#systemctl start named</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dns安装；</span><br><span class="line">1、创建主dns;</span><br><span class="line">2、创建从dns;</span><br><span class="line">3、创建子dns;</span><br><span class="line">4、安装bind-chroot;</span><br></pre></td></tr></table></figure>
<p>1、主dns;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">1、更改配置文件/etc/named.conf;</span><br><span class="line">     options &#123;</span><br><span class="line">//      listen-on port 53 &#123; localhost; &#125;;  --------可以注释掉，注释掉后允许所有或localhost代表本地ip,主dns的ip</span><br><span class="line">        listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       &quot;/var/named&quot;;</span><br><span class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span><br><span class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span><br><span class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span><br><span class="line">//      allow-query     &#123; localhost;any;172.16.253.67; &#125;; --------本地访问的ip地址,所有，指定的ip;注释掉后允许所有ip访问；</span><br><span class="line">        allow-transfer &#123; 192.168.226.134; &#125;;  ---------指定从服务器的ip,放置数据传输流失，防止除从机以外抓取数据； </span><br><span class="line">        /* </span><br><span class="line">        */</span><br><span class="line">        recursion yes; ---------------------允许递归查询；</span><br><span class="line">        allow-update &#123; any; &#125;; -----------允许远程更新数据库；</span><br><span class="line">        dnssec-enable no; ---------创建子域时需要关闭；</span><br><span class="line">        dnssec-validation no; ----------创建子域时需要关闭；</span><br><span class="line">2、编辑数据库文件路径；</span><br><span class="line">1、可以再/etc/named.conf配置文件里进行编辑修改；</span><br><span class="line">2、可以在/etc/named.rfc1912.zones配置文件里进行修改，一般在此修改文件；</span><br><span class="line">/etc/named.rfc1912.zones;参照格式，进行添加；</span><br><span class="line">zone &quot;localhost.localdomain&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;named.localhost&quot;;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"># zone &quot;magedu.com&quot; IN &#123;  </span><br><span class="line">          type master;</span><br><span class="line">          file &quot;magedu.com.zone&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">指明数据库，域与数据库文件对应关系；</span><br><span class="line">3、创建数据库文件，拷贝/var/named/目录下的文件，进行修改；</span><br><span class="line">#cp -p /var/named/named.localhost  /var/named/magedu.com.zone</span><br><span class="line">#vim  /var/named/magedu.com.zone</span><br><span class="line">$TTL 1D</span><br><span class="line">@       IN SOA  dns1.magedu.com.  dnsadmin.magedu.com. (</span><br><span class="line">                                        202     ; serial</span><br><span class="line">                                        10M     ; refresh</span><br><span class="line">                                        3M      ; retry</span><br><span class="line">                                        1D      ; expire</span><br><span class="line">                                        3D )    ; minimum</span><br><span class="line">        NS      dns1</span><br><span class="line">        NS      dns2</span><br><span class="line">shanghai    NS  dns3</span><br><span class="line">dns1    A 192.168.226.133</span><br><span class="line">dns2    A 192.168.226.134 ---------指定从DNS的ip地址；</span><br><span class="line">dns3    A 192.168.226.134 ---------指定子域的ip地址；</span><br><span class="line">websrv  A       1.1.1.1</span><br><span class="line">websrv  A       3.3.3.3</span><br><span class="line">ftpsrv  A       2.2.2.2</span><br><span class="line">www     CNAME   websrv -------别名</span><br><span class="line">@       MX  10  mailsrv</span><br><span class="line">@       MX  20  mailsrv</span><br><span class="line">mailsrv1 A      6.6.6.6</span><br><span class="line">mailsrv2 A      7.7.7.7</span><br><span class="line">4、重新加载 或 重新启动服务；</span><br><span class="line">#rndc reload</span><br><span class="line">#systemctl restart named</span><br></pre></td></tr></table></figure></p>
<p>2、从dns;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1、编辑/etc/named.conf文件；</span><br><span class="line">options &#123;</span><br><span class="line">//      listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">        listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       &quot;/var/named&quot;;</span><br><span class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span><br><span class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span><br><span class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span><br><span class="line">//      allow-query     &#123; localhost; &#125;;</span><br><span class="line">        allow-transfer &#123; none; &#125;; --------防止传输数据；</span><br><span class="line">2、编辑、/etc/named.rfc1912.zones文件；</span><br><span class="line">编辑添加；</span><br><span class="line">zone &quot;magedu.com&quot; IN &#123;</span><br><span class="line">          type slave;</span><br><span class="line">          masters &#123; 192.168.226.133; &#125;;</span><br><span class="line">          file &quot;slaves/magedu.slave&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">3、自动生成数据库文件，在/var/named/slaves目录下；</span><br><span class="line">[root@centos6 ~]# cd /var/named/slaves</span><br><span class="line">[root@centos6 slaves]# ls</span><br><span class="line">magedu.slave</span><br><span class="line">[root@centos6 slaves]# </span><br><span class="line">4、重新加载 或 重新启动服务；</span><br><span class="line">#rndc reload</span><br><span class="line">#service named restart</span><br></pre></td></tr></table></figure></p>
<p>3、子dns;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1、编辑、/etc/named.conf文件；</span><br><span class="line">options &#123;</span><br><span class="line">//      listen-on port 53 &#123; 127.0.0.1; &#125;;</span><br><span class="line">        listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       &quot;/var/named&quot;;</span><br><span class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</span><br><span class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</span><br><span class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</span><br><span class="line">//      allow-query     &#123; localhost; &#125;;</span><br><span class="line">2、编辑、/etc/named.rfc1912.zones文件；</span><br><span class="line">/etc/named.rfc1912.zones;参照格式，进行添加；</span><br><span class="line">zone &quot;localhost.localdomain&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;named.localhost&quot;;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"># zone &quot;shanghai.magedu.com&quot; IN &#123;  </span><br><span class="line">          type master;</span><br><span class="line">          file &quot;shanghai.magedu.com.zone&quot;;</span><br><span class="line">&#125;;</span><br><span class="line">3、创建数据库文件，拷贝/var/named/目录下的文件，进行修改；</span><br><span class="line">#cp -p /var/named/named.localhost  /var/named/shanghai.magedu.com.zone</span><br><span class="line">#vim  /var/named/shanghai.magedu.com.zone</span><br><span class="line">$TTL 86400      ; 1 day</span><br><span class="line">@               IN SOA  dns1 dnsadmin (</span><br><span class="line">                                202        ; serial</span><br><span class="line">                                600        ; refresh (10 minutes)</span><br><span class="line">                                180        ; retry (3 minutes)</span><br><span class="line">                                86400      ; expire (1 day)</span><br><span class="line">                                259200     ; minimum (3 days)</span><br><span class="line">                                )</span><br><span class="line">                        NS      dns1</span><br><span class="line">dns1                    A       192.168.226.134</span><br><span class="line">websrv                  A       1.1.1.1</span><br><span class="line">www                     CNAME   websrv</span><br></pre></td></tr></table></figure></p>
<p>4、安装bind-chroot包，文件路径加深；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start  named-chroot；</span><br><span class="line">[root@centos7 named]# pwd</span><br><span class="line">/var/named/chroot/var/named</span><br><span class="line">[root@centos7 named]# ls</span><br><span class="line">chroot  data  dynamic  magedu.com.zone  named.ca  named.empty  named.localhost  named.loopback  shanghai.magedu.com.zone  slaves</span><br><span class="line">[root@centos7 named]#</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">相关命令；</span><br><span class="line">Iptables -A INPUT -p  tcp --dport 53 -j REJECT ------53端口； 禁用tcp</span><br><span class="line">#rpm -q --scripts bind-chroot------查看脚本；生成服务的脚本；</span><br><span class="line">Recursion yes; 递归查询 </span><br><span class="line">Rndc flush----清除DNS缓存</span><br><span class="line">查询配置文件语法；</span><br><span class="line">#named-checkconf</span><br><span class="line">#named-checkzone  shanghai.magedu.com  #/var/named/shanghai.magedu.com.zone </span><br><span class="line">#nsupdate ------远程更新数据库；</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> DNS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[yum，防火墙，SELinux简单设置]]></title>
      <url>/2018/01/09/yum%EF%BC%8C%E9%98%B2%E7%81%AB%E5%A2%99%EF%BC%8CSELinux%E7%AE%80%E5%8D%95%E8%AE%BE%E7%BD%AE/</url>
      <content type="html"><![CDATA[<p>1、当centos最小化安装时，需要自己安装所需要的安装包、需要配置yum源；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">1、挂载光盘；</span><br><span class="line"># mount  /dev/sr0  /mnt</span><br><span class="line"># df ----查看光盘是否挂载；</span><br><span class="line">2、创建yum源；</span><br><span class="line">#cd /etc/yum.repos.d/</span><br><span class="line">#rm -rf * ----删除当前目录下的原有的文件，自己重新创建并编写配置文件；</span><br><span class="line">#vim  /etc/yum.repo.d/base.repo</span><br><span class="line">[base]</span><br><span class="line">name=base</span><br><span class="line">baseurl=file:///mnt</span><br><span class="line">gpgcheck=0----不用输入公钥</span><br><span class="line">#yum repolist</span><br><span class="line">#yum makecache----创建元数据缓存；</span><br><span class="line">3、安装autofs包，以后启动光盘将自动挂载到/misc/cd 目录下；</span><br><span class="line">centos7</span><br><span class="line">#yum install autofs</span><br><span class="line">#systemctl enable autofs----下次开机启动；</span><br><span class="line">#systemctl is-enabled autofs----查看是否生效；</span><br><span class="line">#systemctl start autofs----启动服务；</span><br><span class="line">#cd /misc/cd----查看是否能进入神奇的目录；</span><br><span class="line">centos6</span><br><span class="line">#yum install autofs</span><br><span class="line">#chkconfig autofs on----下次开机启动；</span><br><span class="line">#chkconfig --list----查看是否生效；</span><br><span class="line">#service  autofs  start----开启服务；</span><br><span class="line">#service  autofs status----查看是否生效；</span><br><span class="line">4、将yum源重新配置，更改为/misc/cd目录下；</span><br><span class="line">#cat&gt;/etc/yum.repos.d/ &lt;&lt;EOF</span><br><span class="line">[base]</span><br><span class="line">name=base</span><br><span class="line">baseurl=file:///misc/cd</span><br><span class="line">gpgcheck=0</span><br><span class="line">#yum repolist ----查看是否生效；</span><br><span class="line">5、yum查看安装包的来源；</span><br><span class="line">#yum makecache;</span><br><span class="line">#yum info autofs----查看包是否安装；</span><br><span class="line">#yum provides autofs----查看包来源；</span><br><span class="line">#yum search autofs----查看包来源；</span><br></pre></td></tr></table></figure></p>
<p>2、运行一些服务时需要关闭防火墙，防火墙设置；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、查看防火墙状态；</span><br><span class="line">centos7</span><br><span class="line">#iptables -nvL----查看防火墙状态；</span><br><span class="line">#systemctl disable firewalld----下次开机关闭防火墙；</span><br><span class="line">#systemctl is-enabled firewalld----查看是否生效；</span><br><span class="line">#systemctl stop firewalld----停止防火墙服务；</span><br><span class="line">#systemctl status firewalld----查看防火墙状态；</span><br><span class="line">centos6</span><br><span class="line">#iptables -nvL----查看防火墙状态；</span><br><span class="line">#chkconfig iptables off----下次开机关闭防火墙；</span><br><span class="line">#chkconfig --list----查看防火墙状态；</span><br><span class="line">#service iptables stop----停止防火墙服务；</span><br><span class="line">#service iptables status----查看防火墙状态；</span><br></pre></td></tr></table></figure></p>
<p>3、运行一些服务时需更改SElinux配置文件；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1、查看SElinux当前状态；</span><br><span class="line">#getenforce----查看当前状态；</span><br><span class="line">[root@centos6 ~]# cat /etc/selinux/config</span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=enforcing</span><br><span class="line"># SELINUXTYPE= can take one of these two values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br><span class="line">2、将SELINUX=enforcing更改为SELINUX=permissive;</span><br><span class="line">#vim /etc/selinux/config</span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=permissive</span><br><span class="line"># SELINUXTYPE= can take one of three two values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected.</span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br><span class="line">3、# setenforce 0</span><br><span class="line">4、查看当前状态；</span><br><span class="line"># getenforce</span><br></pre></td></tr></table></figure></p>
<p>```</p>
<p>#systemctl (enable ,disable)  option</p>
<p>#systemctl is-enabled   option</p>
<p>#chkconfig option (on，off)</p>
<p>#chkconfig  –list</p>
<p>#systemctl (start ,status,restart,stop ) option</p>
<p>#service option  (start,status,restart,stop)</p>
]]></content>
      
        
        <tags>
            
            <tag> yum </tag>
            
            <tag> 防火墙，SElinux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[搭建CA证书]]></title>
      <url>/2018/01/09/%E6%90%AD%E5%BB%BACA%E8%AF%81%E4%B9%A6/</url>
      <content type="html"><![CDATA[<p>工具 openCA 、openssl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1、Centos7---搭建CA（将Centos7假设为CA）</span><br><span class="line">      创建所需要的文件；</span><br><span class="line">      # touch /etc/pki/CA/index.txt  生成证书索引数据库文件</span><br><span class="line">      # echo 01 &gt; /etc/pki/CA/serial  指定第一个颁发证书的序列号</span><br><span class="line">      生成私钥；</span><br><span class="line">      #（umask 066；openssl genrsa -out /etc/pki/CA/private/cakey.pem 2048）</span><br><span class="line">      自签名；</span><br><span class="line">      # openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem  -out /etc/pki/CA/cacerrt.pem -days 3650</span><br><span class="line">2、Centos6---创建申请证书（将Centos6假设为客户端）</span><br><span class="line">      创建私钥；</span><br><span class="line">      #（umask 006;openssl genrsa -out /app/service.key 4096）</span><br><span class="line">      生成申请证书；</span><br><span class="line">      # openssl req -new -key /app/service.key -out /app/service.csr</span><br><span class="line">      将申请证书文件发送到CA（Centos7）;</span><br><span class="line">      # scp /app/service.csr 192.168.239.131:/etc/pki/CA/</span><br><span class="line">3、CA（Centos7）颁发证书及审核；</span><br><span class="line">      #openssl ca -in /etc/pki/CA/service.csr -out /etc/pki/certs/service.crt -days 100</span><br><span class="line">      将证书发送到Centos6（客户端）；</span><br><span class="line">      # scp /etc/pki/CA/certs/service.crt 192.168.239.131:/app/</span><br></pre></td></tr></table></figure></p>
<p>1、搭建CA(centos7.3 假设为CA)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#vim /etc/pki/tls/openssl.cnf查看配置文件</span><br><span class="line">[root@centos7 ~]#vim /etc/pki/tls/openssl.cnf</span><br><span class="line">#unique_subject = no                    # Set to &apos;no&apos; to allow creation of</span><br><span class="line">                                        # several ctificates with same subject.</span><br><span class="line">new_certs_dir   = $dir/newcerts         # default place for new certs.</span><br><span class="line"></span><br><span class="line">certificate     = $dir/cacert.pem       # The CA certificate</span><br><span class="line">serial          = $dir/serial           # The current serial number</span><br><span class="line">crlnumber       = $dir/crlnumber        # the current crl number</span><br><span class="line">                                        # must be commented out to leave a V1 CRL</span><br><span class="line">crl             = $dir/crl.pem          # The current CRL</span><br><span class="line">private_key     = $dir/private/cakey.pem# The private key</span><br><span class="line">RANDFILE        = $dir/private/.rand    # private random number file</span><br><span class="line"></span><br><span class="line">x509_extensions = usr_cert              # The extentions to add to the cert</span><br><span class="line"></span><br><span class="line"># Comment out the following two lines for the &quot;traditional&quot;</span><br><span class="line"># (and highly broken) format.</span><br><span class="line">name_opt        = ca_default            # Subject Name options</span><br><span class="line">cert_opt        = ca_default            # Certificate field options</span><br><span class="line"></span><br><span class="line"># Extension copying option: use with caution.</span><br><span class="line"># copy_extensions = copy</span><br><span class="line"></span><br><span class="line"># Extensions to add to a CRL. Note: Netscape communicator chokes on V2 CRLs</span><br><span class="line"># so this is commented out by default to leave a V1 CRL.</span><br><span class="line"># crlnumber must also be commented out to leave a V1 CRL.</span><br><span class="line"># crl_extensions        = crl_ext</span><br><span class="line"></span><br><span class="line">default_days    = 365                   # how long to certify for</span><br><span class="line">default_crl_days= 30                    # how long before next CRL</span><br><span class="line">default_md      = sha256                # use SHA-256 by default</span><br><span class="line">preserve        = no                    # keep passed DN ordering</span><br><span class="line"></span><br><span class="line"># A few difference way of specifying how similar the request should look</span><br><span class="line"># For type CA, the listed attributes must be the same, and the optional</span><br><span class="line"># and supplied fields are just that :-)</span><br><span class="line">policy          = policy_match</span><br><span class="line"></span><br><span class="line"># For the CA policy</span><br><span class="line">[ policy_match ]</span><br><span class="line">countryName             = match</span><br><span class="line">stateOrProvinceName     = match</span><br><span class="line">organizationName        = match</span><br><span class="line">organizationalUnitName  = optional</span><br><span class="line">commonName              = supplied</span><br><span class="line">emailAddress            = optional</span><br><span class="line"></span><br><span class="line"># For the &apos;anything&apos; policy</span><br><span class="line"># At this point in time, you must list all acceptable &apos;object&apos;</span><br><span class="line"># types.</span><br><span class="line">[ policy_anything ]</span><br><span class="line">countryName             = optional</span><br><span class="line">stateOrProvinceName     = optional</span><br><span class="line">localityName            = optional</span><br><span class="line">organizationName        = optional</span><br><span class="line">organizationalUnitName  = optional</span><br><span class="line">commonName              = supplied</span><br><span class="line">emailAddress            = optional</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">创建所需要的文件；</span><br><span class="line">[root@centos7 ~]#cd /etc/pki/CA/</span><br><span class="line">[root@centos7 CA]#ls</span><br><span class="line">certs  crl  newcerts  private</span><br><span class="line">[root@centos7 CA]#tree</span><br><span class="line">.</span><br><span class="line">├── certs</span><br><span class="line">├── crl</span><br><span class="line">├── newcerts</span><br><span class="line">└── private</span><br><span class="line"></span><br><span class="line">4 directories, 0 files</span><br><span class="line">[root@centos7 CA]#touch /etc/pki/CA/index.txt</span><br><span class="line">[root@centos7 CA]#ls</span><br><span class="line">certs  crl  index.txt  newcerts  private</span><br><span class="line">[root@centos7 CA]#echo 01&gt; /etc/pki/CA/serial</span><br><span class="line">[root@centos7 CA]#ls</span><br><span class="line">certs  crl  index.txt  newcerts  private  serial</span><br><span class="line">[root@centos7 CA]#tree</span><br><span class="line">.</span><br><span class="line">├── certs</span><br><span class="line">├── crl</span><br><span class="line">├── index.txt</span><br><span class="line">├── newcerts</span><br><span class="line">├── private</span><br><span class="line">└── serial</span><br><span class="line"></span><br><span class="line">4 directories, 2 files</span><br><span class="line">生成私钥：</span><br><span class="line">[root@centos7 CA]#(umask 066;openssl genrsa -out /etc/pki/CA/private/cakey.pem 2048)</span><br><span class="line">Generating RSA private key, 2048 bit long modulus</span><br><span class="line">..................................................+++</span><br><span class="line">...............................................................................................................................................................................................+++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">[root@centos7 CA]#tree</span><br><span class="line">.</span><br><span class="line">├── certs</span><br><span class="line">├── crl</span><br><span class="line">├── index.txt</span><br><span class="line">├── newcerts</span><br><span class="line">├── private</span><br><span class="line">│   └── cakey.pem</span><br><span class="line">└── serial</span><br><span class="line"></span><br><span class="line">4 directories, 3 files</span><br><span class="line">查看权限</span><br><span class="line">[root@centos7 CA]#ll /etc/pki/CA/private/cakey.pem</span><br><span class="line">-rw-------. 1 root root 1675 Jul 17 20:37 /etc/pki/CA/private/cakey.pem</span><br><span class="line">自签名</span><br><span class="line">[root@centos7 CA]#openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem  -out /etc/pki/CA/cacert.pem -days 3650</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:henan</span><br><span class="line">Locality Name (eg, city) [Default City]:zhengzhou</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:magedu</span><br><span class="line">Organizational Unit Name (eg, section) []:m24</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:ca.magedu.com</span><br><span class="line">Email Address []:</span><br><span class="line">[root@centos7 CA]#tree</span><br><span class="line">.</span><br><span class="line">├── cacert.pem</span><br><span class="line">├── certs</span><br><span class="line">├── crl</span><br><span class="line">├── index.txt</span><br><span class="line">├── newcerts</span><br><span class="line">├── private</span><br><span class="line">│   └── cakey.pem</span><br><span class="line">└── serial</span><br><span class="line"></span><br><span class="line">4 directories, 4 files</span><br><span class="line">查看自签名证书</span><br><span class="line">[root@centos7 CA]#openssl x509 -in /etc/pki/CA/cacert.pem  -noout -text</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number: 10081393424590182561 (0x8be84de7f9a818a1)</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C=CN, ST=henan, L=zhengzhou, O=magedu, OU=m24, CN=ca.magedu.com</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jul 17 12:54:38 2017 GMT</span><br><span class="line">            Not After : Jul 15 12:54:38 2027 GMT</span><br><span class="line">        Subject: C=CN, ST=henan, L=zhengzhou, O=magedu, OU=m24, CN=ca.magedu.com</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:e3:ad:25:86:7a:47:c1:33:38:2b:a4:51:3c:70:</span><br><span class="line">                    11:3d:3d:e8:0b:58:0f:ad:5e:80:bf:c9:d4:07:ef:</span><br><span class="line">                    9c:33:f2:b8:26:a3:d5:86:4b:3f:74:43:b6:06:75:</span><br><span class="line">                    49:6c:4f:74:04:49:9c:53:7a:ce:44:a8:79:9a:a0:</span><br><span class="line">                    00:82:9d:32:9c:50:38:16:98:a9:e5:78:47:21:06:</span><br><span class="line">                    9b:fc:05:c4:10:49:d6:03:3f:b5:eb:31:20:55:98:</span><br><span class="line">                    7c:dd:fb:fe:96:9c:22:fa:81:94:1b:e1:47:93:3d:</span><br><span class="line">                    fa:4e:03:24:48:94:56:81:75:a1:8d:65:41:66:94:</span><br><span class="line">                    3e:f7:03:97:55:4d:45:80:ff:e5:98:a2:10:38:79:</span><br><span class="line">                    dc:ee:df:44:14:8b:2b:6e:f8:a3:a9:1a:e7:53:28:</span><br><span class="line">                    d8:87:76:1a:7c:e9:8e:15:6c:7f:b2:66:65:ed:58:</span><br><span class="line">                    db:17:c4:f1:36:69:d5:57:d9:8f:49:55:6d:13:91:</span><br><span class="line">                    01:e1:3c:1b:a0:8b:03:b1:97:fb:08:c8:a2:6b:61:</span><br><span class="line">                    4c:45:36:f2:ac:b1:19:8b:41:18:11:63:ce:b6:90:</span><br><span class="line">                    34:ad:f6:4a:b0:e0:01:2e:d8:56:80:6a:12:1e:94:</span><br><span class="line">                    ee:a6:c5:5d:6e:d7:37:f2:e6:5a:5d:14:64:cd:8b:</span><br><span class="line">                    42:5b:38:18:72:9e:62:4c:72:9e:df:fc:90:c5:2f:</span><br><span class="line">                    bd:17</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                DC:FC:21:C7:A1:2F:F8:1F:F7:94:9A:A7:13:53:81:48:D5:0F:69:59</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:DC:FC:21:C7:A1:2F:F8:1F:F7:94:9A:A7:13:53:81:48:D5:0F:69:59</span><br><span class="line"></span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:TRUE</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         c8:cb:9e:75:33:d7:18:27:f5:c6:d7:aa:c2:c2:bf:ff:0f:5f:</span><br><span class="line">         1a:71:01:ab:6b:d7:7a:43:0c:c0:26:bd:8e:0d:bc:d1:14:f1:</span><br><span class="line">         d0:8d:fa:db:5c:b8:e7:c5:2c:4e:7f:41:c4:45:c6:de:66:f7:</span><br><span class="line">         27:b8:b8:75:a7:b7:a7:3d:40:27:6e:2e:69:82:d2:4a:b3:40:</span><br><span class="line">         7c:b2:e3:ba:7a:a8:62:f6:04:85:7c:4d:e4:71:45:c5:24:d7:</span><br><span class="line">         0e:34:f7:49:f8:60:77:6f:6e:41:78:ba:c2:a9:2b:de:f9:fb:</span><br><span class="line">         45:31:8b:de:d9:11:8d:a6:c9:58:1f:9b:2d:55:01:a2:db:02:</span><br><span class="line">         eb:b7:be:3d:42:9c:bf:76:3b:b4:3c:b2:58:64:89:97:e2:c1:</span><br><span class="line">         05:87:65:ab:61:61:8f:23:e5:07:93:6c:9a:d1:79:90:2d:dd:</span><br><span class="line">         c1:e2:f4:c9:3c:fb:89:80:96:f6:4f:6e:94:24:59:2b:65:b2:</span><br><span class="line">         02:ac:be:58:c3:5f:97:7e:86:d3:39:41:af:32:1f:d8:8d:cc:</span><br><span class="line">         14:df:1a:8f:be:9c:d7:23:da:b8:01:e9:4a:d5:d8:0a:0f:1c:</span><br><span class="line">         04:fe:7f:c0:a1:73:51:89:a0:5d:51:10:b7:07:1f:2f:df:59:</span><br><span class="line">         2a:ea:b7:4d:b0:41:d6:79:11:d0:e8:ec:69:78:e3:ba:d4:4c:</span><br><span class="line">         dc:14:20:a6</span><br></pre></td></tr></table></figure>
<p>Centos6创建申请证书<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">创建私钥；</span><br><span class="line">[root@centos6 ~]#(umask 066;openssl genrsa -out /app/service.key 4096)</span><br><span class="line">Generating RSA private key, 4096 bit long modulus</span><br><span class="line">..............++</span><br><span class="line">.....................................................................................................................................++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">[root@centos6 ~]#ll /app/service.key</span><br><span class="line">-rw-------. 1 root root 3247 Jul 16 13:29 /app/service.key</span><br><span class="line">生成申请证书文件；</span><br><span class="line">[root@centos6 ~]#openssl req -new -key /app/service.key  -out /app/service.csr</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &apos;.&apos;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:henan</span><br><span class="line">Locality Name (eg, city) [Default City]:zhengzhou</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:magedu</span><br><span class="line">Organizational Unit Name (eg, section) []:beiguo</span><br><span class="line">Common Name (eg, your name or your server&apos;s hostname) []:*.magedu.com</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#cat /app/service.csr</span><br><span class="line">-----BEGIN CERTIFICATE REQUEST-----</span><br><span class="line">MIIErzCCApcCAQAwajELMAkGA1UEBhMCQ04xDjAMBgNVBAgMBWhlbmFuMRIwEAYD</span><br><span class="line">VQQHDAl6aGVuZ3pob3UxDzANBgNVBAoMBm1hZ2VkdTEPMA0GA1UECwwGYmVpZ3Vv</span><br><span class="line">MRUwEwYDVQQDDAwqLm1hZ2VkdS5jb20wggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAw</span><br><span class="line">ggIKAoICAQDABpF263GHabqAJLUdVC+wV1JD+aIJ91jyjAw2RnicPv8SpJ6dVsDY</span><br><span class="line">+V+5hV5c93VwOKC5Xe3ZjSnRfo41OY7dXaOau6rD/oShiWCpyr3LOqM5sLRnQ9qb</span><br><span class="line">v44ivrT/yvABvCZuis/IXvHZmmrH0QCABkmW70A6xoz4hBf3XX9/Y8AZFePplMQ1</span><br><span class="line">3SKdCTzzX6sXrECkquDY9vcAgP4vbJ87/n3awU3ljhM/yd5TQ2kskzm9tWITL5Ae</span><br><span class="line">gnd2FdPBHLYL7Op3qDHI1yRqAfkL/CNAEnuB5JbgDCcOq2fa8yKrRpQAYtCUC6Ze</span><br><span class="line">1AKhCdfYbhsFKcfj9xAkb9EQZVs1HNhyzUrMHQM1+hSx1K30mwFMdKPsDCzTnjh0</span><br><span class="line">Yx6GeZ8xbU7VqHH18kARVXfvNlHd809CK0TZJ+zWnPkZpFCyhdQS1McEs1q6+OTd</span><br><span class="line">aAISvZTwvYQAZbUPJ9GnmZtcBTUtHmb8Qf6cLolYzS1I42X01TFmnHj9N1TP19CV</span><br><span class="line">AR0XanIlFMq4IMXkWBuvLqIliAFnCupC2/yuyg3NUlzPsMiqD/5N1IcPceXiyHHj</span><br><span class="line">wZCFjycVBcKcw39aqq6Yz7erTUR81q5sraBZjVWuA52Jb8LEA8/Oe3W6q23hyB2J</span><br><span class="line">01AZcFe5ah7PWkz687z9X03z4O+BKTJRFkySWkR+Ue3FKkwVD4TrfwIDAQABoAAw</span><br><span class="line">DQYJKoZIhvcNAQEFBQADggIBALy3aIT/eMytX5OoLWt+qFlovEL8WovmqmuVOdiI</span><br><span class="line">hoku+4RJKdeRUQdjs0IY1fWR3U+iulHi8H7EZJb0j6EbAI7CfKGDUi0Y3JAtDkFV</span><br><span class="line">ruCf3e/bXiizSvl07UpclmQLmTkfAVMUUFfvaKbdoLzeRlABt7dc144B3oXfatvX</span><br><span class="line">ftYdg1n47zs+26UrZyXVyHF5/elJcd35reQQZrHaXzyhWPx3FqqZK/mxeR9i3tQY</span><br><span class="line">EtV8JipROolp9d0ae8NHqfmdF2fPbQPfvYiFC+WRwlEHX/Rc590bVvagzgtpp5LP</span><br><span class="line">EgFHMtIuVRMZQlK4WHIp5CUpMFBOq5W9q51VbBoZwS/peIixXUm75+2xLm2oe+pG</span><br><span class="line">iAXUophja0wl/9S6dYBsiuFkVF41V8CzG1dJruKbr+OtZKL3x3bkb9nlYxcOAh+t</span><br><span class="line">KMQb3+GKyprLXEhYaDWAdGbhwKev7uXQ9i3WuZHTgwFnqmz+iwQSWZMHr9AMhzX1</span><br><span class="line">V/Ds6cpUqTZOXoIdTMxipkT5pPygYTnnvHwsqz6GgT0CcLM7Tod8c+RdXlMXFnFa</span><br><span class="line">nt5Oj0qKojswdvWtiU5Si9gmi/drmamgV0gBy/o/NrPbS6izAmTKTuwTgL/dxPTO</span><br><span class="line">djBMxM8frF5ZLMD6pZDzvdoDZgdxue++o7Yu16p+IW8TGW/WhMxB6e1ptbxc9hjT</span><br><span class="line">pt01</span><br><span class="line">-----END CERTIFICATE REQUEST-----</span><br><span class="line">传送到Centos7；</span><br><span class="line">[root@centos6 ~]#scp /app/service.csr   192.168.239.131:/etc/pki/CA/</span><br><span class="line">root@192.168.239.131&apos;s password:</span><br><span class="line">Permission denied, please try again.</span><br><span class="line">root@192.168.239.131&apos;s password:</span><br><span class="line">Permission denied, please try again.</span><br><span class="line">root@192.168.239.131&apos;s password:</span><br><span class="line">service.csr                                                                            100% 1700     1.7KB/s   00:00</span><br></pre></td></tr></table></figure></p>
<p>Centos7颁发证书及审核；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 CA]#ls</span><br><span class="line">cacert.pem  certs  crl  index.txt  newcerts  private  serial  service.csr  -text</span><br><span class="line">[root@centos7 CA]#mkdir csr ----------创建文件夹，审核文件集中放置；</span><br><span class="line">[root@centos7 CA]#mv service.csr ./csr</span><br><span class="line">[root@centos7 CA]#ls</span><br><span class="line">cacert.pem  crl  index.txt  private  -text</span><br><span class="line">certs       csr  newcerts   serial</span><br><span class="line">[root@centos7 CA]#tree</span><br><span class="line">.</span><br><span class="line">├── cacert.pem</span><br><span class="line">├── certs</span><br><span class="line">├── crl</span><br><span class="line">├── csr</span><br><span class="line">│   └── service.csr</span><br><span class="line">├── index.txt</span><br><span class="line">├── newcerts</span><br><span class="line">├── private</span><br><span class="line">│   └── cakey.pem</span><br><span class="line">├── serial</span><br><span class="line">[root@centos7 CA]#openssl ca -in /etc/pki/CA/csr/service.csr  -out /etc/pki/CA/certs/service.crt -days 100</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">unable to load number from /etc/pki/CA/serial</span><br><span class="line">error while loading serial number</span><br><span class="line">140193415731104:error:0D066096:asn1 encoding routines:a2i_ASN1_INTEGER:short line:f_int.c:215:</span><br><span class="line">[root@centos7 CA]#cat /etc/pki/CA/serial</span><br><span class="line">[root@centos7 CA]#echo 01 &gt; /etc/pki/CA/serial</span><br><span class="line">----/etc/pki/CA/serial 编号为二位数；</span><br><span class="line">[root@centos7 CA]#openssl ca -in /etc/pki/CA/csr/service.csr  -out /etc/pki/CA/certs/service.crt -days 100</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jul 17 13:37:38 2017 GMT</span><br><span class="line">            Not After : Oct 25 13:37:38 2017 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = henan</span><br><span class="line">            organizationName          = magedu</span><br><span class="line">            organizationalUnitName    = beiguo</span><br><span class="line">            commonName                = *.magedu.com</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment:</span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                76:03:DB:66:CA:C2:F7:36:0A:A8:CA:8E:EA:06:EB:CE:50:23:C9:15</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:DC:FC:21:C7:A1:2F:F8:1F:F7:94:9A:A7:13:53:81:48:D5:0F:69:59</span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Oct 25 13:37:38 2017 GMT (100 days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1 out of 1 certificate requests certified, commit? [y/n]y</span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line">[root@centos7 CA]#tree</span><br><span class="line">.</span><br><span class="line">├── cacert.pem</span><br><span class="line">├── certs</span><br><span class="line">│   └── service.crt</span><br><span class="line">├── crl</span><br><span class="line">├── csr</span><br><span class="line">│   └── service.csr</span><br><span class="line">├── index.txt</span><br><span class="line">├── index.txt.attr</span><br><span class="line">├── index.txt.old</span><br><span class="line">├── newcerts</span><br><span class="line">│   └── 01.pem</span><br><span class="line">├── private</span><br><span class="line">│   └── cakey.pem</span><br><span class="line">├── serial</span><br><span class="line">├── serial.old</span><br><span class="line">[root@centos7 CA]#ll certs/service.crt newcerts/01.pem</span><br><span class="line">-rw-r--r--. 1 root root 5928 Jul 17 21:37 certs/service.crt</span><br><span class="line">-rw-r--r--. 1 root root 5928 Jul 17 21:37 newcerts/01.pem</span><br><span class="line">[root@centos7 CA]#cat serial</span><br><span class="line">02</span><br><span class="line">[root@centos7 CA]#cat index.txt</span><br><span class="line">V       171025133738Z           01      unknown /C=CN/ST=henan/O=magedu/OU=beiguo/CN=*.magedu.com</span><br><span class="line"></span><br><span class="line">查看审核完成后生成的证书；</span><br><span class="line">#openssl x509 -in certs/service.crt -noout -text</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C=CN, ST=henan, L=zhengzhou, O=magedu, OU=m24, CN=ca.magedu.com</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jul 17 13:37:38 2017 GMT</span><br><span class="line">            Not After : Oct 25 13:37:38 2017 GMT</span><br><span class="line">        Subject: C=CN, ST=henan, O=magedu, OU=beiguo, CN=*.magedu.com</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (4096 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:c0:06:91:76:eb:71:87:69:ba:80:24:b5:1d:54:</span><br><span class="line">                    2f:b0:57:52:43:f9:a2:09:f7:58:f2:8c:0c:36:46:</span><br><span class="line">                    78:9c:3e:ff:12:a4:9e:9d:56:c0:d8:f9:5f:b9:85:</span><br><span class="line">                    5e:5c:f7:75:70:38:a0:b9:5d:ed:d9:8d:29:d1:7e:</span><br><span class="line">                    8e:35:39:8e:dd:5d:a3:9a:bb:aa:c3:fe:84:a1:89:</span><br><span class="line">                    60:a9:ca:bd:cb:3a:a3:39:b0:b4:67:43:da:9b:bf:</span><br><span class="line">                    8e:22:be:b4:ff:ca:f0:01:bc:26:6e:8a:cf:c8:5e:</span><br><span class="line">                    f1:d9:9a:6a:c7:d1:00:80:06:49:96:ef:40:3a:c6:</span><br><span class="line">                    8c:f8:84:17:f7:5d:7f:7f:63:c0:19:15:e3:e9:94:</span><br><span class="line">                    c4:35:dd:22:9d:09:3c:f3:5f:ab:17:ac:40:a4:aa:</span><br><span class="line">                    e0:d8:f6:f7:00:80:fe:2f:6c:9f:3b:fe:7d:da:c1:</span><br><span class="line">                    4d:e5:8e:13:3f:c9:de:53:43:69:2c:93:39:bd:b5:</span><br><span class="line">                    62:13:2f:90:1e:82:77:76:15:d3:c1:1c:b6:0b:ec:</span><br><span class="line">                    ea:77:a8:31:c8:d7:24:6a:01:f9:0b:fc:23:40:12:</span><br><span class="line">                    7b:81:e4:96:e0:0c:27:0e:ab:67:da:f3:22:ab:46:</span><br><span class="line">                    94:00:62:d0:94:0b:a6:5e:d4:02:a1:09:d7:d8:6e:</span><br><span class="line">                    1b:05:29:c7:e3:f7:10:24:6f:d1:10:65:5b:35:1c:</span><br><span class="line">                    d8:72:cd:4a:cc:1d:03:35:fa:14:b1:d4:ad:f4:9b:</span><br><span class="line">                    01:4c:74:a3:ec:0c:2c:d3:9e:38:74:63:1e:86:79:</span><br><span class="line">                    9f:31:6d:4e:d5:a8:71:f5:f2:40:11:55:77:ef:36:</span><br><span class="line">                    51:dd:f3:4f:42:2b:44:d9:27:ec:d6:9c:f9:19:a4:</span><br><span class="line">                    50:b2:85:d4:12:d4:c7:04:b3:5a:ba:f8:e4:dd:68:</span><br><span class="line">                    02:12:bd:94:f0:bd:84:00:65:b5:0f:27:d1:a7:99:</span><br><span class="line">                    9b:5c:05:35:2d:1e:66:fc:41:fe:9c:2e:89:58:cd:</span><br><span class="line">                    2d:48:e3:65:f4:d5:31:66:9c:78:fd:37:54:cf:d7:</span><br><span class="line">                    d0:95:01:1d:17:6a:72:25:14:ca:b8:20:c5:e4:58:</span><br><span class="line">                    1b:af:2e:a2:25:88:01:67:0a:ea:42:db:fc:ae:ca:</span><br><span class="line">                    0d:cd:52:5c:cf:b0:c8:aa:0f:fe:4d:d4:87:0f:71:</span><br><span class="line">                    e5:e2:c8:71:e3:c1:90:85:8f:27:15:05:c2:9c:c3:</span><br><span class="line">                    7f:5a:aa:ae:98:cf:b7:ab:4d:44:7c:d6:ae:6c:ad:</span><br><span class="line">                    a0:59:8d:55:ae:03:9d:89:6f:c2:c4:03:cf:ce:7b:</span><br><span class="line">                    75:ba:ab:6d:e1:c8:1d:89:d3:50:19:70:57:b9:6a:</span><br><span class="line">                    1e:cf:5a:4c:fa:f3:bc:fd:5f:4d:f3:e0:ef:81:29:</span><br><span class="line">                    32:51:16:4c:92:5a:44:7e:51:ed:c5:2a:4c:15:0f:</span><br><span class="line">                    84:eb:7f</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment:</span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                76:03:DB:66:CA:C2:F7:36:0A:A8:CA:8E:EA:06:EB:CE:50:23:C9:15</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:DC:FC:21:C7:A1:2F:F8:1F:F7:94:9A:A7:13:53:81:48:D5:0F:69:59</span><br><span class="line"></span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         ca:19:1e:c3:71:9e:c2:22:5d:c9:65:7b:92:d5:c8:d9:5f:56:</span><br><span class="line">         64:74:5c:b5:e4:c7:ec:23:9a:1f:2a:92:20:e7:ca:39:80:f1:</span><br><span class="line">         cd:fc:5a:00:f2:79:75:49:a4:0a:fd:ec:82:36:b6:60:63:69:</span><br><span class="line">         9b:ac:5b:71:39:d3:88:8f:ae:73:de:ff:59:25:7b:89:ee:30:</span><br><span class="line">         76:90:46:64:62:67:d5:38:25:9a:08:df:67:e9:53:55:3a:e5:</span><br><span class="line">         8b:28:c5:97:44:c1:11:6d:cb:c6:39:2d:27:6c:75:f5:d4:cc:</span><br><span class="line">         db:26:a9:df:38:34:0f:ab:c1:c9:15:08:e9:22:e0:cc:de:33:</span><br><span class="line">         ac:03:42:f7:2e:fe:b5:64:11:d5:45:c7:11:d5:ae:a6:86:6e:</span><br><span class="line">         be:a9:bb:82:2e:fb:f0:16:e6:82:36:5e:8a:99:e6:ce:53:f0:</span><br><span class="line">         8b:9f:d3:9a:44:75:e6:a9:2a:04:2e:3a:3a:a6:eb:2e:a1:b8:</span><br><span class="line">         a7:44:69:1c:1d:f8:59:46:e3:85:7a:2a:0c:fc:9f:39:83:89:</span><br><span class="line">         44:62:f8:b1:76:36:7f:73:d9:ae:9f:96:ab:4a:6d:a9:68:19:</span><br><span class="line">         fe:e1:47:cf:2d:f3:74:21:97:0e:52:d1:fd:e1:4b:61:35:96:</span><br><span class="line">         59:2e:09:8c:ac:e5:3f:f1:15:90:66:4f:0a:16:87:06:53:62:</span><br><span class="line">         ef:5d:8a:bb</span><br><span class="line"> 将证书发送到Centos6;</span><br><span class="line">[root@centos7 CA]#scp certs/service.crt   192.168.239.141:/app</span><br><span class="line">root@192.168.239.141&apos;s password:</span><br><span class="line">service.crt           100% 5928     5.8KB/s   00:00</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        
        <tags>
            
            <tag> CA </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Centos7编译安装]]></title>
      <url>/2018/01/09/Centos7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</url>
      <content type="html"><![CDATA[<p>######内核编译安装系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line">1/从官网下载kernel包文件；www.kernel.org</span><br><span class="line"></span><br><span class="line">2/下载完成后解压到/root下；查看文件大小；</span><br><span class="line"> #ll -h linux-4.12.tar.xz</span><br><span class="line"> 查看分区空间及硬盘空间大小；是否足够；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3/解压kernel包；</span><br><span class="line"> tar -xvf kernel-4.12.tar.xz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4/查看目录大小</span><br><span class="line">#du -sh linux-4.12</span><br><span class="line"></span><br><span class="line">5/参考当前操作系统文件为模板进行调整</span><br><span class="line">[root@centos7 ~]#ll /boot/vmlinuz-3.10.0-514.el7.x86_64 -rwxr-xr-x. 1 root root 5392080 Nov 23  2016 /boot/vmlinuz-3.10.0-514.el7.x86_64</span><br><span class="line">模板对应的配置文件；</span><br><span class="line">#cd /boot</span><br><span class="line">config-3.10.0-514.el7.x86_64  模板配置文件</span><br><span class="line">grub</span><br><span class="line">grub2</span><br><span class="line">initramfs-0-rescue-c13ed9ba529c45d6bf915ca67e74c338.img</span><br><span class="line">initramfs-3.10.0-514.el7.x86_64.img</span><br><span class="line">initramfs-3.10.0-514.el7.x86_64kdump.img</span><br><span class="line">initrd-plymouth.img</span><br><span class="line">symvers-3.10.0-514.el7.x86_64.gz</span><br><span class="line">System.map-3.10.0-514.el7.x86_64</span><br><span class="line">vmlinuz-0-rescue-c13ed9ba529c45d6bf915ca67e74c338</span><br><span class="line">vmlinuz-3.10.0-514.el7.x86_64</span><br><span class="line"></span><br><span class="line">***</span><br><span class="line">confing-3.10.0-514.el7.x86_64</span><br><span class="line">在此文件里有记录了vmlinuz所选的功能，给以在此之上选择想加进去的功能选项；</span><br><span class="line"></span><br><span class="line">有些不常用的驱动模块放置到 /lib/modules里</span><br><span class="line">***</span><br><span class="line">/boot/vmlinuz-3.10.0-514.el7.x86_6</span><br><span class="line">常用的驱动放置</span><br><span class="line"></span><br><span class="line">/usr/lib/modules/3.10.0-514.el7.x86_64---ko文件，模块方式</span><br><span class="line">不常用的驱动模块放置</span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">vim confing-3.10.0-514.el7.x86_64</span><br><span class="line">查看配置文件，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 boot]#updatedb</span><br><span class="line">[root@centos7 boot]#locate ntfs.ko</span><br><span class="line">[root@centos7 boot]#vim config-3.10.0-514.el7.x86_64</span><br><span class="line"></span><br><span class="line"># Automatically generated file; DO NOT EDIT.</span><br><span class="line"># Linux/x86_64 3.10.0-514.el7.x86_64 Kernel Configuration</span><br><span class="line">#</span><br><span class="line">CONFIG_64BIT=y              y表示安装到/boot/vmlinuz-3.10.0-514.el7.x86_6</span><br><span class="line">CONFIG_X86=y</span><br><span class="line">CONFIG_INSTRUCTION_DECODER=y</span><br><span class="line">CONFIG_OUTPUT_FORMAT=&quot;elf64-x86-64&quot;</span><br><span class="line">CONFIG_ARCH_DEFCONFIG=&quot;arch/x86/configs/x86_64_defconfig&quot;</span><br><span class="line"></span><br><span class="line">CONFIG_SLUB=y</span><br><span class="line">CONFIG_PROFILING=y</span><br><span class="line">CONFIG_TRACEPOINTS=y</span><br><span class="line">CONFIG_OPROFILE=m           m表示安装到/usr/lib/modules/3.10.0-514.el7.x86_64</span><br><span class="line">CONFIG_OPROFILE_EVENT_MULTIPLEX=y</span><br><span class="line">CONFIG_HAVE_OPROFILE=y</span><br><span class="line">CONFIG_OPROFILE_NMI_TIMER=y</span><br><span class="line">CONFIG_KPROBES=y</span><br><span class="line"></span><br><span class="line"># CONFIG_EXT3_FS is not set</span><br><span class="line">CONFIG_EXT4_FS=m             模块文件</span><br><span class="line">CONFIG_EXT4_USE_FOR_EXT23=y</span><br><span class="line">CONFIG_EXT4_FS_POSIX_ACL=y</span><br><span class="line">CONFIG_EXT4_FS_SECURITY=y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#locate ext.ko</span><br><span class="line">/usr/lib/modules/3.10.0-514.el7.x86_64/kernel/net/sched/em_text.ko</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6/将配置文件拷贝到/root/linux-4.12/.config</span><br><span class="line"></span><br><span class="line">[root@centos7 boot]#cp config-3.10.0-514.el7.x86_64  /root/linux-4.12/.config</span><br><span class="line">[root@centos7 boot]#wc -l /root/linux-4.12/.config</span><br><span class="line">5848 /root/linux-4.12/.config</span><br><span class="line">查看文件行数</span><br><span class="line"></span><br><span class="line">配置文件行数较多，用菜单工具定制内核选项；</span><br><span class="line">需安装开发工具包组</span><br><span class="line">[root@centos7 boot]#yum install &quot;Development tools&quot;</span><br><span class="line">[root@centos7 boot]#yum groupinstall &quot;Development tools&quot;</span><br><span class="line"></span><br><span class="line">包组安装完成后，运行软件工具 make menuconfig</span><br><span class="line"></span><br><span class="line">进入到/linux-4.12目录下运行软件工具；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#ls</span><br><span class="line">1.log                  Downloads             Pictures</span><br><span class="line">2017-07-02-22.tar.xz   initial-setup-ks.cfg  Public</span><br><span class="line">2017-07-02-Jul.tar.xz  IP.sh                 script</span><br><span class="line">a                      linux-4.12            select.sh</span><br><span class="line">anaconda-ks.cfg        linux-4.12.tar.xz     Templates</span><br><span class="line">cat                    Music                 testdir</span><br><span class="line">Desktop                oper2017-07-07.log    Videos</span><br><span class="line">Documents              opertion.sh</span><br><span class="line">[root@centos7 ~]#cd linux-4.12</span><br><span class="line">[root@centos7 linux-4.12]#ls</span><br><span class="line">arch     crypto         include  kernel       net       sound</span><br><span class="line">block    Documentation  init     lib          README    tools</span><br><span class="line">certs    drivers        ipc      MAINTAINERS  samples   usr</span><br><span class="line">COPYING  firmware       Kbuild   Makefile     scripts   virt</span><br><span class="line">CREDITS  fs             Kconfig  mm           security</span><br><span class="line">[root@centos7 linux-4.12]#make menuconfig</span><br><span class="line">  HOSTCC  scripts/basic/fixdep</span><br><span class="line"> *** Unable to find the ncurses libraries or the</span><br><span class="line"> *** required header files.</span><br><span class="line"> *** &apos;make menuconfig&apos; requires the ncurses libraries.</span><br><span class="line"> ***</span><br><span class="line"> *** Install ncurses (ncurses-devel) and try again.</span><br><span class="line"> ***</span><br><span class="line">make[1]: *** [scripts/kconfig/dochecklxdialog] Error 1</span><br><span class="line">make: *** [menuconfig] Error 2</span><br><span class="line">[root@centos7 linux-4.12]#yum install ncurses-devel</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.hust.edu.cn</span><br><span class="line"> * extras: mirror.lzu.edu.cn</span><br><span class="line"> * updates: mirrors.nju.edu.cn</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package ncurses-devel.x86_64 0:5.9-13.20130511.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">==========================================================================</span><br><span class="line"> Package            Arch        Version                   Repository</span><br><span class="line">                                                                     Size</span><br><span class="line">==========================================================================</span><br><span class="line">Installing:</span><br><span class="line"> ncurses-devel      x86_64      5.9-13.20130511.el7       base      713 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">==========================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 713 k</span><br><span class="line">Installed size: 2.1 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">ncurses-devel-5.9-13.20130511.el7.x86_64.rpm         | 713 kB   00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : ncurses-devel-5.9-13.20130511.el7.x86_64               1/1</span><br><span class="line">  Verifying  : ncurses-devel-5.9-13.20130511.el7.x86_64               1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  ncurses-devel.x86_64 0:5.9-13.20130511.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">安装缺少的安装包；</span><br><span class="line"></span><br><span class="line">进入到/root/linux-4.12目录下（解压的目录）：</span><br><span class="line">[root@centos7 linux-4.12]#make menuconfig</span><br><span class="line"></span><br><span class="line">* 为保存到内核文件/boot/vmlinuz</span><br><span class="line"></span><br><span class="line">M 为保存到模块文件/usr/lib/modules/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">进入图形菜单栏，编辑本地kernel版本，</span><br><span class="line">General setup---&gt;</span><br><span class="line"></span><br><span class="line">local - append to kernel release</span><br><span class="line"></span><br><span class="line">save---保存</span><br><span class="line"></span><br><span class="line">File systems ---&gt;编辑文件系统</span><br><span class="line"></span><br><span class="line">DOS/FAT/NT Filesystems ---&gt;</span><br><span class="line"></span><br><span class="line">&lt;M&gt; NTFS file system support</span><br><span class="line"></span><br><span class="line">[*]   NTFS debugging support</span><br><span class="line">[*]   NTFS write support</span><br><span class="line"></span><br><span class="line">save ---&gt; 保存退出</span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#ll .config /boot/config-3.10.0-514.el7.x86_64</span><br><span class="line">-rw-r--r--. 1 root root 137696 Nov 23  2016 /boot/config-3.10.0-514.el7.x86_64</span><br><span class="line">-rw-r--r--. 1 root root 168537 Jul 12 17:40 .config</span><br><span class="line"></span><br><span class="line"># CONFIG_FAT_DEFAULT_UTF8 is not set</span><br><span class="line">CONFIG_NTFS_FS=m      设置成功</span><br><span class="line">CONFIG_NTFS_DEBUG=y</span><br><span class="line">CONFIG_NTFS_RW=y</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Pseudo filesystems</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#在/root/linux-4.2-- 目录下</span><br><span class="line">#make -j 4 编译</span><br><span class="line"></span><br><span class="line">#ll -sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#make modules_install 生成KO文件；</span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#ls /lib/modules</span><br><span class="line">3.10.0-514.el7.x86_64  4.12.0-byf-1.2</span><br><span class="line"></span><br><span class="line">[root@centos7 modules]#find 4.12.0-byf-1.2/ -name &quot;*.ko&quot;</span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#make install</span><br><span class="line">Makefile:933: &quot;Cannot use CONFIG_STACK_VALIDATION, please install libelf-dev, libelf-devel or elfutils-libelf-devel&quot;</span><br><span class="line">sh ./arch/x86/boot/install.sh 4.12.0-byf-1.2 arch/x86/boot/bzImage \</span><br><span class="line">        System.map &quot;/boot&quot;</span><br><span class="line">^Cmkinitrd failed</span><br><span class="line">make: *** [install] Interrupt</span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#yum install  elfutils-libelf-devel</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.hust.edu.cn</span><br><span class="line"> * extras: mirror.lzu.edu.cn</span><br><span class="line"> * updates: mirrors.nju.edu.cn</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package elfutils-libelf-devel.x86_64 0:0.166-2.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=========================================================================================================================</span><br><span class="line"> Package                                Arch                    Version                      Repository             Size</span><br><span class="line">=========================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> elfutils-libelf-devel                  x86_64                  0.166-2.el7                  base                   37 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=========================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 37 k</span><br><span class="line">Installed size: 31 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">elfutils-libelf-devel-0.166-2.el7.x86_64.rpm                                                      |  37 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : elfutils-libelf-devel-0.166-2.el7.x86_64                                                              1/1</span><br><span class="line">  Verifying  : elfutils-libelf-devel-0.166-2.el7.x86_64                                                              1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  elfutils-libelf-devel.x86_64 0:0.166-2.el7</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#[root@centos7 linux-4.12]#ls /boot</span><br><span class="line">config-3.10.0-514.el7.x86_64                             System.map-3.10.0-514.el7.x86_64</span><br><span class="line">grub                                                     System.map-4.12.0-byf-1.2</span><br><span class="line">grub2                                                    System.map-4.12.0-byf-1.2.old</span><br><span class="line">initramfs-0-rescue-c13ed9ba529c45d6bf915ca67e74c338.img  vmlinuz</span><br><span class="line">initramfs-3.10.0-514.el7.x86_64.img                      vmlinuz-0-rescue-c13ed9ba529c45d6bf915ca67e74c338</span><br><span class="line">initramfs-3.10.0-514.el7.x86_64kdump.img                 vmlinuz-3.10.0-514.el7.x86_64</span><br><span class="line">initrd-plymouth.img                                      vmlinuz-4.12.0-byf-1.2</span><br><span class="line">symvers-3.10.0-514.el7.x86_64.gz                         vmlinuz-4.12.0-byf-1.2.old</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#make install</span><br><span class="line">sh ./arch/x86/boot/install.sh 4.12.0-byf-1.2 arch/x86/boot/bzImage \</span><br><span class="line">        System.map &quot;/boot&quot;</span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#cat /boot/grub2/grub.cfg</span><br><span class="line">查看配置文件是否生成</span><br><span class="line">menuentry &apos;CentOS Linux (4.12.0-byf-1.2) 7 (Core)&apos; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &apos;gnulinux-3.10.0-514.el7.x86_64-advanced-f86bb45c-c257-4f7c-ae3c-fa72b50f277c&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos7 linux-4.12]#uname -r</span><br><span class="line">3.10.0-514.el7.x86_64</span><br><span class="line"></span><br><span class="line">重启选择编译的内核启动；</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]#uname -r</span><br><span class="line">4.12.0-byf-1.2</span><br><span class="line">启动成功；</span><br><span class="line"></span><br><span class="line">ntfs格式linux只支持只读；</span><br><span class="line">#mount -o rw /dev/sdc1 /mnt</span><br><span class="line">#mount 可以看出只读；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1下载kernel 源码包</span><br><span class="line">tar xf linux.XXX.xz</span><br><span class="line">/root/linux.4.12/</span><br><span class="line"></span><br><span class="line">2 生成配置模版文件</span><br><span class="line">cp /boot/config.XXX /root/linux.4.12/.config</span><br><span class="line"></span><br><span class="line">3 yum groupnstall  &quot;Development Tools&quot;</span><br><span class="line">yum install ncurses-devel</span><br><span class="line"></span><br><span class="line">4 make menuconfig</span><br><span class="line">选中NTFS</span><br><span class="line">local version</span><br><span class="line"></span><br><span class="line">5 make -j 4 &amp;&amp; for i in &#123;1..10&#125;;do echo -e &quot;\a&quot;;sleep 1;done</span><br><span class="line"></span><br><span class="line">6 make modules_install  /lib/modules/`uname -r`</span><br><span class="line"></span><br><span class="line">7 make install  /boot/vmlinuz  /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">在已经执行过编译操作的内核源码树做重新编译</span><br><span class="line">  需要事先清理操作：</span><br><span class="line">make clean ：清理大多数编译生成的文件，但会保留</span><br><span class="line">config 文件等</span><br><span class="line">make mrproper:  清理所有编译生成的文件、config 及某</span><br><span class="line">些备份文件</span><br><span class="line">make distclean ：mrproper 、patches以及编辑器备份文件</span><br><span class="line"></span><br><span class="line">  删除/lib/modules/ 目录下不需要的内核库文件</span><br><span class="line">  删除/usr/src/linux/ 目录下不需要的内核源码</span><br><span class="line">  删除/boot 目录下启动的内核和内核映像文件</span><br><span class="line">  更改grub 的配置文件，删除不需要的内核启动列表</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">编译安装</span><br><span class="line"></span><br><span class="line">cd isolinux/</span><br><span class="line">ll vmlinuz 内核文件</span><br><span class="line">跟boot目录下的一样</span><br><span class="line">出厂版本，及日期</span><br><span class="line"></span><br><span class="line">上传 linux-4.12.tar.xz文件(rz)</span><br><span class="line"></span><br><span class="line">占用10G多的空间</span><br><span class="line"></span><br><span class="line">解开包--解压缩</span><br><span class="line">tar xf linux---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#du -sh linux-4.12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ll /boot/vmlinuz  参考文件进行修改</span><br><span class="line"></span><br><span class="line">cd /boot</span><br><span class="line"></span><br><span class="line">config----   配置文件，</span><br><span class="line"></span><br><span class="line">ls /lib/modules</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">更新数据库updatedb</span><br><span class="line"></span><br><span class="line">locate ntfs.ko</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line">locate ext4.ko</span><br><span class="line"></span><br><span class="line">菜单工具</span><br><span class="line"></span><br><span class="line">安装开发工具包组</span><br><span class="line">yum groupinstall &quot;development Tools“</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make menuconfig 运行软件工具</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">install 安装缺少的包文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uname -r</span><br><span class="line">内核版本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fIle system</span><br><span class="line">文件系统</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DOS/FAT/NT  ntfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make -j  4  有四颗cpu 四线程</span><br><span class="line"></span><br><span class="line">cd /root/lnux---</span><br><span class="line">ls</span><br><span class="line">查看生成的目录</span><br><span class="line"></span><br><span class="line">（b）make manuconfig</span><br><span class="line"></span><br><span class="line">ls /lib/modules</span><br><span class="line">make  modules_install</span><br><span class="line">自动添加到配置文建中</span><br><span class="line"></span><br><span class="line">编译：</span><br><span class="line">cd /root/linux</span><br><span class="line"></span><br><span class="line">ls net/</span><br><span class="line"></span><br><span class="line">1、可以选择性编译</span><br><span class="line"></span><br><span class="line">2、指定某个特定的目录进行编译</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编译的平台 make ARHM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">updatedb 更新</span><br><span class="line"></span><br><span class="line">locate ntfs.ko</span><br><span class="line">看文件</span><br><span class="line"></span><br><span class="line">make modules_install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /root/linux-</span><br><span class="line">切换 并进行操作 make install</span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line">重启后选择新的内核启动</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">系统中的程序支持不支持内核，不支持将使用不了</span><br><span class="line"></span><br><span class="line">ntfs 不支持，只读更改不了&#123;windows&#125;</span><br><span class="line"></span><br><span class="line">locate /lib/modules</span><br><span class="line"></span><br><span class="line">选择性编译；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#############################################make clean 清除文件</span><br><span class="line">在 想～清理的目录下进行清理</span><br><span class="line"></span><br><span class="line">make mrproper 清理所有的编译生成的文件</span><br><span class="line"></span><br><span class="line">makedistclean</span><br><span class="line"></span><br><span class="line">############################################</span><br><span class="line">卸载内核</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">############################################</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> Centos7编译安装 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[awk]]></title>
      <url>/2018/01/09/awk/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br></pre></td><td class="code"><pre><span class="line">awk</span><br><span class="line">awk:报告生成器，格式化文本输出</span><br><span class="line">     种类 ；nawk  gawk</span><br><span class="line">     gawk;模式扫描和处理语言</span><br><span class="line"></span><br><span class="line">awk基本用法</span><br><span class="line">awk变量</span><br><span class="line">awk格式化</span><br><span class="line">awk操作符</span><br><span class="line">awk条件判断</span><br><span class="line">awk循环</span><br><span class="line">awk数组</span><br><span class="line">awk函数</span><br><span class="line">调用系统命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">基本用法</span><br><span class="line">    awk [option] &apos;program&apos; var=valur file...</span><br><span class="line">          选项     awk语言 变量赋值</span><br><span class="line">    awk [option] -f programfile var=value file...</span><br><span class="line">                    调用脚本</span><br><span class="line">    awk [option] &apos;BEGIN&#123; action;...&#125;pattern&#123; action,...&#125; END&#123;action;...&#125;&apos; file...</span><br><span class="line"></span><br><span class="line">    awk程序通常由：BEGIN语句块、能够使用模式匹配的通用语句块、END语句块，3个部分</span><br><span class="line"></span><br><span class="line">组成；</span><br><span class="line"></span><br><span class="line">    program通常是被单引号或双引号中</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">    -F指明输入时用到的字段分隔符，默认情况下为空白符（一个空白符）</span><br><span class="line">    -v var=value: 自定义变量</span><br><span class="line"></span><br><span class="line">awk语言</span><br><span class="line"></span><br><span class="line">基本格式：awk [option] &apos;program&apos; file...</span><br><span class="line">program 有两大块组成；pattern模式(如正则)、action行为动作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pattern&#123;action statements;..&#125;</span><br><span class="line">pattern部分决定动作语句何时触发及触发事件</span><br><span class="line">BEGIN刚开时还没有执行要执行的命令时，先执行BEGIN语句，打印输出（如打印报表），</span><br><span class="line">END 最后使用，如（统计学员成绩总和，最后汇总值）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">action statements 对数据进行处理，放在&#123;&#125;内指明</span><br><span class="line">print打印输出 ,printf打印输出并支持格式化，（如左对齐...）</span><br><span class="line"></span><br><span class="line">分隔符</span><br><span class="line"></span><br><span class="line">        行切为列</span><br><span class="line"></span><br><span class="line">        row    行  ---   record 记录</span><br><span class="line">        column 列，字段---   field 域 属性</span><br><span class="line"></span><br><span class="line">       一行为一条记录，一般换行符行分割，特定        时</span><br><span class="line">        也可以用符号分割，</span><br><span class="line"></span><br><span class="line">       -F：  $0所有域 $1字段  $2   $3</span><br><span class="line">            （系统自带变量）</span><br><span class="line"></span><br><span class="line">        record 记录</span><br><span class="line"></span><br><span class="line">第一步：执行BEGIN&#123;action;… &#125; 语句块中的语句</span><br><span class="line">  第二步：从文件或标准输入(stdin) 读取一行，然后执行pattern&#123;</span><br><span class="line">action;… &#125; 语句块，它逐行扫描文件，从第一行到最后一行重复这</span><br><span class="line">个过程，直到文件全部被读取完毕。</span><br><span class="line">  第三步：当读至输入流末尾时，执行END&#123;action;…&#125; 语句块</span><br><span class="line"> BEGIN 语句块在awk 开始从输入流中读取行之前被执行，这是一个</span><br><span class="line">可选的语句块，比如变量初始化、打印输出表格的表头等语句通常</span><br><span class="line">可以写在BEGIN 语句块中</span><br><span class="line"> END 语句块在awk 从输入流中读取完所有的行之后即被执行，比如</span><br><span class="line">打印所有行的分析结果这类信息汇总都是在END 语句块中完成，它</span><br><span class="line">也是一个可选语句块</span><br><span class="line"> pattern 语句块中的通用命令是最重要的部分，也是可选的。如果</span><br><span class="line">没有提供pattern 语句块，则默认执行&#123; print &#125; ，即打印每一个读取</span><br><span class="line">到的行，awk读取的每一行都会执行该语句块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print 格式：print item1, item2, ...</span><br><span class="line">  要点：</span><br><span class="line">• (1)  逗号分隔符</span><br><span class="line">• (2)  输出的各item 可以字符串，也可以是数值；当前记录的字段、</span><br><span class="line">变量或awk 的表达式</span><br><span class="line">• (3)  如省略item ，相当于print $0</span><br><span class="line">  示例：</span><br><span class="line">awk &apos;&#123;print &quot;hello,awk&quot;&#125;&apos; （awk读取标准输入）不显示只有随意打出内容</span><br><span class="line">awk –F: &apos;&#123;print&#125;&apos; /etc/passwd</span><br><span class="line">awk –F: ‘&#123;print “wang”&#125;’ /etc/passwd</span><br><span class="line">awk –F: ‘&#123;print $1&#125;’ /etc/passwd</span><br><span class="line">awk –F: ‘&#123;print $0&#125;’ /etc/passwd</span><br><span class="line">awk –F: ‘&#123;print $1”\t”$3&#125;’ /etc/passwd</span><br><span class="line">tail –3 /etc/fstab |awk ‘&#123;print $2,$4&#125;’</span><br><span class="line"></span><br><span class="line">变量</span><br><span class="line"></span><br><span class="line">变量：内 置 和自定义变量</span><br><span class="line"> FS ：输入字段分隔符，默认为空白字符</span><br><span class="line">awk -v FS=&apos;:&apos; &apos;&#123;print $1,FS,$3&#125;’ /etc/passwd</span><br><span class="line">awk –F: &apos;&#123;print $1,$3,$7&#125;’ /etc/passwd</span><br><span class="line"> OFS ：输出字段分隔符，默认为空白字符</span><br><span class="line">awk -v FS=‘:’ -v OFS=‘:’ &apos;&#123;print $1,$3,$7&#125;’ /etc/passwd</span><br><span class="line"> RS ：输入记录分隔符，指定输入时的换行符，原换行符仍有效</span><br><span class="line">awk -v RS=&apos; &apos; ‘&#123;print &#125;’ /etc/passwd</span><br><span class="line"> ORS ：输出记录分隔符，输出时用指定符号代替换行符</span><br><span class="line">awk -v RS=&apos; &apos; -v ORS=&apos;###&apos;‘&#123;print &#125;’ /etc/passwd</span><br><span class="line"> NF ：字段数量</span><br><span class="line">awk -F： ： ‘&#123;print NF&#125;’ /etc/fstab, 引用内置变量不用$</span><br><span class="line">awk -F: &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd</span><br><span class="line"> NR ：行号</span><br><span class="line">awk &apos;&#123;print NR&#125;&apos; /etc/fstab ; awk END&apos;&#123;print NR&#125;&apos; /etc/fstab ; awk END&apos;&#123;print</span><br><span class="line"></span><br><span class="line">NR&#125;&apos; /etc/fstab</span><br><span class="line"></span><br><span class="line"> FNR ：各文件分别计数, 行号</span><br><span class="line">awk &apos;&#123;print FNR&#125;&apos; /etc/fstab /etc/inittab</span><br><span class="line"> FILENAME ：当前文件名</span><br><span class="line">awk &apos;&#123;print FILENAME&#125;’ /etc/fstab</span><br><span class="line"> ARGC ：命令行参数的个数</span><br><span class="line">awk &apos;&#123;print ARGC&#125;’ /etc/fstab /etc/inittab</span><br><span class="line">awk ‘BEGIN &#123;print ARGC&#125;’ /etc/fstab /etc/inittab</span><br><span class="line"> ARGV ：数组，保存的是命令行所给定的各参数</span><br><span class="line">awk ‘BEGIN &#123;print ARGV[0]&#125;’ /etc/fstab</span><br><span class="line">/etc/inittab</span><br><span class="line">awk ‘BEGIN &#123;print ARGV[1]&#125;’ /etc/fstab</span><br><span class="line">/etc/inittab</span><br><span class="line"></span><br><span class="line">自定义变量</span><br><span class="line">自定义 变量( 区分 字符大小写)</span><br><span class="line">(1) -v var=value</span><br><span class="line">(2)  在program 中直接定义</span><br><span class="line">  示例：</span><br><span class="line">awk -v test=&apos;hello gawk&apos; &apos;&#123;print test&#125;&apos; /etc/fstab</span><br><span class="line">awk -v test=&apos;hello gawk&apos; &apos;BEGIN&#123;print test&#125;&apos;</span><br><span class="line">awk &apos;BEGIN&#123;test=&quot;hello,gawk&quot;;print test&#125;&apos;</span><br><span class="line">awk –F:‘&#123;sex=“male”;print $1,sex,age;age=18&#125;’</span><br><span class="line">/etc/passwd</span><br><span class="line">cat awkscript</span><br><span class="line">&#123;print script,$1,$2&#125;</span><br><span class="line">awk -F: -f awkscript script=“awk” /etc/passwd</span><br><span class="line"></span><br><span class="line">############################################# ###基本使用方法###</span><br><span class="line"></span><br><span class="line"> 查看awk类型；</span><br><span class="line">[root@centos6 ~]#which awk</span><br><span class="line">/bin/awk</span><br><span class="line">[root@centos6 ~]#ll /bin/awk</span><br><span class="line">lrwxrwxrwx. 1 root root 4 May 17 07:59 /bin/awk -&gt; gawk</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print &quot;hello,awk&quot;&#125;&apos;</span><br><span class="line">asd</span><br><span class="line">hello,awk</span><br><span class="line">111</span><br><span class="line">hello,awk</span><br><span class="line">^C----action选项动作执行判断语句，将随意输入内容时才执行print &quot;hello,awk&quot;</span><br><span class="line">[root@centos6 ~]#awk &apos;BEGIN&#123;print &quot;hello,awk&quot;&#125;&apos;</span><br><span class="line">hello,awk</span><br><span class="line"> BEGIN 读取文件内容之前执行，BEGIN语句执行后满足action条件，所以输出print</span><br><span class="line"></span><br><span class="line">&quot;hello,awk&quot;</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">uucp</span><br><span class="line">打印第一列；$0--表示所有列，$1....$n对应列数；</span><br><span class="line">[root@centos6 ~]#awk -F: &apos;&#123;print $1&quot;---&quot;$2&#125;&apos; /etc/passwd</span><br><span class="line">---</span><br><span class="line">root---x</span><br><span class="line">bin---x</span><br><span class="line">daemon---x</span><br><span class="line">adm---x</span><br><span class="line">lp---x</span><br><span class="line">sync---x</span><br><span class="line">shutdown---x</span><br><span class="line">halt---x</span><br><span class="line">mail---x</span><br><span class="line">uucp---x</span><br><span class="line">除特殊符号外，普通字符需加双引号；</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#df |grep &quot;^/dev/sd&quot;|awk &apos;&#123;print $5&#125;&apos;|awk -F% &apos;&#123;print $1&#125;&apos;</span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">bai:x:500:500::/home/bai:/bin/bash</span><br><span class="line">user11:x:501:517::/home/user11:/bin/bash</span><br><span class="line">user12:x:502:517::/home/user12:/bin/bash</span><br><span class="line">user13:x:503:517::/home/user13:/bin/bash</span><br><span class="line">user14:x:504:517::/home/user14:/bin/bash</span><br><span class="line">user15:x:505:517::/home/user15:/bin/bash</span><br><span class="line">user16:x:506:517::/home/user16:/bin/bash</span><br><span class="line">user17:x:507:517::/home/user17:/bin/bash</span><br><span class="line">user18:x:508:517::/home/user18:/bin/bash</span><br><span class="line">user19:x:509:517::/home/user19:/bin/bash</span><br><span class="line">user20:x:510:517::/home/user20:/bin/bash</span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print&#125;&apos; /etc/passwd</span><br><span class="line">相当于  awk &apos;&#123;print $0&#125;&apos; /etc/passwd</span><br><span class="line">打印所有列</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk -F: &apos;&#123;print $1 &quot;\t&quot; $3&#125;&apos; /etc/passwd</span><br><span class="line">root    0</span><br><span class="line">bin     1</span><br><span class="line">daemon  2</span><br><span class="line">adm     3</span><br><span class="line">lp      4</span><br><span class="line">sync    5</span><br><span class="line">shutdown        6</span><br><span class="line">halt    7</span><br><span class="line">mail    8</span><br><span class="line">uucp    10</span><br><span class="line">operator        11</span><br><span class="line"></span><br><span class="line">&quot;\t&quot; 不是变量所以需要加双引号，用tab键补齐；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#grep &quot;^UUID=&quot; /etc/fstab |awk -F&quot; &quot; &apos;&#123;print $2&#125;&apos;</span><br><span class="line">/</span><br><span class="line">/app</span><br><span class="line">/boot</span><br><span class="line">swap</span><br><span class="line">[root@centos6 ~]#grep &quot;^UUID=&quot; /etc/fstab |awk &apos;&#123;print $2&#125;&apos;</span><br><span class="line">/</span><br><span class="line">/app</span><br><span class="line">/boot</span><br><span class="line">swap</span><br><span class="line"></span><br><span class="line">将-F“ ”去除后默认为空白符为分割符，进行取列；</span><br><span class="line"></span><br><span class="line">内置变量的使用举例；</span><br><span class="line"> pulse 497</span><br><span class="line">sshd 74</span><br><span class="line">tcpdump 72</span><br><span class="line">bai 500</span><br><span class="line">user11 501</span><br><span class="line">user12 502</span><br><span class="line">user13 503</span><br><span class="line">user14 504</span><br><span class="line">user15 505</span><br><span class="line">user16 506</span><br><span class="line">user17 507</span><br><span class="line">user18 508</span><br><span class="line">user19 509</span><br><span class="line">user20 510</span><br><span class="line">[root@centos6 ~]#awk -v FS=: &apos;&#123;print $1,$3&#125;&apos; /etc/passwd</span><br><span class="line">内置变量赋值后没有使用；去除-F“ ”默认空白符分割</span><br><span class="line"></span><br><span class="line">sshd 74</span><br><span class="line">tcpdump 72</span><br><span class="line">bai 500</span><br><span class="line">user11 501</span><br><span class="line">user12 502</span><br><span class="line">user13 503</span><br><span class="line">user14 504</span><br><span class="line">user15 505</span><br><span class="line">user16 506</span><br><span class="line">user17 507</span><br><span class="line">user18 508</span><br><span class="line">user19 509</span><br><span class="line">user20 510</span><br><span class="line">[root@centos6 ~]#awk -F&quot; &quot; -v FS=: &apos;&#123;print $1,$3&#125;&apos; /etc/passwd</span><br><span class="line">跟上述结果一样；</span><br><span class="line"></span><br><span class="line">sshd:74</span><br><span class="line">tcpdump:72</span><br><span class="line">bai:500</span><br><span class="line">user11:501</span><br><span class="line">user12:502</span><br><span class="line">user13:503</span><br><span class="line">user14:504</span><br><span class="line">user15:505</span><br><span class="line">user16:506</span><br><span class="line">user17:507</span><br><span class="line">user18:508</span><br><span class="line">user19:509</span><br><span class="line">user20:510</span><br><span class="line">[root@centos6 ~]#awk -F&quot; &quot; -v FS=: &apos;&#123;print $1FS$3&#125;&apos; /etc/passwd</span><br><span class="line">变量使用</span><br><span class="line"></span><br><span class="line">pulse:497</span><br><span class="line">sshd:74</span><br><span class="line">tcpdump:72</span><br><span class="line">bai:500</span><br><span class="line">user11:501</span><br><span class="line">user12:502</span><br><span class="line">user13:503</span><br><span class="line">user14:504</span><br><span class="line">user15:505</span><br><span class="line">user16:506</span><br><span class="line">user17:507</span><br><span class="line">user18:508</span><br><span class="line">user19:509</span><br><span class="line">user20:510</span><br><span class="line">[root@centos6 ~]#awk -v FS=: &apos;&#123;print $1FS$3&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">sshd:74</span><br><span class="line">tcpdump:72</span><br><span class="line">bai:500</span><br><span class="line">user11:501</span><br><span class="line">user12:502</span><br><span class="line">user13:503</span><br><span class="line">user14:504</span><br><span class="line">user15:505</span><br><span class="line">user16:506</span><br><span class="line">user17:507</span><br><span class="line">user18:508</span><br><span class="line">user19:509</span><br><span class="line">user20:510</span><br><span class="line">[root@centos6 ~]#S=:;awk -v FS=$S &apos;&#123;print $1FS$3&#125;&apos; /etc/passwd</span><br><span class="line">调用bash变量到awk里使用；</span><br><span class="line"></span><br><span class="line">sshd---74</span><br><span class="line">tcpdump---72</span><br><span class="line">bai---500</span><br><span class="line">user11---501</span><br><span class="line">user12---502</span><br><span class="line">user13---503</span><br><span class="line">user14---504</span><br><span class="line">user15---505</span><br><span class="line">user16---506</span><br><span class="line">user17---507</span><br><span class="line">user18---508</span><br><span class="line">user19---509</span><br><span class="line">user20---510</span><br><span class="line">[root@centos6 ~]#awk -F: -v OFS=&apos;---&apos; &apos;&#123;print $1,$3&#125;&apos; /etc/passwd</span><br><span class="line">OFS指定输出分隔符；</span><br><span class="line"></span><br><span class="line">[root@centos6 app]#cat a</span><br><span class="line">a: aa: aa</span><br><span class="line">bb: cads: asdfa</span><br><span class="line">adsfa:afd</span><br><span class="line">[root@centos6 app]#cat -A a</span><br><span class="line">a: aa: aa$</span><br><span class="line">bb: cads: asdfa$</span><br><span class="line">adsfa:afd$</span><br><span class="line">[root@centos6 app]#awk -v RS=: &apos;&#123;print $1&#125;&apos; a</span><br><span class="line">a</span><br><span class="line">aa</span><br><span class="line">aa</span><br><span class="line">cads</span><br><span class="line">asdfa</span><br><span class="line">afd</span><br><span class="line">[root@centos6 app]#awk -v RS=: &apos;&#123;print $2&#125;&apos; a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bb</span><br><span class="line"></span><br><span class="line">adsfa</span><br><span class="line">建一个文本输入内容，用冒号隔开，RS是以（:）分割成为一条条记录，&#123;print $1 $2&#125;是从</span><br><span class="line"></span><br><span class="line">一条记录中用空白符分割出来打印输出。</span><br><span class="line"></span><br><span class="line">[root@centos6 app]#awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">root</span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">sync</span><br><span class="line">shutdown</span><br><span class="line">halt</span><br><span class="line">mail</span><br><span class="line">uucp</span><br><span class="line">operator</span><br><span class="line">games</span><br><span class="line">[root@centos6 app]#awk -F: -v ORS=&apos;:&apos; &apos;&#123;print $1&#125;&apos; /etc/passwd</span><br><span class="line">:root:bin:daemon:adm:lp:sync:shutdown:halt:mail:uucp:operator:games:gopher:ftp:no</span><br><span class="line"></span><br><span class="line">body:dbus:usbmuxd:rpc:rtkit:avahi-</span><br><span class="line"></span><br><span class="line">autoipd:vcsa:abrt:rpcuser:nfsnobody:haldaemon:ntp:apache:saslauth:postfix:mysql:g</span><br><span class="line"></span><br><span class="line">dm:pulse:sshd:tcpdump:bai:user11:user12:user13:user14:user15:user16:user17:user18</span><br><span class="line"></span><br><span class="line">:user19:user20:[root@centos6 app]#</span><br><span class="line">ORS=&apos;:&apos; 输出时使用‘：’为分隔符输出。</span><br><span class="line"></span><br><span class="line">[root@centos6 app]#awk -F: &apos;BEGIN&#123;print NF&#125;&apos; /etc/passwd</span><br><span class="line">0</span><br><span class="line">[root@centos6 app]#awk -F: &apos;END&#123;print NF&#125;&apos; /etc/passwd</span><br><span class="line">7</span><br><span class="line">打印列数；BEGIN执行是在执行文件之前执行所以列数为0</span><br><span class="line">          END执行是在文件执行结束后执行所以输出列数为7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">7</span><br><span class="line">[root@centos6 app]#awk -F: &apos;&#123;print NF&#125;&apos; /etc/passwd</span><br><span class="line"></span><br><span class="line">[root@centos6 app]#awk -F: &apos;END&#123;print NF-1&#125;&apos; /etc/passwd</span><br><span class="line">6</span><br><span class="line">[root@centos7 ~]#awk -F: &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd</span><br><span class="line">/root</span><br><span class="line">/bin</span><br><span class="line">/sbin</span><br><span class="line">/var/adm</span><br><span class="line">/var/spool/lpd</span><br><span class="line">/sbin</span><br><span class="line">/sbin</span><br><span class="line">/sbin</span><br><span class="line">/var/spool/mail</span><br><span class="line">/root</span><br><span class="line">/usr/games</span><br><span class="line">/var/ftp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print NR,$0&#125;&apos; /etc/issue /etc/fstab</span><br><span class="line">1 CentOS release 6.9 (Final)</span><br><span class="line">2 Kernel \r on an \m</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5 #</span><br><span class="line">6 # /etc/fstab</span><br><span class="line">7 # Created by anaconda on Wed May 17 07:58:47 2017</span><br><span class="line">8 #</span><br><span class="line">9 # Accessible filesystems, by reference, are maintained under &apos;/dev/disk&apos;</span><br><span class="line">10 # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="line">11 #</span><br><span class="line">12 UUID=debde2b5-2a12-4413-9a87-e16f92414999 /                       ext4    defaults        1 1</span><br><span class="line">13 UUID=d66829e7-bc4a-4a65-b8c6-b00d01be3ad1 /app                    ext4    defaults        1 2</span><br><span class="line">14 UUID=7e0e42d1-8fbe-4b4b-b37d-ae645d50b654 /boot                   ext4    defaults        1 2</span><br><span class="line">15 UUID=80d05338-43e4-4f3a-bf05-64e42445077e swap                    swap    defaults        0 0</span><br><span class="line">16 tmpfs                   /dev/shm                tmpfs   defaults        0 0</span><br><span class="line">17 devpts                  /dev/pts                devpts  gid=5,mode=620  0 0</span><br><span class="line">18 sysfs                   /sys                    sysfs   defaults        0 0</span><br><span class="line">19 proc                    /proc                   proc    defaults        0 0</span><br><span class="line"></span><br><span class="line">将两个文件合并成一个进行排序记数；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print FNR,$0&#125;&apos; /etc/issue /etc/fstab</span><br><span class="line">1 CentOS release 6.9 (Final)</span><br><span class="line">2 Kernel \r on an \m</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">2 #</span><br><span class="line">3 # /etc/fstab</span><br><span class="line">4 # Created by anaconda on Wed May 17 07:58:47 2017</span><br><span class="line">5 #</span><br><span class="line">6 # Accessible filesystems, by reference, are maintained under &apos;/dev/disk&apos;</span><br><span class="line">7 # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span><br><span class="line">8 #</span><br><span class="line">9 UUID=debde2b5-2a12-4413-9a87-e16f92414999 /                       ext4    defaults        1 1</span><br><span class="line">10 UUID=d66829e7-bc4a-4a65-b8c6-b00d01be3ad1 /app                    ext4    defaults        1 2</span><br><span class="line">11 UUID=7e0e42d1-8fbe-4b4b-b37d-ae645d50b654 /boot                   ext4    defaults        1 2</span><br><span class="line">12 UUID=80d05338-43e4-4f3a-bf05-64e42445077e swap                    swap    defaults        0 0</span><br><span class="line">13 tmpfs                   /dev/shm                tmpfs   defaults        0 0</span><br><span class="line">14 devpts                  /dev/pts                devpts  gid=5,mode=620  0 0</span><br><span class="line">15 sysfs                   /sys                    sysfs   defaults        0 0</span><br><span class="line">16 proc                    /proc                   proc    defaults        0 0</span><br><span class="line">分别计数</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print FNR,$0,FILENAME&#125;&apos; /etc/issue /etc/fstab</span><br><span class="line">1 CentOS release 6.9 (Final) /etc/issue</span><br><span class="line">2 Kernel \r on an \m /etc/issue</span><br><span class="line">3  /etc/issue</span><br><span class="line">1  /etc/fstab</span><br><span class="line">2 # /etc/fstab</span><br><span class="line">3 # /etc/fstab /etc/fstab</span><br><span class="line">4 # Created by anaconda on Wed May 17 07:58:47 2017 /etc/fstab</span><br><span class="line">5 # /etc/fstab</span><br><span class="line">6 # Accessible filesystems, by reference, are maintained under &apos;/dev/disk&apos; /etc/fstab</span><br><span class="line">7 # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info /etc/fstab</span><br><span class="line">8 # /etc/fstab</span><br><span class="line">9 UUID=debde2b5-2a12-4413-9a87-e16f92414999 /                       ext4    defaults        1 1 /etc/fstab</span><br><span class="line">10 UUID=d66829e7-bc4a-4a65-b8c6-b00d01be3ad1 /app                    ext4    defaults        1 2 /etc/fstab</span><br><span class="line">11 UUID=7e0e42d1-8fbe-4b4b-b37d-ae645d50b654 /boot                   ext4    defaults        1 2 /etc/fstab</span><br><span class="line">12 UUID=80d05338-43e4-4f3a-bf05-64e42445077e swap                    swap    defaults        0 0 /etc/fstab</span><br><span class="line">13 tmpfs                   /dev/shm                tmpfs   defaults        0 0 /etc/fstab</span><br><span class="line">14 devpts                  /dev/pts                devpts  gid=5,mode=620  0 0 /etc/fstab</span><br><span class="line">15 sysfs                   /sys                    sysfs   defaults        0 0 /etc/fstab</span><br><span class="line">16 proc                    /proc                   proc    defaults        0 0 /etc/fstab</span><br><span class="line"></span><br><span class="line">打印文件名 FILENAME</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print ARGC&#125;&apos; /etc/issue /etc/fstab           3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">查看参数个数</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print ARGV[1]&#125;&apos; /etc/issue /etc/fstab</span><br><span class="line">/etc/issue</span><br><span class="line">/etc/issue</span><br><span class="line">/etc/issue</span><br><span class="line">/etc/issue</span><br><span class="line">查看参数1是那一个</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;print ARGC,ARGV[ARGC-4]&#125;&apos; /etc/issue /etc/fstab  /etc/passwd</span><br><span class="line">4 awk</span><br><span class="line">4 awk</span><br><span class="line">4 awk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk -F: &apos;&#123;print $(NF-1)&#125;&apos; /etc/passwd</span><br><span class="line">awk: (FILENAME=/etc/passwd FNR=1) fatal: attempt to access field -1</span><br><span class="line"></span><br><span class="line">因为/etc/passwd 第一行为空行时 echo |awk -F: ‘&#123;print NF&#125;‘输出值为零 ，$(NF-1)为$（-1）不支持，所以报错；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">自定义变量</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#awk -v name=root &apos;&#123;print name&#125;&apos; /etc/passwd</span><br><span class="line">root</span><br><span class="line">root</span><br><span class="line">没有实际意义，只是打印</span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;sex=&quot;male&quot;;print sex&#125;&apos; /etc/passwd</span><br><span class="line">male</span><br><span class="line">male</span><br><span class="line">自定义变量使用方法</span><br><span class="line">[root@centos6 ~]#awk &apos;&#123;sex=&quot;male&quot;;print sex,age;age=20&#125;&apos; /etc/passwd</span><br><span class="line">male</span><br><span class="line">male 20</span><br><span class="line">male 20</span><br><span class="line">male 20</span><br><span class="line">male 20</span><br><span class="line">&#123;&#125;里定义变量，不用加$，顺序执行。</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]# awk -f f1.awk /etc/passwd</span><br><span class="line"></span><br><span class="line">&#123;sex=&quot;male&quot;;print sex,age;age=20&#125;放到f1.awk里，进行调用。</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> awk </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[循环语句]]></title>
      <url>/2018/01/09/%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5/</url>
      <content type="html"><![CDATA[<p>######循环控制语句—continue、break；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">continue:</span><br><span class="line">循环控制语句continue 依据条件跳过继续执行循环， ---continue 2---表示跳转到当前循环往外第二层循环；</span><br><span class="line">用于循环体中continue【N】;提前结束N层的本轮循环，而直接进入下一轮判断；最内层为第一层</span><br><span class="line">break:</span><br><span class="line">循环控制语句break 终端，退出</span><br><span class="line">用于循环体中</span><br><span class="line">---break【N】;提前结束第N层循环，最内层为第一层</span><br><span class="line">可以退出死循环；</span><br><span class="line">#while true;do [ $i -eq 5 ] &amp;&amp; break ;echo i=$i;sleep 0.3;let i++; done</span><br></pre></td></tr></table></figure></p>
<p>######if语句；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">1、单分支</span><br><span class="line">  if 判断条件；then</span><br><span class="line">        条件为真的分支代码</span><br><span class="line">  fi</span><br><span class="line"># if cmd1； then cmd2;fi;cmd3</span><br><span class="line">####################################################</span><br><span class="line">cmd1执行成功，执行cmd2,接着执行cmd3</span><br><span class="line"></span><br><span class="line">cmd1执行不成功，则不执行cmd2,跳过cmd2直接执行cmd3</span><br><span class="line"></span><br><span class="line">####################################################</span><br><span class="line"></span><br><span class="line">2、双分支</span><br><span class="line"></span><br><span class="line">  if 判断条件：then</span><br><span class="line">        条件为真的分支代码</span><br><span class="line">  else</span><br><span class="line">        条件为假的分支代码</span><br><span class="line">  fi</span><br><span class="line">3、多分支</span><br><span class="line">  if   判断条件1；then</span><br><span class="line">       条件为真的分之代码</span><br><span class="line">  elif 判断条件2；then</span><br><span class="line">       条件为真的分支代码</span><br><span class="line">  elif 判断条件3：then</span><br><span class="line">       条件为真的分支代码</span><br><span class="line">  else</span><br><span class="line">       以上条件都为假的分支代码</span><br><span class="line">  fi</span><br><span class="line">####################################################</span><br><span class="line">#if cmd1：then cmd2;elif cmd3;then cmd4;elif cmd5;then cmd6;else cmdn;fi</span><br><span class="line"> 命令1执行成功接着执行命令2、如果命令1 执行不成功，将从新再次判断命令3是否成功、、、else指前面的全都不成功将执行命令N</span><br><span class="line">####################################################</span><br><span class="line"></span><br><span class="line">read -p &quot;please input your age: &quot; age</span><br><span class="line">[[ ! &quot;$age&quot; =~ ^[[:digit:]]+$ ]] &amp;&amp; echo please input digital &amp;&amp; exit 10</span><br><span class="line">#如果非数字，提示请输入数字，并且退出；</span><br><span class="line"></span><br><span class="line">if [ &quot;$age&quot; -le 18 ]; then</span><br><span class="line">     echo &quot;you are baby&quot;</span><br><span class="line">#判断是否小于18，小于等于18则输出you are beby ,大于18则跳至下一行；</span><br><span class="line">elif [ &quot;$age&quot; -gt 18 -a &quot;$age&quot; -le 60 ];then</span><br><span class="line">     echo &quot;you need work hard&quot;</span><br><span class="line">#判断年龄，判断大于18并小于等于60，则输出you need work hard.不在此范围则跳至下一行；</span><br><span class="line">elif [ &quot;$age&quot; -le 80 ];then</span><br><span class="line">     echo &quot;you can enjoy the life&quot;</span><br><span class="line">#判断是否小于等于80，则输出you can enjoy the life,大于80则跳至下一行；</span><br><span class="line">else</span><br><span class="line">     echo &quot;you will be lucky&quot;</span><br><span class="line">#以上判断全部错误则输出you will be lucky;则表示大于80；</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">-ge 是否大于等于</span><br><span class="line"></span><br><span class="line">-le 是否小于等于</span><br><span class="line"></span><br><span class="line">-eq 是否等于</span><br><span class="line"></span><br><span class="line">-ne 是否不等于</span><br><span class="line"></span><br><span class="line">-gt 是否大于</span><br><span class="line"></span><br><span class="line">-lt 是否小于</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.          匹配任意单个字符</span><br><span class="line">[]         匹配指定范围内的任意单个字符</span><br><span class="line">[^]        匹配指定范围外的任意单个字符</span><br><span class="line">[:alnum:]  字母和 数字</span><br><span class="line">[:alpha:]  代表任何英文大小写字符，亦即 A-Z, a-z</span><br><span class="line">[:lower:]  小写字母 [:upper:]  大写字母</span><br><span class="line">[:blank:]  空白字符（空格和制表符）</span><br><span class="line">[:space:]  水平和垂直的空白字符（比[:blank:] 包含的范围广）</span><br><span class="line">[:cntrl:]  不可打印的控制字符（退格、删除、警铃...） ）</span><br><span class="line">[:digit:]  字 十进制数字 [:xdigit:] 十六进制数字</span><br><span class="line">[:graph:]  可打印的非空白字符</span><br><span class="line">[:print:]  可打印字符</span><br><span class="line">[:punct:]   标点符号</span><br><span class="line"></span><br><span class="line">查看使用率</span><br><span class="line">[root@centos6 ~]# df| sed -rn &quot;/^\/dev\/sd/p&quot;</span><br><span class="line">/dev/sda2      100660656 4621768  90918888   5% /</span><br><span class="line">/dev/sda3       50264772   53076  47651696   1% /app</span><br><span class="line">/dev/sda1         991512   40312    900000   5% /boot</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]# df| sed -rn &quot;/^\/dev\/sd/s/^.*[[:space:]]+(.*)%.*$/\1/p&quot;</span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">5</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]# df</span><br><span class="line">Filesystem     1K-blocks    Used Available Use% Mounted on</span><br><span class="line">/dev/sda2      100660656 4621768  90918888   5% /</span><br><span class="line">tmpfs             953636     228    953408   1% /dev/shm</span><br><span class="line">/dev/sda3       50264772   53076  47651696   1% /app</span><br><span class="line">/dev/sda1         991512   40312    900000   5% /boot</span><br><span class="line">/dev/sr0         3878870 3878870         0 100% /media/CentOS_6.9_Final</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]# df |sed -rn &apos;/^\/dev\/sd/s/^.*[[:space:]]+([[:digit:]]&#123;1,3&#125;)%.*$/\1/p&apos;</span><br><span class="line">5</span><br><span class="line">1</span><br><span class="line">5</span><br></pre></td></tr></table></figure></p>
<p>###case 语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">case支持glob风格的通配符：</span><br><span class="line">*：任意长度任意字符</span><br><span class="line">？：任意单个字符</span><br><span class="line">[]:指定范围内的任意单个字符</span><br><span class="line">a|b：a或b</span><br><span class="line"></span><br><span class="line">case 变量引用 in</span><br><span class="line">PAT1)</span><br><span class="line">     分支1</span><br><span class="line">      ；；</span><br><span class="line">PAT2）</span><br><span class="line">     分支2</span><br><span class="line">      ；；</span><br><span class="line">...</span><br><span class="line">*)</span><br><span class="line">     默认分支</span><br><span class="line">      ；；</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#vim case.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;please input a digit &quot; n</span><br><span class="line">case $n in</span><br><span class="line">1|3|5)         ------是1、3、5其中一个就输出cmd1</span><br><span class="line">     echo cmd1</span><br><span class="line">     ;;</span><br><span class="line">2|4|6)</span><br><span class="line">     echo cmd2</span><br><span class="line">     ;;</span><br><span class="line">10|20|30)</span><br><span class="line">     echo cmd3</span><br><span class="line">     ;;</span><br><span class="line">*)            --------不符合上面条件时输出defoult cmd</span><br><span class="line">     echo defoult cmd</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#. case.sh</span><br><span class="line">please input a digit 2</span><br><span class="line">cmd2</span><br><span class="line">[root@centos6 ~]#. case.sh</span><br><span class="line">please input a digit 3</span><br><span class="line">cmd1</span><br><span class="line">[root@centos6 ~]#. case.sh</span><br><span class="line">please input a digit 4</span><br><span class="line">cmd2</span><br><span class="line">[root@centos6 ~]#. case.sh</span><br><span class="line">please input a digit 7</span><br><span class="line">defoult cmd</span><br><span class="line">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;Do you yue? &quot; n</span><br><span class="line">case $n in</span><br><span class="line">1|3|5)</span><br><span class="line">     echo cmd1</span><br><span class="line">     ;;</span><br><span class="line">2|4|6)</span><br><span class="line">     echo cmd2</span><br><span class="line">     ;;</span><br><span class="line">[1-3]0)</span><br><span class="line">     echo cmd3</span><br><span class="line">     ;;</span><br><span class="line">*)</span><br><span class="line">     echo defoult cmd</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#vim yue.sh</span><br><span class="line">read -p &quot;yue bu yue? (yes or no) &quot; ans</span><br><span class="line">ans=`echo $ans |tr &apos;[:upper:]&apos; &apos;[:lower:]&apos;`----大小写转换赋值</span><br><span class="line"></span><br><span class="line">case $ans in</span><br><span class="line">y|ye|yes)</span><br><span class="line">     echo ok,yue</span><br><span class="line">     ;;</span><br><span class="line">n|no)</span><br><span class="line">     echo no,buyue</span><br><span class="line">     ;;</span><br><span class="line">esac</span><br><span class="line">##########################################################</span><br></pre></td></tr></table></figure></p>
<p>######for循环<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line">循环语句</span><br><span class="line">for、 while、until</span><br><span class="line">for 语句；</span><br><span class="line">for 变量名 in 列表；do       变量名不加$</span><br><span class="line">          循环体</span><br><span class="line">；done</span><br><span class="line"></span><br><span class="line">执行机制：</span><br><span class="line">    依次将列表中的元素赋值给“变量名”；每次赋值后即执行一次循环体；直到列表中元素耗尽，循环结束；</span><br><span class="line"></span><br><span class="line">for循环</span><br><span class="line">列表生成方式：</span><br><span class="line">  （1）直接给出列表</span><br><span class="line">  （2）整数列表</span><br><span class="line">       （a）&#123;start..end&#125;</span><br><span class="line">        (b) $(seq [start[step]] end)</span><br><span class="line">   (3) 返回列表命令</span><br><span class="line">         $(COMMAND)</span><br><span class="line">   (4) 使用glob，如：*.sh</span><br><span class="line">   (5) 变量引用-----------------------------！！！</span><br><span class="line">         $@ , $*</span><br><span class="line">[root@centos6 ~]#for n in 1 2 5 7 8 ;do echo $n ;sleep 0.5 ;done</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">5</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">[root@centos6 ~]#for n in /var/log/*.log ;do echo &quot;filename=`basename $n`&quot; ;sleep 0.5 ;done</span><br><span class="line">filename=anaconda.ifcfg.log</span><br><span class="line">filename=anaconda.log</span><br><span class="line">filename=anaconda.program.log</span><br><span class="line">filename=anaconda.storage.log</span><br><span class="line">filename=anaconda.yum.log</span><br><span class="line">filename=boot.log</span><br><span class="line">filename=dracut.log</span><br><span class="line">filename=mysqld.log</span><br><span class="line">filename=pm-powersave.log</span><br><span class="line">filename=spice-vdagent.log</span><br><span class="line">filename=wpa_supplicant.log</span><br><span class="line">filename=Xorg.0.log</span><br><span class="line">filename=Xorg.1.log</span><br><span class="line">filename=Xorg.2.log</span><br><span class="line">filename=Xorg.9.log</span><br><span class="line">filename=yum.log</span><br><span class="line">###basename 只显示基名###</span><br><span class="line">##########################################################</span><br><span class="line">for循环</span><br><span class="line">[root@centos6 ~]#sum=0;for i in &#123;1..100..5&#125;;do let sum+=i;done;echo sum=$sum</span><br><span class="line">sum=970</span><br><span class="line">相加</span><br><span class="line">bc计算</span><br><span class="line">[root@centos6 ~]#echo &#123;1..100..5&#125;</span><br><span class="line">1 6 11 16 21 26 31 36 41 46 51 56 61 66 71 76 81 86 91 96</span><br><span class="line">[root@centos6 ~]#echo &#123;1..100..5&#125;|tr &quot; &quot; &quot;+&quot;</span><br><span class="line">1+6+11+16+21+26+31+36+41+46+51+56+61+66+71+76+81+86+91+96</span><br><span class="line">[root@centos6 ~]#echo &#123;1..100..5&#125;|tr &quot; &quot; &quot;+&quot;|bc</span><br><span class="line">970</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![for特殊用法.png](http://upload-images.jianshu.io/upload_images/6132998-b4eb7e187eb56eaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line"></span><br><span class="line">##########################################################</span><br><span class="line"></span><br><span class="line">ping -[options]</span><br><span class="line"></span><br><span class="line">- w的最后期限</span><br><span class="line">在ping退出之前，指定一个超时，</span><br><span class="line">发送或接收的数据包少了。在</span><br><span class="line">这种情况下，ping在发送数据包后不会停止，</span><br><span class="line">它会等待最后期限到期，或者直到计数探针</span><br><span class="line">对网络中的错误通知进行应答或发送。</span><br><span class="line">-W超时</span><br><span class="line">在几秒钟内等待响应。的选项</span><br><span class="line">只影响任何反应的超时时间，其他的——</span><br><span class="line">聪明的ping等待着两个rtt。</span><br><span class="line"></span><br><span class="line">root@centos6 ~]#arp  查看MAC地址</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">172.17.252.218                   (incomplete)                              eth1</span><br><span class="line">172.17.252.243                   (incomplete)                              eth1</span><br><span class="line">192.168.239.1            ether   00:50:56:c0:00:01   C                     eth0</span><br><span class="line">172.17.252.185                   (incomplete)                              eth1</span><br><span class="line">172.17.252.28                    (incomplete)                              eth1</span><br><span class="line">172.17.252.194                   (incomplete)                              eth1</span><br><span class="line">172.17.252.15                    (incomplete)                              eth1</span><br><span class="line"></span><br><span class="line">for语句特殊用法</span><br><span class="line">for ((cmd1;cmd2;cmd3))</span><br><span class="line">do</span><br><span class="line">cmd4</span><br><span class="line">done</span><br><span class="line">[root@centos7 ~]#sum=0;for i in &#123;1..100..2&#125;;do let sum+=i;done;echo sum=$sum</span><br><span class="line">sum=2500</span><br><span class="line">[root@centos7 ~]#for((sum=0,i=1;i&lt;=100;i+=2));do let sum+=i;done;echo sum=$sum</span><br><span class="line">sum=2500</span><br><span class="line">[root@centos7 ~]#sum=0;i=1;while [ $i -le 100 ];do let sum+=i;let i+=2; done;echo sum=$sum</span><br><span class="line">sum=2500</span><br><span class="line">#################################################</span><br><span class="line">nmap扫描端口    arp查看MAC地址</span><br><span class="line">扫描端口；</span><br><span class="line">[root@centos6 ~]#nmap -v -A 172.17.252.8</span><br><span class="line"></span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2017-06-13 09:59 CST</span><br><span class="line">NSE: Loaded 57 scripts for scanning.</span><br><span class="line">Initiating ARP Ping Scan at 09:59</span><br><span class="line">Scanning 172.17.252.8 [1 port]</span><br><span class="line">Completed ARP Ping Scan at 09:59, 0.02s elapsed (1 total hosts)</span><br><span class="line">Initiating Parallel DNS resolution of 1 host. at 09:59</span><br><span class="line">Completed Parallel DNS resolution of 1 host. at 09:59, 6.61s elapsed</span><br><span class="line">Initiating SYN Stealth Scan at 09:59</span><br><span class="line">Scanning 172.17.252.8 [1000 ports]</span><br><span class="line">Discovered open port 22/tcp on 172.17.252.8</span><br><span class="line">Completed SYN Stealth Scan at 09:59, 5.09s elapsed (1000 total ports)</span><br><span class="line">Initiating Service scan at 09:59</span><br><span class="line">Scanning 1 service on 172.17.252.8</span><br><span class="line">Completed Service scan at 09:59, 0.06s elapsed (1 service on 1 host)</span><br><span class="line">Initiating OS detection (try #1) against 172.17.252.8</span><br><span class="line">Retrying OS detection (try #2) against 172.17.252.8</span><br><span class="line">NSE: Script scanning 172.17.252.8.</span><br><span class="line">Initiating NSE at 09:59</span><br><span class="line">Completed NSE at 09:59, 0.09s elapsed</span><br><span class="line">Nmap scan report for 172.17.252.8</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 999 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 5.3 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: 1024 e3:96:d3:12:5d:13:49:3c:d2:16:c9:d8:40:14:fa:8a (DSA)</span><br><span class="line">|_2048 f5:ea:a1:0c:c4:e7:b2:08:a7:7e:38:eb:c7:96:5c:a5 (RSA)</span><br><span class="line">MAC Address: 00:0C:29:F7:2B:AD (VMware)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: specialized|WAP|general purpose</span><br><span class="line">Running (JUST GUESSING): Crestron 2-Series (90%), Netgear embedded (90%), Linux 2.6.X (86%)</span><br><span class="line">Aggressive OS guesses: Crestron XPanel control system (90%), Netgear DG834G WAP (90%), Linux 2.6.24 - 2.6.35 (86%), Linux 2.6.22 (85%), Linux 2.6.23 - 2.6.33 (85%), Linux 2.6.28 (Gentoo) (85%), Linux 2.6.31 - 2.6.34 (85%), Linux 2.6.9 - 2.6.27 (85%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 0.124 days (since Tue Jun 13 07:00:56 2017)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty=262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   1.29 ms 172.17.252.8</span><br><span class="line"></span><br><span class="line">Read data files from: /usr/share/nmap</span><br><span class="line">OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 16.26 seconds</span><br><span class="line">           Raw packets sent: 2059 (94.192KB) | Rcvd: 36 (3.228KB)</span><br><span class="line"></span><br><span class="line">查看IP地址频通情况；</span><br><span class="line">[root@centos7 bin]#cat IP2.sh</span><br><span class="line">#！/bin/bash</span><br><span class="line">up=0</span><br><span class="line">down=0</span><br><span class="line">net=172.17.252</span><br><span class="line">for i in &#123;1..100&#125;</span><br><span class="line">     do</span><br><span class="line">     ping -c1 -W1 $net.$i &amp;&gt; /dev/null &amp;&amp; &#123; echo $net.$i is up;let ++up ; &#125; || &#123; echo $net.$i is down;let ++down ; &#125;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo the up host is $up</span><br><span class="line">echo the host is $down</span><br><span class="line"></span><br><span class="line">[root@centos7 bin]#ps -ax |grep IP2.sh</span><br><span class="line"> 11618 pts/2    S+     0:00 bash IP2.sh</span><br><span class="line"> 11700 pts/1    S+     0:00 grep --color=auto IP2.sh</span><br><span class="line"></span><br><span class="line">##############################################</span><br><span class="line">打印星；不换行</span><br><span class="line">echo -e  \c</span><br><span class="line"></span><br><span class="line">echo -n</span><br><span class="line">两种不换行</span><br><span class="line">##############################################</span><br><span class="line">[root@centos6 ~]#cat xing.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">x=16</span><br><span class="line">y=8</span><br><span class="line">for i in `seq $y`</span><br><span class="line">do</span><br><span class="line">       for j in `seq $x`</span><br><span class="line">       do</span><br><span class="line">            echo -e &apos;*\c&apos;</span><br><span class="line">       done</span><br><span class="line">       echo</span><br><span class="line">done</span><br><span class="line">[root@centos6 ~]#vim 9*9.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">for i in `seq 9` ;do----i单一调出seq9列出的数字</span><br><span class="line">       for j in `seq $i` ;do ---j单一调出seq $i列出的数字。</span><br><span class="line">       let x=j*i  乘法运算</span><br><span class="line">       echo -en &quot;$j*$i=$x\t&quot;</span><br><span class="line">    done</span><br><span class="line">       echo</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">---\t为 TAB键为对齐---</span><br><span class="line">echo -e为激活转义 -n 为不换行</span><br><span class="line">[root@centos6 ~]#. 9*9.sh</span><br><span class="line">1=1</span><br><span class="line">2=2     2=4</span><br><span class="line">3=3     3=6     3=9</span><br><span class="line">4=4     4=8     4=12    4=16</span><br><span class="line">5=5     5=10    5=15    5=20    5=25</span><br><span class="line">6=6     6=12    6=18    6=24    6=30    6=36</span><br><span class="line">7=7     7=14    7=21    7=28    7=35    7=42    7=49</span><br><span class="line">8=8     8=16    8=24    8=32    8=40    8=48    8=56    8=64</span><br><span class="line">9=9     9=18    9=27    9=36    9=45    9=54    9=63    9=72    9=81</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#vim 9*9.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">for i in `seq 9` ;do</span><br><span class="line">       for j in `seq $i` ;do</span><br><span class="line">       let x=j*i</span><br><span class="line">       echo -en &quot;$&#123;j&#125;x$&#123;i&#125;=$&#123;x&#125;\t&quot;</span><br><span class="line">    done</span><br><span class="line">       echo</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#. 9*9.sh</span><br><span class="line">1x1=1</span><br><span class="line">1x2=2   2x2=4</span><br><span class="line">1x3=3   2x3=6   3x3=9</span><br><span class="line">1x4=4   2x4=8   3x4=12  4x4=16</span><br><span class="line">1x5=5   2x5=10  3x5=15  4x5=20  5x5=25</span><br><span class="line">1x6=6   2x6=12  3x6=18  4x6=24  5x6=30  6x6=36</span><br><span class="line">1x7=7   2x7=14  3x7=21  4x7=28  5x7=35  6x7=42  7x7=49</span><br><span class="line">1x8=8   2x8=16  3x8=24  4x8=32  5x8=40  6x8=48  7x8=56  8x8=64</span><br><span class="line">1x9=9   2x9=18  3x9=27  4x9=36  5x9=45  6x9=54  7x9=63  8x9=72  9x9=81</span><br><span class="line">[root@centos6 ~]#vim 9*9.2.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">for i in `seq 9` ;do</span><br><span class="line">      for j in `seq $i`;do</span><br><span class="line"></span><br><span class="line">            echo -ne &quot;$i*$j=$[j*i]\t&quot;</span><br><span class="line"></span><br><span class="line">          done</span><br><span class="line">      echo</span><br><span class="line">done</span><br><span class="line">~</span><br><span class="line">##############################################</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#n=-20;[[ $n =~ ^-?[[:digit:]]+$ ]]&amp;&amp; echo true</span><br><span class="line">true</span><br><span class="line">[root@centos6 ~]#ans=Y;ans=`echo $ans |tr &apos;A-Z&apos; &apos;a-z&apos;`; [[ $ans =~ ^yes|y$ ]]&amp;&amp;echo yes</span><br><span class="line">yes</span><br><span class="line"></span><br><span class="line">双中括号支持正则表达式</span><br><span class="line">##############################################</span><br><span class="line">三角形</span><br><span class="line">read -p &quot;请输入行数：&quot; x</span><br><span class="line">for i in `seq` $x ; do</span><br><span class="line">      let a=2*i-1</span><br><span class="line">      let b=x-i</span><br><span class="line">      for k in seq $b ; do</span><br><span class="line">      echo -n &quot; &quot;</span><br><span class="line">      done</span><br><span class="line">      for z in seq $a ; do</span><br><span class="line">      echo -n &quot;*&quot;</span><br><span class="line">      done</span><br><span class="line">      echo</span><br><span class="line">done</span><br><span class="line">##############################################</span><br><span class="line">2*第几行的编号=第几行的星的个数</span><br><span class="line"></span><br><span class="line">总行数-当前行的编号=等于当前行的空格数</span><br><span class="line">#############################################</span><br><span class="line"></span><br><span class="line">[root@centos6 ~]#vim sanjiao.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;请输入数字：&quot; x</span><br><span class="line">[[ ！$x =~ [:digit:] ]] &amp;&amp;&#123;  echo &apos;请输入数字&apos;; exit ; &#125; || echo &apos;等边三角形&apos;</span><br><span class="line">  双中括号，是否包含，          看成整体，需加大括号；</span><br><span class="line"></span><br><span class="line">for i in `seq $x` ; do</span><br><span class="line">     let a=x-i</span><br><span class="line">     let b=2*i-1</span><br><span class="line">    for z in `seq $a`; do</span><br><span class="line">           echo -n &quot; &quot;</span><br><span class="line">              done</span><br><span class="line">    for y in `seq $b`; do</span><br><span class="line">           echo -n &quot;*&quot;</span><br><span class="line">               done</span><br><span class="line">        echo</span><br><span class="line">  done</span><br><span class="line">#################################################</span><br></pre></td></tr></table></figure></p>
<p>######while循环<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">while CONDITION ; do</span><br><span class="line">       循环体</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">CONDITION: 循环控制条件；进入循环之前，先做一次判断；每一次循环之后会再次做判断；条件为“true”,则执行一次循环；直到条件测试状态为“false”终止循环</span><br><span class="line">因此：CONDITION一般应该有循环控制变量；而此变量的值 会在循环体不断地陪修正</span><br><span class="line">进入条件：CONDITION为true</span><br><span class="line">退出条件：CONDITION为false</span><br><span class="line">特殊用法</span><br><span class="line">while 循环特殊用法</span><br><span class="line">while read line ; do</span><br><span class="line">     循环体</span><br><span class="line">done &lt; /PATH/FROM/SOMEFILE</span><br><span class="line">依次读取文件中的每一行，并将行赋值给变量line</span><br><span class="line">#################################################</span><br><span class="line">选取随机密码；</span><br><span class="line">bDN9ajsv</span><br><span class="line">[root@centos6 ~]#cat /dev/urandom |tr -dc &apos;a-zA-Z0-9&apos;|head -c 8</span><br><span class="line">#####################################</span><br><span class="line">tr -dc -----删除并替换</span><br><span class="line">#####################################</span><br><span class="line">[root@centos6 ~]#vim while.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">i=1</span><br><span class="line">while [ &quot;$i&quot; -le 10 ];do</span><br><span class="line">      useradd user$i</span><br><span class="line">      echo &quot;user$i is created&quot;</span><br><span class="line">      password=`cat /dev/urandom |tr -dc &apos;a-zA-Z0-9&apos;|head -c 8`</span><br><span class="line">      echo $password |passwd --stdin user$i &amp;&gt; /dev/null</span><br><span class="line">      let i++ ;</span><br><span class="line">done</span><br><span class="line">##########################################################</span><br><span class="line">[root@centos6 ~]#chage -d0 user1</span><br><span class="line">重设口令</span><br><span class="line">[root@centos6 ~]#passwd -e user2</span><br><span class="line">重设口令</span><br><span class="line">##########################################################</span><br></pre></td></tr></table></figure></p>
<p>######until<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#################################################</span><br><span class="line">until CONDITION;do   倒序  until false; do</span><br><span class="line">      循环体</span><br><span class="line">                              循环体</span><br><span class="line">done                         Done</span><br><span class="line"></span><br><span class="line">#################################################</span><br></pre></td></tr></table></figure></p>
<p>######continue ,break<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">循环控制语句continue ,break</span><br><span class="line">用于循环中</span><br><span class="line">continue [N];提前结束第N层的本轮循环，而直接进入下一轮判断；最内层为第一层</span><br><span class="line"></span><br><span class="line">N --- 表示最外层循环；</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">for i in &#123;1..10&#125;</span><br><span class="line">do</span><br><span class="line">  [ $i -eq 5 ] &amp;&amp; continue---结束本次循环</span><br><span class="line">  echo i=$1</span><br><span class="line">  sleep 0.5</span><br><span class="line">done</span><br><span class="line">echo test is finished</span><br><span class="line">#!/bin/bash</span><br><span class="line">for i in &#123;1..10&#125;</span><br><span class="line">do</span><br><span class="line">  [ $i -eq 5 ] &amp;&amp; break --- 结束整个循环</span><br><span class="line">  echo i=$1</span><br><span class="line">  sleep 0.5</span><br><span class="line">done</span><br><span class="line">echo test is finished</span><br><span class="line"></span><br><span class="line">#################################################</span><br></pre></td></tr></table></figure></p>
<p>######循环控制shift命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shift [N]</span><br><span class="line">用于将参量列表list 左移指定次数，缺省为左移一次。</span><br><span class="line">参数列表 list 一旦被移动，最左端的那个参数就从列表中删除。while 循环遍历位置参量列表时，常用到shift</span><br><span class="line">#################################################</span><br></pre></td></tr></table></figure></p>
<p>######trap信号捕捉；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#！/bin/bash</span><br><span class="line">trap &apos;echo int&apos; int</span><br><span class="line">trap -p</span><br><span class="line">for i in &#123;1..10&#125;;</span><br><span class="line">do</span><br><span class="line">    echo i=$i</span><br><span class="line">    sleep 0.3</span><br><span class="line">done</span><br><span class="line">trap &apos;&apos; int</span><br><span class="line">trap -p</span><br><span class="line">for i in &#123;11..20&#125;</span><br><span class="line">do</span><br><span class="line">  echo i=$i</span><br><span class="line">  sleep 0.3</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">trap &apos;-&apos; int   ---- 恢复信号，不再捕捉</span><br><span class="line">trap -p</span><br><span class="line">for i in &#123;21..30&#125;</span><br><span class="line">do</span><br><span class="line">  echo i=$i</span><br><span class="line">  sleep 0.3</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">脚本；</span><br><span class="line">#!/bin/bash</span><br><span class="line">date1=&quot;Monday&quot;</span><br><span class="line">date2=&quot;Tuesday&quot;</span><br><span class="line">date3=&quot;Wednesday&quot;</span><br><span class="line">date4=&quot;Thursday&quot;</span><br><span class="line">date5=&quot;Friday&quot;</span><br><span class="line">date6=&quot;Saturday&quot;</span><br><span class="line">date7=&quot;Sunday&quot;</span><br><span class="line">for week in `date +%A`;do      date +%A 显示星期几</span><br><span class="line"> if  [ $week==$date1 ];then    ==-----是否等于</span><br><span class="line">    echo &quot;This is $week&quot; &amp;&amp; ls -l</span><br><span class="line">elif [ $week==$date2 ];then</span><br><span class="line">    echo &quot;Thsi is $week&quot; &amp;&amp; pwd</span><br><span class="line">elif [ $week==$date3 ];then</span><br><span class="line">    echo &quot;This is $week&quot; &amp;&amp; cal</span><br><span class="line">elif [ $week==$date4 ];then</span><br><span class="line">    echo &quot;This is $week&quot; &amp;&amp; tty</span><br><span class="line">elif [ $week==$date5 ];then</span><br><span class="line">    echo &quot;this is $week&quot; &amp;&amp; id</span><br><span class="line">elif [ $week==$date6 ];then</span><br><span class="line">    echo &quot;This is $week&quot; &amp;&amp; du -sh ---显示当前目录的总和大小</span><br><span class="line">else</span><br><span class="line">    echo &quot;This is $week&quot; &amp;&amp; history -r ---将历史命令读入缓冲区中</span><br><span class="line">fi</span><br><span class="line">done</span><br><span class="line">[root@centos7 app]#cal</span><br><span class="line">      July 2017</span><br><span class="line">Su Mo Tu We Th Fr Sa</span><br><span class="line">                   1</span><br><span class="line"> 2  3  4  5  6  7  8</span><br><span class="line"> 9 10 11 12 13 14 15</span><br><span class="line">16 17 18 19 20 21 22</span><br><span class="line">23 24 25 26 27 28 29</span><br><span class="line">30 31</span><br><span class="line">[root@centos7 app]#tty</span><br><span class="line">/dev/pts/1</span><br><span class="line">[root@centos7 app]#id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">###统计文件行数；</span><br><span class="line">[root@centos7 app]#vim wcfile.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;please input a file way name or quit:&quot; file</span><br><span class="line">until [ $file == &apos;quit&apos; ]; do  条件判断； 是否等于</span><br><span class="line">      line=`cat $file | wc -l`</span><br><span class="line">      echo &quot;The file have a $line line!&quot;</span><br><span class="line">read -p &quot;pieace input a file way name:&quot; file</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>######select循环<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select varible in list</span><br><span class="line">do</span><br><span class="line"> 循环体命令</span><br><span class="line">done</span><br><span class="line">select 循环主要用于创建菜单，按数字顺序排列的才单项奖显示在标准错误上，并显示PS3提示符，等待用户输入</span><br><span class="line">用户输入菜单中的某个数字，执行相应的命令</span><br><span class="line">用户输入被保存在内置变量REPLY中</span><br><span class="line"></span><br><span class="line">select menu in huimian hulatang yangtang</span><br><span class="line">do</span><br><span class="line">  [ -z &quot;$menu&quot; -o $menu= &quot;exit&quot; ] &amp;&amp; break</span><br><span class="line">  echo  your choose is  $menu</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#################################################</span><br></pre></td></tr></table></figure></p>
<p>######函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  函数 &#123;cmd;cmd;cmd&#125;匿名函数；没有函数名</span><br><span class="line">  #bash --version</span><br><span class="line">   查看bash 版本</span><br><span class="line"></span><br><span class="line">定义函数</span><br><span class="line">函数有两个部分组成；函数名和函数体</span><br><span class="line">语法一；function f_name&#123;</span><br><span class="line">             ...函数体...</span><br><span class="line">&#125;</span><br><span class="line">语法二：function f_name ()&#123;</span><br><span class="line">              ...函数体...</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">语法三；f_name ()&#123;</span><br><span class="line">              ...函数体...</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----定义函数 大括号里要隔开一个空格输入----</span><br><span class="line"></span><br><span class="line">declare -f 显示函数</span><br><span class="line"></span><br><span class="line">declare -f func2 也可以指定某个函数</span><br><span class="line"></span><br><span class="line">declare -x 显示所有环境变量</span><br><span class="line"></span><br><span class="line">unset func2  和取消变量一样</span><br></pre></td></tr></table></figure></p>
<p>#grep ‘^.*()’ /etc/init.d/functions/</p>
]]></content>
      
        
        <tags>
            
            <tag> 循环语句 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[进程管理工具]]></title>
      <url>/2018/01/09/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<p>系统监控工具<br>    进程管理工具<br>    kill -l  信号种类<br>    httpd主页实验(kill -1)<br>    前后台切换</p>
<p>######系统监控工具<br>dstat、vmstat、iostat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]# dstat </span><br><span class="line">You did not select any stats, using -cdngy by default.</span><br><span class="line">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--</span><br><span class="line">usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw </span><br><span class="line">  1   1  98   1   0   0| 271k  216k|   0     0 |   0     3B| 154   184 </span><br><span class="line">  0   0 100   0   0   0|   0     0 | 240B  870B|   0     0 |  53    71 </span><br><span class="line">  1   0 100   0   0   0|   0     0 | 540B  390B|   0     0 |  54    69 </span><br><span class="line">  0   0 100   0   0   0|   0     0 | 240B  390B|   0     0 |  37    55 </span><br><span class="line">  0   0 100   0   0   0|   0     0 | 240B  390B|   0     0 |  63    78 </span><br><span class="line">  0   0 100   0   0   0|   0     0 | 780B  390B|   0     0 |  47    55 </span><br><span class="line">  0   0 100   0   0   0|   0     0 |1020B  390B|   0     0 |  66    73 </span><br><span class="line">  0   0 100   0   0   0|   0  1024B| 544B  390B|   0     0 |  54    67 </span><br><span class="line">  0   0 100   0   0   0|   0  4096B| 950B  390B|   0     0 |  74    85 </span><br><span class="line">  0   0 100   0   0   0|   0     0 | 488B  390B|   0     0 |  47    65 ^C</span><br><span class="line">[root@centos7 ~]# dstat -c</span><br><span class="line">----total-cpu-usage----</span><br><span class="line">usr sys idl wai hiq siq</span><br><span class="line">  1   1  97   1   0   0</span><br><span class="line">  0   0 100   0   0   0</span><br><span class="line">  0   0 100   0   0   0</span><br><span class="line">  0   0 100   0   0   0</span><br><span class="line">  0   0 100   0   0   0</span><br><span class="line">  0   0 100   0   0   0^C</span><br><span class="line">[root@centos7 ~]# dstat -d</span><br><span class="line">-dsk/total-</span><br><span class="line"> read  writ</span><br><span class="line"> 347k  285k</span><br><span class="line">   0    16k</span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 ^C</span><br><span class="line">[root@centos7 ~]# dstat -g</span><br><span class="line">---paging--</span><br><span class="line">  in   out </span><br><span class="line">   0     4B</span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 ^C</span><br><span class="line">[root@centos7 ~]# dstat -m</span><br><span class="line">------memory-usage-----</span><br><span class="line"> used  buff  cach  free</span><br><span class="line"> 594M 40.0k 1060M  169M</span><br><span class="line"> 595M 40.0k 1060M  169M</span><br><span class="line"> 595M 40.0k 1060M  169M</span><br><span class="line"> 595M 40.0k 1060M  169M</span><br><span class="line"> 595M 40.0k 1060M  169M^C</span><br><span class="line">[root@centos7 ~]# dstat -p</span><br><span class="line">---procs---</span><br><span class="line">run blk new</span><br><span class="line">  0   0 1.0</span><br><span class="line">  0   0   0</span><br><span class="line">  0   0   0</span><br><span class="line">  0   0   0^C</span><br><span class="line">[root@centos7 ~]# dstat -r</span><br><span class="line">--io/total-</span><br><span class="line"> read  writ</span><br><span class="line">6.27  1.19 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 </span><br><span class="line">   0     0 ^C</span><br><span class="line">[root@centos7 ~]# dstat -s</span><br><span class="line">----swap---</span><br><span class="line"> used  free</span><br><span class="line">  12k 4096M</span><br><span class="line">  12k 4096M</span><br><span class="line">  12k 4096M^C</span><br><span class="line">[root@centos7 ~]# sdtat --tcp</span><br><span class="line">bash: sdtat: command not found...</span><br><span class="line">Similar command is: &apos;dstat&apos;</span><br><span class="line">[root@centos7 ~]# dstat --tcp  </span><br><span class="line">----tcp-sockets----</span><br><span class="line">lis act syn tim clo</span><br><span class="line"> 10   2   0   0   0</span><br><span class="line"> 10   2   0   0   0</span><br><span class="line"> 10   2   0   0   0</span><br><span class="line"> 10   2   0   0   0^C</span><br><span class="line">[root@centos7 ~]# dstat udp</span><br><span class="line">You did not select any stats, using -cdngy by default.</span><br><span class="line">dstat: incorrect argument, try dstat -h for the correct syntax</span><br><span class="line">[root@centos7 ~]# dstat --udp</span><br><span class="line">--udp--</span><br><span class="line">lis act</span><br><span class="line"> 10   0</span><br><span class="line"> 10   0</span><br><span class="line"> 10   0</span><br><span class="line"> 10   0</span><br><span class="line"> 10   0^C</span><br><span class="line">[root@centos7 ~]# dstat --unix</span><br><span class="line">--unix-sockets-</span><br><span class="line">dgm str lis act</span><br><span class="line"> 41 443  66 377</span><br><span class="line"> 41 443  66 377</span><br><span class="line"> 41 443  66 377</span><br><span class="line"> 41 443  66 377^C</span><br><span class="line">[root@centos7 ~]# dstat --raw</span><br><span class="line">raw</span><br><span class="line">raw</span><br><span class="line">  0</span><br><span class="line">  0</span><br><span class="line">  0</span><br><span class="line">  0</span><br><span class="line">  0</span><br><span class="line">  0^C</span><br><span class="line">[root@centos7 ~]# dstat --socket</span><br><span class="line">------sockets------</span><br><span class="line">tot tcp udp raw frg</span><br><span class="line">  1   7   8   0   0</span><br><span class="line">  1   7   8   0   0</span><br><span class="line">  1   7   8   0   0^C</span><br><span class="line">[root@centos7 ~]# dstat --ipc</span><br><span class="line">--sysv-ipc-</span><br><span class="line">msg sem shm</span><br><span class="line">  0   0   2</span><br><span class="line">  0   0   2</span><br><span class="line">  0   0   2^C</span><br><span class="line">[root@centos7 ~]# dstat --top-cpu</span><br><span class="line">-most-expensive-</span><br><span class="line">  cpu process   </span><br><span class="line">vmtoolsd     0.1</span><br><span class="line">vmtoolsd     0.5</span><br><span class="line">vmtoolsd     0.5</span><br><span class="line">kworker/0:2  0.5</span><br><span class="line">xfsaild/sda2 0.5</span><br><span class="line">vmtoolsd     0.5</span><br><span class="line">rcu_sched    0.5</span><br><span class="line">vmtoolsd     0.5             </span><br><span class="line">vmtoolsd     0.5</span><br><span class="line">vmtoolsd     0.5</span><br><span class="line">-most-expensive-</span><br><span class="line">  cpu process                   </span><br><span class="line">ksmtuned     0.5               </span><br><span class="line">irqbalance   0.5^C</span><br><span class="line">[root@centos7 ~]# dstat --top-io</span><br><span class="line">----most-expensive----</span><br><span class="line">     i/o process      </span><br><span class="line">packagekitd 386k  174k</span><br><span class="line">sshd: root@ 146B  240B</span><br><span class="line">sshd: root@  78B  160B</span><br><span class="line">sshd: root@  78B  160B</span><br><span class="line">irqbalance 6144B    0 </span><br><span class="line">sshd: root@  71B  160B</span><br><span class="line">sshd: root@  78B  160B</span><br><span class="line">vmtoolsd   9744B    0 </span><br><span class="line">sshd: root@  71B  160B^C</span><br><span class="line">[root@centos7 ~]# dstat --top-mem</span><br><span class="line">--most-expensive-</span><br><span class="line">  memory process </span><br><span class="line">gnome-shell  145M</span><br><span class="line">gnome-shell  145M</span><br><span class="line">gnome-shell  145M</span><br><span class="line">gnome-shell  145M</span><br><span class="line">gnome-shell  145M^C</span><br><span class="line">[root@centos7 ~]# dstat --top-latency</span><br><span class="line">--highest-total--</span><br><span class="line"> latency process </span><br><span class="line">rcu_sched     817</span><br><span class="line">ksoftirqd/1  3391</span><br><span class="line">ksoftirqd/1  1090</span><br><span class="line">rcu_sched     994</span><br><span class="line">rcu_sched    1048</span><br><span class="line">kworker/1:2   123</span><br><span class="line">ksoftirqd/1   981</span><br><span class="line">xfsaild/sda2  136</span><br><span class="line">rcu_sched    1063</span><br><span class="line">ksoftirqd/1  1029^C</span><br><span class="line">[root@centos7 ~]# vmstat</span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 1  0     12 133548     40 1229856    0    0   166   134   88  103  1  1 97  1  0</span><br><span class="line">[root@centos7 ~]# iostat</span><br><span class="line">Linux 3.10.0-514.el7.x86_64 (centos7.bai.com)   07/01/2017      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           0.25    0.78    0.72    0.98    0.00   97.27</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn</span><br><span class="line">scd0              0.01         0.02         0.00         66          0</span><br><span class="line">sda              10.58       332.49       265.27    1013497     808601</span><br><span class="line">sdb               0.05         0.34         0.00       1044          0</span><br><span class="line">sdc               0.05         0.34         0.00       1044          0</span><br><span class="line">sdd               0.05         0.34         0.00       1044          0</span><br></pre></td></tr></table></figure></p>
<p>进程管理工具；<br>pidof、pgerp 、ps aux 、pstree<br>kill -l、trap -l   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#pidof bc查看进程编号</span><br><span class="line">[root@centos7 ~]# bc</span><br><span class="line">bc 1.06.95</span><br><span class="line">Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006 Free Software Foundation, Inc.</span><br><span class="line">This is free software with ABSOLUTELY NO WARRANTY.</span><br><span class="line">For details type `warranty&apos;. </span><br><span class="line">[root@centos7 ~]# pidof bc</span><br><span class="line">5730</span><br><span class="line">[root@centos7 ~]# kill -3 5730</span><br><span class="line">[root@centos7 ~]# bc</span><br><span class="line">bc 1.06.95</span><br><span class="line">Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006 Free Software Foundation, Inc.</span><br><span class="line">This is free software with ABSOLUTELY NO WARRANTY.</span><br><span class="line">For details type `warranty&apos;. </span><br><span class="line">^\Quit (core dumped)</span><br><span class="line">[root@centos7 ~]# </span><br><span class="line">相当于quite命令退出</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">kill -l  信号种类</span><br><span class="line">[root@centos7 ~]# kill -l</span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# trap -l</span><br><span class="line"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP</span><br><span class="line"> 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1</span><br><span class="line">11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM</span><br><span class="line">16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP</span><br><span class="line">21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR</span><br><span class="line">31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1  64) SIGRTMAX</span><br><span class="line"></span><br><span class="line">###trap -l   、 kill -l 查看信号管理种类</span><br><span class="line">1---无需关闭进程，将其重新读取配置文件</span><br><span class="line">2---终止正在运行中的进程：相当于ctrl+c</span><br><span class="line">3---相当于ctrl+\ 相当用quit命令退出</span><br><span class="line">9---强制杀死正在运行中的进程</span><br><span class="line">15---终止运行的进程，相当于kill  、可以不写 -15。打开vim用15关闭进程，不能保存文件。</span><br><span class="line">18---继续运行</span><br><span class="line">19---后台休眠</span><br><span class="line"></span><br><span class="line">pgrep命令 </span><br><span class="line">查询当前某个用户开启了那些进程</span><br><span class="line"></span><br><span class="line">pgrep -U bai发起者进程编号      </span><br><span class="line">      -aU     进程名称</span><br><span class="line">pgrep -u bai 生效者进程编号</span><br><span class="line">pgrep -au bai </span><br><span class="line">pstree 查看树状结构进程编号</span><br><span class="line">[bai@centos7 ~]$ ping 127.1</span><br><span class="line">PING 127.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.113 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.046 ms</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# pgrep -aU bai</span><br><span class="line">6026 -bash</span><br><span class="line">6070 ping 127.1</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# pgrep -u bai </span><br><span class="line">6026</span><br><span class="line">6070</span><br><span class="line">[root@centos7 ~]# pgrep -au bai</span><br><span class="line">6026 -bash</span><br><span class="line">6070 ping 127.1</span><br><span class="line"></span><br><span class="line">kill -15</span><br><span class="line">杀父进程</span><br><span class="line">[root@centos7 ~]# pgrep -aU bai</span><br><span class="line">6026 -bash</span><br><span class="line">6259 ping 127.1</span><br><span class="line">[root@centos7 ~]# pgrep -au bai</span><br><span class="line">6026 -bash</span><br><span class="line">6259 ping 127.1</span><br><span class="line">[root@centos7 ~]# kill 6026</span><br><span class="line">[root@centos7 ~]# pgrep -au bai</span><br><span class="line">6026 -bash</span><br><span class="line">6259 ping 127.1</span><br><span class="line">[root@centos7 ~]# pgrep -aU bai</span><br><span class="line">6026 -bash</span><br><span class="line">6259 ping 127.1</span><br><span class="line">[root@centos7 ~]# </span><br><span class="line">不起作用 15命令</span><br><span class="line"></span><br><span class="line">kill -9 </span><br><span class="line">1、[root@centos7 ~]# pgrep -aU bai</span><br><span class="line">7095 -bash</span><br><span class="line">7135 vim f</span><br><span class="line">[root@centos7 ~]# kill -9 7095</span><br><span class="line">[root@centos7 ~]# pgrep -aU bai</span><br><span class="line">ping特殊</span><br><span class="line">2、[root@centos7 ~]# pgrep -au bai</span><br><span class="line">7261 -bash</span><br><span class="line">7301 ping 127.1</span><br><span class="line">[root@centos7 ~]# kill -9 7261</span><br><span class="line">[root@centos7 ~]# pgrep -au bai</span><br><span class="line">7301 ping 127.1</span><br><span class="line">再生进程</span><br><span class="line">[root@centos6 ~]#ps aux |grep ming    </span><br><span class="line">root       2616  0.0  0.0   4068   540 tty2     Ss+  02:38   0:00 /sbin/mingetty /dev/tty2</span><br><span class="line">root       2618  0.0  0.0   4068   540 tty3     Ss+  02:38   0:00 /sbin/mingetty /dev/tty3</span><br><span class="line">root       2620  0.0  0.0   4068   544 tty4     Ss+  02:38   0:00 /sbin/mingetty /dev/tty4</span><br><span class="line">root       2626  0.0  0.0   4068   544 tty5     Ss+  02:38   0:00 /sbin/mingetty /dev/tty5</span><br><span class="line">root       2640  0.0  0.0   4068   544 tty6     Ss+  02:38   0:00 /sbin/mingetty /dev/tty6</span><br><span class="line">root       4549  0.0  0.0 103336   852 pts/1    S+   07:28   0:00 grep ming</span><br><span class="line">kill 1 杀死父进程，不能在生成</span><br><span class="line">###killall bash</span><br><span class="line">[root@centos7 ~]# pidof bash</span><br><span class="line">4020 2152 648</span><br><span class="line">[root@centos7 ~]# killall bash</span><br><span class="line">可以杀死所有bash进程</span><br><span class="line">[root@centos7 ~]# killall vim</span><br><span class="line">[root@centos7 ~]# pidof vim</span><br><span class="line">4230 4229</span><br><span class="line">[root@centos7 ~]# killall -9 vim</span><br><span class="line">[root@centos7 ~]# pidof vim</span><br><span class="line"></span><br><span class="line">###pkill 支持模式 信号杀进程 与kill 类似</span><br><span class="line">杀进程终端，</span><br><span class="line">[root@centos7 ~]# w</span><br><span class="line"> 15:05:21 up 3 min,  3 users,  load average: 0.20, 0.45, 0.22</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     :0       :0               15:02   ?xdm?  16.50s  0.33s gdm-session-worker [pam/gdm-autologin]</span><br><span class="line">root     pts/0    192.168.239.1    15:03    1.00s  0.08s  0.03s w</span><br><span class="line">root     pts/2    192.168.239.1    15:04   33.00s  0.06s  0.06s -bash</span><br><span class="line">[root@centos7 ~]# who</span><br><span class="line">root     pts/1        2017-07-01 13:04 (192.168.239.1)</span><br><span class="line">root     :0           2017-07-01 13:04 (:0)</span><br><span class="line">root     pts/0        2017-07-01 14:22 (192.168.239.1)</span><br><span class="line">root     pts/2        2017-07-01 14:29 (192.168.239.1)</span><br><span class="line">[root@centos7 ~]# tty</span><br><span class="line">/dev/pts/1</span><br><span class="line">[root@centos7 ~]# pgrep -t pts/0     </span><br><span class="line">4020</span><br><span class="line">[root@centos7 ~]# tty</span><br><span class="line">/dev/pts/0</span><br><span class="line">[root@centos7 ~]# pgrep -t /dev/pts/0</span><br><span class="line">[root@centos7 ~]# pgrep -t pts/0     </span><br><span class="line">4020</span><br><span class="line">[root@centos7 ~]# pkill -t pts/0</span><br><span class="line">[root@centos7 ~]# pgrep -t pts/0</span><br><span class="line">4020</span><br><span class="line">[root@centos7 ~]# pkill -t pts/0 -9</span><br><span class="line">[root@centos7 ~]# pgrep -t pts/0</span><br></pre></td></tr></table></figure>
<p>######httpd主页实验(kill -1)；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">安装好httpd服务、links；</span><br><span class="line">#kill -1 重新读取配置文件</span><br><span class="line">###nmcli connection reload ,重新新读取配置文件</span><br><span class="line"></span><br><span class="line">修改服务配置文件；</span><br><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">修改目录后的变化</span><br><span class="line">centos7</span><br><span class="line">#cd /var/www/html 存放外部服务主页文件所在的目录</span><br><span class="line">#echo www.mage.com &gt; index.html</span><br><span class="line">创建主页</span><br><span class="line">#systemctl status httpd</span><br><span class="line">查看是否启用服务</span><br><span class="line">#systemctl start httpd</span><br><span class="line"> 启用服务</span><br><span class="line">#links 192.168.8.133</span><br><span class="line">  CENTOS6启用字符界面游览器</span><br><span class="line">#yum -y install links</span><br><span class="line">安装字符游览器</span><br><span class="line">centos7</span><br><span class="line">#iptables -vnL</span><br><span class="line">产看防火墙</span><br><span class="line">#iptables -F</span><br><span class="line">关闭防火墙</span><br><span class="line">#links 192...</span><br><span class="line">echo testpage &gt; test.html</span><br><span class="line">#links 192.168.8.133/taes.html </span><br><span class="line">更改主页位置</span><br><span class="line">mkdir /var/www/newsite</span><br><span class="line">echo  new site page &gt; /var/www/newsite/index.html</span><br><span class="line">放到新的目录</span><br><span class="line">需要在配置文件更改路径；/var/www/newsite/</span><br><span class="line">不用重启发信号可以启用，查看发到哪个进程上，重新读取配置文件</span><br><span class="line">#pstree 查看进程</span><br><span class="line">httpd 父进程；</span><br><span class="line">#ps axu </span><br><span class="line">#kill 1 (hup) 3287 </span><br><span class="line">#links 192.168.8.133</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> vim /etc/httpd/conf/httpd.conf</span><br><span class="line">#</span><br><span class="line"># This is the main Apache server configuration file.  It contains the</span><br><span class="line"># configuration directives that give the server its instructions.</span><br><span class="line"># See &lt;URL:http://httpd.apache.org/docs/2.2/&gt; for detailed information.</span><br><span class="line"># In particular, see</span><br><span class="line"># &lt;URL:http://httpd.apache.org/docs/2.2/mod/directives.html&gt;</span><br><span class="line"># for a discussion of each configuration directive.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"># Do NOT simply read the instructions in here without understanding</span><br><span class="line"># what they do.  They&apos;re here only as hints or reminders.  If you are unsure</span><br><span class="line"># consult the online docs. You have been warned.  </span><br><span class="line">#</span><br><span class="line"># The configuration directives are grouped into three basic sections:</span><br><span class="line">#  1. Directives that control the operation of the Apache server process as a</span><br><span class="line">#     whole (the &apos;global environment&apos;).</span><br><span class="line">#  2. Directives that define the parameters of the &apos;main&apos; or &apos;default&apos; server,</span><br><span class="line">#     which responds to requests that aren&apos;t handled by a virtual host.</span><br><span class="line">#     These directives also provide default values for the settings</span><br><span class="line">#     of all virtual hosts.</span><br><span class="line">#  3. Settings for virtual hosts, which allow Web requests to be sent to</span><br><span class="line">#     different IP addresses or hostnames and have them handled by the</span><br><span class="line">#     same Apache server process.</span><br><span class="line">#</span><br><span class="line"># Configuration and logfile names: If the filenames you specify for many</span><br><span class="line"># of the server&apos;s control files begin with &quot;/&quot; (or &quot;drive:/&quot; for Win32), the</span><br><span class="line"># server will use that explicit path.  If the filenames do *not* begin</span><br><span class="line"># with &quot;/&quot;, the value of ServerRoot is prepended -- so &quot;logs/foo.log&quot;</span><br><span class="line"># with ServerRoot set to &quot;/etc/httpd&quot; will be interpreted by the</span><br><span class="line"># server as &quot;/etc/httpd/logs/foo.log&quot;.</span><br><span class="line">&quot;/etc/httpd/conf/httpd.conf&quot; 1009L, 34419C</span><br></pre></td></tr></table></figure>
<p>######前后台切换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#ping 127.1</span><br><span class="line">前端执行敲命令不起作用</span><br><span class="line">#pidof ping </span><br><span class="line">查看进程编号</span><br><span class="line">#kill -19 +进程编号</span><br><span class="line">后台暂停</span><br><span class="line">[root@centos7 ~]# w</span><br><span class="line"> 15:20:47 up 18 min,  3 users,  load average: 0.01, 0.04, 0.11</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     :0       :0               15:02   ?xdm?  20.00s  0.34s gdm-session-worker [pam/gdm-autologin]</span><br><span class="line">root     pts/0    192.168.239.1    15:03    7.00s  0.06s  0.00s ping 127.1</span><br><span class="line">root     pts/2    192.168.239.1    15:04    7.00s  0.10s  0.04s w</span><br><span class="line">[root@centos7 ~]# </span><br><span class="line">[root@centos7 ~]# pidof ping</span><br><span class="line">3368</span><br><span class="line">[root@centos7 ~]# kill -19 3368</span><br><span class="line">[root@centos7 ~]# pidof ping   </span><br><span class="line">3380 3368</span><br><span class="line">[root@centos7 ~]# killall -19 ping</span><br><span class="line"></span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=48 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=49 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=50 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=51 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=52 ttl=64 time=0.052 ms</span><br><span class="line"></span><br><span class="line">[2]+  Stopped                 ping 127.1</span><br><span class="line">[root@centos7 ~]# ls</span><br><span class="line">anaconda-ks.cfg  Desktop    Downloads     httpd-2.4.25.tar.bz2  Music  Pictures  Templates  Videos</span><br><span class="line">bin              Documents  httpd-2.4.25  initial-setup-ks.cfg  part   Public    user.txt</span><br><span class="line">[root@centos7 ~]# pwd</span><br><span class="line">/root</span><br><span class="line">[root@centos7 ~]# who</span><br><span class="line">root     :0           2017-07-01 15:02 (:0)</span><br><span class="line">root     pts/0        2017-07-01 15:03 (192.168.239.1)</span><br><span class="line">root     pts/2        2017-07-01 15:04 (192.168.239.1)</span><br><span class="line">[root@centos7 ~]# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;dfe31250-40b8-4eaf-bf35-f462946a56e4&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sda2: UUID=&quot;f86bb45c-c257-4f7c-ae3c-fa72b50f277c&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sda3: UUID=&quot;47a6bd61-66c5-4ddc-92fe-e2325e613aee&quot; TYPE=&quot;swap&quot; </span><br><span class="line">/dev/sda5: UUID=&quot;f3824e25-f0da-4699-9607-f50ec1795e2d&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sr0: UUID=&quot;2016-12-05-13-52-39-00&quot; LABEL=&quot;CentOS 7 x86_64&quot; TYPE=&quot;iso9660&quot; PTTYPE=&quot;dos&quot; </span><br><span class="line">切换到后台停止后先前  敲过得命令执行后显示到屏幕上</span><br><span class="line">[root@centos7 ~]# ps axu</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.1  0.3 193628  6732 ?        Ss   15:01   0:01 /usr/lib/systemd/systemd --switched-ro</span><br><span class="line">root          2  0.0  0.0      0     0 ?        S    15:01   0:00 [kthreadd]</span><br><span class="line">root          3  0.0  0.0      0     0 ?        S    15:01   0:00 [ksoftirqd/0]</span><br><span class="line">root          5  0.0  0.0      0     0 ?        S&lt;   15:01   0:00 [kworker/0:0H]</span><br><span class="line">root          6  0.0  0.0      0     0 ?        S    15:01   0:00 [kworker/u256:0]</span><br><span class="line">root          7  0.0  0.0      0     0 ?        S    15:01   0:00 [migration/0]</span><br><span class="line">root          8  0.0  0.0      0     0 ?        S    15:01   0:00 [rcu_bh]</span><br><span class="line">root          9  0.0  0.0      0     0 ?        R    15:01   0:00 [rcu_sched]</span><br><span class="line">root         10  0.0  0.0      0     0 ?        S    15:01   0:00 [watchdog/0]</span><br><span class="line">###查看运行程序进程状态信号</span><br><span class="line">[root@centos7 ~]# jobs</span><br><span class="line">[1]+  Stopped                 ping 127.1</span><br><span class="line">[root@centos7 ~]# kill -18 3368</span><br><span class="line">[root@centos7 ~]# 64 bytes from 127.0.0.1: icmp_seq=69 ttl=64 time=0.044 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=70 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=71 ttl=64 time=0.051 ms</span><br><span class="line">###kill -18 </span><br><span class="line">后台运行</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-9059fb95a4b32258.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="后台运行，可以输入命令，查看命令结果"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">kill -22</span><br><span class="line">[root@centos7 ~]# kill -22 3368</span><br><span class="line"></span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=739 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=740 ttl=64 time=0.052 ms</span><br><span class="line">[1]+  Stopped                 ping 127.1</span><br><span class="line">#ps axu</span><br><span class="line">root       3368  0.0  0.0 127912  1224 pts/0    T    15:20   0:00 ping 127.1</span><br><span class="line"></span><br><span class="line">fg 1 从后台调到前台，不管休眠还是运行</span><br><span class="line">bg 1 将后台休眠调到后台运行</span><br><span class="line">cmd+ &amp; 后台运行</span><br><span class="line">前台运行时不能在当前界面输入命令执行，用快捷键ctrl+z切换到后台暂停（休眠）界面再输入bg 1就可以后运行了，输入fg 1 调回前台运行。</span><br><span class="line"></span><br><span class="line">###前台执行断开网络（断开端口）命令不在执行</span><br><span class="line">###后台执行断开网络（断开端口）命令不在执行</span><br><span class="line">###开启screen会话界面可以后台运行</span><br><span class="line">#yum -y install screen</span><br><span class="line">#screen</span><br><span class="line">#ping 127.1</span><br><span class="line">[root@centos7 ~]# pstree -p</span><br><span class="line">├─sshd(993)─┬─sshd(2990)───bash(2994)───pstree(4224)</span><br><span class="line">            └─sshd(3085)───bash(3089)───screen(4176)───screen(4177)───bash(4178)───ping(4213+</span><br><span class="line">断开网络后</span><br><span class="line">[root@centos7 ~]# ps axu|grep ping</span><br><span class="line">root       4213  0.0  0.0 127912  1228 pts/1    S+   16:12   0:00 ping 127.1</span><br><span class="line">root       4438  0.0  0.0 112648   964 pts/0    S+   16:23   0:00 grep --color=auto ping</span><br><span class="line">[root@centos7 ~]# pidof ping</span><br><span class="line">4213</span><br><span class="line">[root@centos7 ~]# pstree -p</span><br><span class="line">├─screen(4177)───bash(4178)───ping(4213)</span><br><span class="line">├─smartd(599)</span><br><span class="line">├─sshd(993)─┬─sshd(2990)───bash(2994)───pstree(4381)</span><br><span class="line">                        └─sshd(4275)───bash(4279)</span><br><span class="line">根ssh服务没关系了。后台还在运行中</span><br><span class="line">恢复screen 的端口</span><br><span class="line">[root@centos7 ~]# screen -ls </span><br><span class="line">There is a screen on:</span><br><span class="line">        4177.pts-2.centos7      (Detached)</span><br><span class="line">1 Socket in /var/run/screen/S-root.</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]# screen -r</span><br><span class="line">nohup ping 127.1&amp; </span><br><span class="line">[root@centos7 ~]# nohup ping 127.1 &amp;</span><br><span class="line">[1] 4710</span><br><span class="line">[root@centos7 ~]# nohup: ignoring input and appending output to ‘nohup.out’</span><br><span class="line">[root@centos7 ~]# tail -f nohup.out</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=263 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=264 ttl=64 time=0.062 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=265 ttl=64 time=0.049 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=266 ttl=64 time=0.047 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=267 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=268 ttl=64 time=0.048 ms</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq=269 ttl=64 time=0.049 ms</span><br><span class="line">不断地输出到nohup.out 文件里</span><br><span class="line">[root@centos7 ~]# nohup ping 127.1 &amp;&gt;/dev/null &amp;</span><br><span class="line">[3] 4912</span><br><span class="line">#last 查看日志</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 进程管理，kill </tag>
            
            <tag> dstat </tag>
            
            <tag> vmstat </tag>
            
            <tag> iostat </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[sed命令]]></title>
      <url>/2018/01/09/sed%E5%91%BD%E4%BB%A4/</url>
      <content type="html"><![CDATA[<p>sed  stream<br>查看 ，修改文件内容<br>grep 查看文件内容</p>
<pre><code>模式空间、保存空间（暂存空间）
</code></pre><p>sed【option】</p>
<pre><code>#cp /etc/passwd passwd
#sed -n passwd
</code></pre><p>常用选项</p>
<pre><code>-n ; 不输出模式空间内容到屏幕，即不自动打印

-e ; 多点编辑

-f ；/PATH/SCRIPT_FILE;从指定文件中读取编辑

-r ;支持使用扩展正则表达式

-i.bak ;备份文件内容并原处编辑
</code></pre><p>script; ‘地址命令 ‘</p>
<pre><code>地址加命令
不给地址，全文进行处理

#sed &apos;p&apos; passwd

打印两行，一个自动打印，加上打印

#sed -n &apos;p&apos; passwd  

打印一次

#cat /etc/passwd |sed -n &apos;p&apos;

单地址



#sed -n &apos;1p&apos;passwd

#ifconfig enc33 |sed -n &apos;2p&apos;

模式

#sed -n &apos;/^r/p&apos;passwd

#grep &apos;^r&apos; passwd

#sed -n &apos;3,6 p&apos; passwd

3到6

#sed -n &apos;3,+6p&apos; passwd

3+6行

#/pat1/,/pat2/

#sed -n &apos;/^h/,/^s/p&apos; passwd
h开头 s结尾
循环寻找

#,/pat/ 行号，

#sed -n &apos;3,/^s/p‘ passwd

sed 步进

一次增加多少


#echo {1..100}

#sep 100|sed -n &apos;1~2p&apos;

奇数

#seq 100|sed -n &apos;2~2p&apos;

偶数


#cat -n passwd |sed -n &apos;1~2!p&apos;

取反


#cat -n passwd|sed &apos;2d&apos;

#seq 100&gt;f1

#sed &apos;2d&apos; f1

#sed -i &apos;100d&apos; f1
#sed -i &apos;1~2d&apos; f1

#sed -i.bak &apos;1~2d&apos; f1
删除前备份
注意加后缀.bak
</code></pre><p>编辑命令</p>
<pre><code>d 删除模式空间匹配的行

p 显示模式空间的内容

a  在指定行后面追加文本、支持使用、\n实现多行追加

i  在行前面插入文本

c  替换行为单行或多行文本

w  保存模式匹配的行至指定的文件中

r  读取指定文件的文本至模式空间中匹配到的行后

=  为模式空间中的行打印行号

!  模式空间中匹配行取反处理

s/// 查找替换，支持使用其它分隔符，s@@@,s###
</code></pre><p>替换标记；<br>    g 行全局替换<br>    p 显示替换成功的行<br>    w /PATH/TO/SOMEFILE 将替换成功的行保存在文件中</p>
<pre><code># sed &apos;90anew line1\nnewline2\nnewline3&apos; f1
90行后加内容 换行

# sed &apos;90a\ new line\nnewline2\nnewline3&apos; f1
\ 加边界

# sed &apos;90i\ new line\nnewline2\nnewline3&apos; f1
在90的前面加

# sed &apos;90c\ new line\nnewline2\nnewline3&apos; f1
替代90行前面

# sed &apos;90w /root/f2&apos; f1
90行保存到f2 里

#  sed &apos;10r /etc/issue&apos; f1
将新的文件渎进f1

# sed &apos;10,30r /etc/issue&apos; f1
匹配到的每个行后 加新文件

#sed &apos;=&apos; passwd
加行号
#sed -n &apos;/^r/&apos;=passwd
只显示行号sed

#sed -n &apos;/.*root.*/=&apos; passwd
包含root的行号

#grep root passwd 

#grep -n root passwd


搜索替代

#vim f11
root.......
#sed &apos;s/root/ROOT/&apos; f11
替换root
#sed &apos;2-2s/root/ROOT/&apos;f11
替换 偶数行的搜索替换
#sed &apos;2-2s/root/ROOT/g&apos; f11
整行全部替换
#sed &apos;2-2s/root/ROOT/gp&apos; f11
只显示匹配到的行
#sed &apos;2-2s/root/ROOT/w f22&apos; f11
搜索完另存为f22
</code></pre><p>高级编辑命令</p>
<pre><code>h 把模式空间的内容覆盖至保持空间
H 把模式空间中的内容追加至保持空间
g 从保持空间取出数据覆盖至模式空间
G 从保持空间取出内容追加至模式空间
x 把模式空间的内容与保持空间的内容互换
n  读取匹配到的行的下一行覆盖至模式空间
N 读取匹配到的行的下一行追加至模式空间
d 删除模式空间中的行
D 删除当前模式空间开端至\n的内容 （不在传至标准输出），放弃之后的命令，但是对剩余模式空间从新执行sed

#sed &apos;s/^/#/&apos; install.log
#echo &quot;/etc/sysconfig/network&quot;
#echo &quot;/etc/sysconfig/networrk-scripts/&quot;
</code></pre><p>取出基名 目录名</p>
<pre><code>echo &quot;/etc/sysconfing/netwoerk-scripts/&quot; |sed -r &apos;s@（^/.*/）（[^/]+/?）@\2@&apos;
echo &quot;/etc/sysconfing/netwoerk-scripts/&quot; |sed -r &apos;s@（^/.*/）（[^/]+/?）@\1@&apos;
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/6132998-9680fdfa4c3edc54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ截图20170624195228.png"></p>
<p>取出IP地址</p>
<pre><code>#ifconfig eth0|sed -n 2p
#ifconfig eth0|sed -n 2p|sed &apos;s/^.*r://&apos;|sed &apos;/ .*/d&apos;
#ifconfig eth0|sed -n 2p|sed &apos;s/^.*r://&apos;|sed&apos;s/ .*//&apos;
#ifconfig eth0|sed -n 2p |sed -e &apos;s/^.*r://&apos; -e &apos;s/.*//&apos;
</code></pre><p>模式空间 — 保持空间</p>
<pre><code>#seq 100 |sed -n &apos;n;p&apos;
#sed -n &apos;n;p&apos;

在模式空间单行进行处理，在执行命令时sed -n 
&apos;n;p&apos;时 模式空间 已进入1数字， -n 所以不打印
不输出屏幕，‘n;p’n为匹配到的下一行覆盖模式
空间的1数字并打印输出到屏幕后，模式空间转为
为空，执行下一条匹配的行3,3进入模式空间后3的
下一行进入模式空间进行覆盖并输出屏幕，并结束
一段操作，模式空间转为空，执行下一条，直到循
环结束；
</code></pre><p>hold space 保持空间</p>
<pre><code>#sed &apos;1!G;h;$!d &apos; FILE
#seq 100 |sed &apos;1!G;h；$!d &apos;
倒序输出、
非第一行时追加至模式空间，模式空间覆盖至保存空间，非结尾时删除模式空间的行

#seq 100 |sed‘N；D’
N匹配的行追加
D在上一条命令执行时进行删除操作
第100没有追加所以不执行D命令

#seq 100|sed &apos;N;d&apos;
清空
#cat passwd |sed &apos;N;D&apos;
#seq 100 |sed &apos;$!N;$!D&apos;
剩两行，非结尾时追加，非结尾时执行D命令
100追加时是结尾所以不执行D命令就不删除99行
</code></pre><p>```</p>
]]></content>
      
        
        <tags>
            
            <tag> sed </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[tar工具]]></title>
      <url>/2018/01/09/tar%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">tar：-c -f ---------(创建打包文件)</span><br><span class="line">         -v -f ----------(查看过程)</span><br><span class="line">         -t -f -----------(预览打包的文件列表)</span><br><span class="line">         -x -f ---------- (解压和解包)</span><br><span class="line">         -r -r -----------(追加)不能追加压缩文件</span><br><span class="line">压缩；</span><br><span class="line"># tar zcvf etc.tav.gz   /etc/</span><br><span class="line"># tar jcvf etc.tar.bz2  /etc/                 </span><br><span class="line"># tar Jcvf etc.tar.xz    /etc/</span><br><span class="line">压缩 ; -T, -X</span><br><span class="line"># tar Jcvf   file.tar.xz -T(file.txz)   list.txt --------将list.txt里文件目录分别压缩到file.txz里。</span><br><span class="line"># tar Jcvf   file.tar.xz -X  /etc/....                          排除/etc/目录下的指定列表，进行压缩。</span><br><span class="line">分割（大的tar文件）</span><br><span class="line"># split       -b       size     -d       file-name      prefix-name</span><br><span class="line">-b---分割的块的数量  </span><br><span class="line">size---分割的块的大小  </span><br><span class="line">-d---分割后的文件尾部排序数字  </span><br><span class="line">file-name---指定的分割文件  </span><br><span class="line">prefix-name---定义分割后的文件、前缀名称</span><br><span class="line"># split -b 1M etc.tar.bz2  etcsplit        后缀为aa、ab、ac......</span><br><span class="line"># split -d 1M etc.tar.bz2  etcsplit        后缀为00、01、02......</span><br><span class="line">合并(将分割的文件合并到一处)</span><br><span class="line"># cat etcsplit0* &gt; etc2.tar.bz2------ 要与源文件后缀一样</span><br><span class="line">解压</span><br><span class="line"># tar xvf etc.tar.xz      -C     /root/</span><br><span class="line"># tar xvf etc.tar.bz 2  -C     /root/</span><br><span class="line"># tar xvf etc.tar.gz     -C     /root/</span><br><span class="line">解压时，tar可以用tar  xvf解压三种以xz、bz2、gz后缀的压缩文件；</span><br><span class="line">- 大C为解压到指定目录时使用，解压到当前目录时不用加-大C。</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> tar </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[创建RAID设备]]></title>
      <url>/2018/01/09/%E5%88%9B%E5%BB%BARAID%E8%AE%BE%E5%A4%87/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">添加20、30、40、50G磁盘</span><br><span class="line">#fdisk /dev/sda</span><br><span class="line">#mdadm -C /dev/md0 -n3 -l5 -x1 /dev/sd&#123;a6,b,c1,d1&#125;</span><br><span class="line">#cat /proc/mdstat </span><br><span class="line">#which -n1 cat /proc/mdstat</span><br><span class="line">#mdadm -Ds /dev/md0</span><br><span class="line">#mdadm -Ds /dev/md0 &gt;/etc/mdadm.conf</span><br><span class="line">#mkdir /mnt/raid</span><br><span class="line">#mount /dev/md0 /mnt/raid</span><br><span class="line">#cd /mnt/raid</span><br><span class="line">#cp /etc/fstab /mnt/raid/f1</span><br><span class="line">#cp /etc/fstab /mnt/riad/f2</span><br><span class="line">#cp /var/log /mnt/riad/bigfile</span><br><span class="line">#cat f3</span><br><span class="line">#vim /etc/fstab</span><br><span class="line">#cat f1</span><br><span class="line">#lsblk</span><br><span class="line">#blkid</span><br><span class="line">#mdadm -D /dev/md0</span><br><span class="line">#mdadm /dev/md0 -f /dev/sdb1</span><br><span class="line">#mdadm /dev/md0 -r /dev/sdb1</span><br><span class="line">#mdadm /dev/md0 -a /dev/sdd1</span><br><span class="line">#mdadm -G /dev/md0 -a /dev/sdd2</span><br><span class="line">#mdadm /dev/md0 -a /dev/sdd2</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-86b9ff56e2c7600a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加完成.png"><br>]</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-07c630ef722065c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建主分区.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a3f87d9f4f39da14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="文件系统类型.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-922a2af95cbf1464.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="分区完成.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7ac4b449902eca73.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建raid5.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-264adc8d036d9cc3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看详细信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0301fcb624e9e0f0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看进程.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4625aa0815d5a5a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建完成.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-66d7fd57721795f6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建配置文件.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a56e6a2400598203.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="格式化.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-fc757d4fc076d86d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="编写挂载路径.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-47b9e81afd1b3c81.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="保存挂在路径，创建挂载点.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-76f809340f64fb52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-38de0a412d6c06fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="sdc1模拟故障.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ddde17f720a937de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自动修复状态.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8c5a33799513506d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="修复状态.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-d3e0d0e54d02fb23.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="自动修复完成，sdc1无法使用.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-819e3b82a69d1615.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="移除并查看.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e3f2727078fc56a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="QQ截图20170622100410.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-556b66ee3f9a5c5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="移除后，查看挂载信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0030e7a61d4a7013.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看RAID信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e838443eab2a0523.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看性能.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6d9fd3754da3589b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加sdb.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-91e78af3f6b6e592.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="移除后的状态.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-947bae5b16d73514.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加磁盘.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c2173dab33b8c38d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看添加状态.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-47cbda8b92e603bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加完成.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-72194fa080a30b8d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加备用磁盘.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4391c667fcc39641.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加备用完成.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-916304b6217e6677.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="分区sdd2.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-452a30daa7f349e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="未能同步.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-9f72a9143d9b40ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="同步.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6cf202455f5326c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-45578825126d94b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加sdd2进度.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-82f28eb536e4cdb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加sdd2完成.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-929abdb4aecb2466.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加备用sdd2.png"></p>
]]></content>
      
        
        <tags>
            
            <tag> RAID </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[逻辑卷及扩展逻辑卷]]></title>
      <url>/2018/01/08/%E9%80%BB%E8%BE%91%E5%8D%B7%E5%8F%8A%E6%89%A9%E5%B1%95%E9%80%BB%E8%BE%91%E5%8D%B7/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">准备好磁盘空间，添加/dev/sda、/dev/sde 、 /dev/sdf，将磁盘分区，/dev/sda7、/dev/sde1，留一个磁盘、/dev/sdf;</span><br></pre></td></tr></table></figure>
<h6 id="创建逻辑卷"><a href="#创建逻辑卷" class="headerlink" title="创建逻辑卷"></a>创建逻辑卷</h6><pre><code>1、创建物理卷
# pvcreate /dev/sd{a7,e1}
#pvs
#pvdisplay
2、创建卷组
#vgcreate  -s 16M vg0 /dev/sd{a7,e1}
#vgs
#vgdisplay
3、创建逻辑卷
#lvcreate -n lv0 -l  100% vg0
#lvs
#lvdisplay
#ll /dev/vg0/lv0
#ll /dev/mapper/vg0-lv0
4、配置文件
#vim /etc/fstab
5、创建文件夹
#mkdir /mnt/lv0
6、挂载逻辑卷
#mount /dev/vg0/lg0 /mnt/lv0
7、查看挂载点，是否已经挂载
#df -h
#lvdisplay
8、拷贝文件到逻辑卷上
#cp /etc/fstab /mnt/lv0
#cp /var/log/messages /mnt/lv0
9、查看文件
#cd /mnt/lv0
#cat /fstab
10、测速
dd if=/dev/zero of=/mnt/lv0/bigfile bs=1M count=1024
dd if=/mnt/lv0/bingfile of=/dev/null 
创建完成；
</code></pre><p>######扩展逻辑卷</p>
<pre><code>1、扩展物理卷
#pvcreate /dev/sdf
#pvs
#pvdisplay
2、添加卷组
#vgcreate vg0 /dev/sdf
#vgdisplay
#vgs
#df -h
3、扩展逻辑卷
#lvextent -l +1000 /dev/vg0/lv0
#lvdisplay
#df -h
4、同步文件系统
#resize2fs /dev/vg0/lv0
#df -h
#lvdisplay
5、查看文件系统及逻辑卷大小,将剩余的空间全部使用
#lvextend -r -l +100%free /dev/vg0/lv0
#df -h
#lvdisplay
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/6132998-0077cbef58b68fac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加sde,sdf磁盘分区.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1e4f1b97c35b0e13.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建物理磁盘，查看信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7cdad316b49a5df6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建卷组，查看信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-162be295c56ff373.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建逻辑卷，查看信息.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-b9446ed0ef80a6c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="路径.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-3b2ecef5df59d047.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="两个软连接.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-9c2edebc0ec1ae1d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建文件系统.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a9d8925d3ff17a6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看文件系统.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-85d0c552a3c4bae8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加配置文件.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-de46760ba447bd1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建文件夹，挂载，查看.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ca52689288706c3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="测速.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-610bdde12c6dec86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="扩展逻辑分区1.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6b6a477ef643da0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看详情2.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-598c442b61b2cd21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加到逻辑卷3.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-d904016a7b7ff38d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看逻辑卷磁盘空间.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-20402eeb54b7e2f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="扩展逻辑卷查看是否同步.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-f732a4bb9c511571.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="同步文件系统.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-3081b9aade12a93f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看 逻辑卷剩余空间.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-471b192407b008fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="使用逻辑卷剩余空间，扩展完成.png"></p>
]]></content>
      
        
        <tags>
            
            <tag> 逻辑卷 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[vsftpd]]></title>
      <url>/2018/01/08/vsftpd/</url>
      <content type="html"><![CDATA[<h6 id="Centos7-3安装Vsftpd服务；"><a href="#Centos7-3安装Vsftpd服务；" class="headerlink" title="Centos7.3安装Vsftpd服务；"></a>Centos7.3安装Vsftpd服务；</h6><pre><code>1、准备好yum源路径、检查光盘是否挂载及网络状态；
2、用rpm安装vsftpd服务程序包；
3、查找启动vsftpd服务配置文件(vsftpd.service);
4、查看vftpd网络端口是否开启；
5、#systemctl start vsftpd.service启动vsftpd服务；
6、查看vftpd网络端口是否开启；
7、#systemctl enable vsftpd启动下次开启依然启动功能；
8、#systemctl is-enabled vsftpd检查上一条命令是否生效；
9、查看共享文件夹/var/ftp;
10、#iptables -vnL查看防火墙是否开启状态；
11、#systemctl stop firewalld.service关闭防火墙;
12、#iptables -vnL查看防火墙是否开启状态；
13、#systemctl disable firewalld.service下次启动虚拟机防火墙依然在关闭状态；
14、#在/var/ftp/pub/目录下建一个ftp.txt文件；
15、关闭防火前后进入ftp站点，查看是否能进入；
16、配置yum原路径，挂在盆地光盘；
17、将Centos7光盘拷贝到/var/ftp/pub/7/目录下；
18、将Centos6光盘拷贝到/var/ftp/pub/6/目录下；
19、访问ftp站点，是否成功；
20、安装Vsftpd、完成；
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/6132998-6b8b2b1cea482c07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看光盘是否挂载"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8aadd2e27d0b665c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="用rpm安装vsftpd文件包"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-bc643c93a3990de0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查找启动vsftpd服务配置文件"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a9b4347ba4bf2eaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看vftpd网络端口启动前、启动后，是否开启"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7108769dbf011b47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="启动vsftpd服务"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-dd77697428eebccf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看vsftpd共享目录位置"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a13dc2131a995069.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看防火墙状态，是否开启"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-883fec34f1fff53c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="停止防火墙服务及查看防火墙状态"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-da99e981dd9771fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="禁用防火墙"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c657c3954a7d9f6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="在/var/ftp/pub/目录下创建一个ftp.txt文档"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-aa9f7e4476b6dd4b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="网页窗口输入ftp://192.168.239.131，查看是否能进入ftp站点 "></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-eb57acf3128bd35f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="配置yum原路径"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-262c0ef677ccdeac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="将Centos7光盘拷贝到/var/ftp/pub/7/目录下"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1448575102d90c2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="进入ftp查看"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4826256023a0ba2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="安装完成"></p>
<h6 id="Centos6-9安装Vsftpd-跟上述类似；"><a href="#Centos6-9安装Vsftpd-跟上述类似；" class="headerlink" title="Centos6.9安装Vsftpd,跟上述类似；"></a>Centos6.9安装Vsftpd,跟上述类似；</h6><pre><code>/etc/rc.d/init.d/vsftpd 服务脚本名
#netstat -ntl查看端口;
/etc/rc.d/init.d/vsftpd启用vsftpd服务;
#service vsftpd start启用vsftpd服务;
#service iptables stop马上禁用防火墙;
#chkconfig iptables off下次依然关闭防火墙;
将/misc/cd/里的文件拷贝/var/ftp/pub/6..7;
在六七的当前目录下，cp /misc/cd/repo....  .  -r;
拷贝完后用yum repolist 命令查看包文件列表属性文件;
</code></pre>]]></content>
      
        
        <tags>
            
            <tag> 共享文件系统，vsftpd </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[rpm包管理工具，Lib64库文件修复]]></title>
      <url>/2018/01/08/rpm%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%EF%BC%8CLib64%E5%BA%93%E6%96%87%E4%BB%B6%E4%BF%AE%E5%A4%8D/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、软件包基础;</span><br><span class="line">2、rpm包管理;</span><br><span class="line">3、移动lib64库文件修复过程：</span><br><span class="line">4、卸载内核修复过程</span><br></pre></td></tr></table></figure>
<ul>
<li><p>1、软件包基础</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">软件运行与编译：</span><br><span class="line">ABI:应用程序二进制接口</span><br><span class="line">API:应用程序编程接口</span><br><span class="line">静态、动态链接</span><br></pre></td></tr></table></figure>
</li>
<li><p>二进制应用程序的组成部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">二进制文件、库文件、配置文件、帮助文件</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>二进制文件<br><img src="http://upload-images.jianshu.io/upload_images/6132998-1adda484d623a0f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ls二进制文件，依赖于库文件，查看ls二进制文件which ls--,file /bin/ls"><br>库文件<br><img src="http://upload-images.jianshu.io/upload_images/6132998-8139b3425118d34a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lib64库文件"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">配置文件</span><br><span class="line">有些服务、软件较大，复杂的程序需要通过配置文件来执行实现特性、通过修改配置文件修改来影响程序的运行。(/etc/...)</span><br><span class="line"></span><br><span class="line">帮助文件</span><br><span class="line">……</span><br></pre></td></tr></table></figure>
<ul>
<li>包命名;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">源代码：name-VERSION.tar.gz|bz2|xz</span><br><span class="line">VERSION版本:major、minor、release发行</span><br><span class="line">rmp包命名方式：</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ec4369dae01b0169.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="包名称、版本号、编译者后加注、cpu架构"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">包分类和拆包</span><br><span class="line">Application-VERSION-ARCH.rpm:  主包</span><br><span class="line">Application-devel-VERSION-ARCH.rpm  开发子包（开发类放置devel）</span><br><span class="line">Application-utils-VERSION-ARHC.rpm  其它子包（应用相关放置utils）</span><br><span class="line">Application-libs-VERSION-ARHC.rpm  其它（与库相关放置libs）</span><br><span class="line">包之间：可存在依赖关系，甚至循环关系</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解决依赖包管理工具：</span><br><span class="line">yum: rpm包管理器的前段工具</span><br><span class="line">apt-get:deb包管理器前端工具</span><br><span class="line">zypper:suse上的rpm前端管理工具</span><br><span class="line">dnf:Fedora 18+ rmp包管理器前端管理工具</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-00d3d718392aa193.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="rpm.安装包依赖性。"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看二进制程序所依赖的库文件</span><br><span class="line">ldd /path/to/binar_FILE</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-bc1e0bf0758cb571.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看ls所依赖的库文件ldd命令"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">管理及查看本机装载的库文件</span><br><span class="line">ldconfing</span><br><span class="line">/sbin/ldconfig -p:显示本机已缓存的所有可用库文件名及文件路径映射关系</span><br><span class="line">配置路径：/etc/ld.so.conf,/etc/ld.so.conf.d/*.conf</span><br><span class="line">缓存文件：/etc/ld.so.cache</span><br><span class="line">/etc/ld.so.conf.d/*.conf---配置文件，当使用第三方软件，库文件加载，指定方在一个目录里，需要单独编一个配置文件、将路径编写到配置文件。</span><br><span class="line">保存后需执行#ldconfig ，读取内容后生效。</span><br><span class="line">ldconfig -p 可以查看已经加载到内存的库文件路径，库文件信息。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">包管理器</span><br><span class="line">debian；deb文件，dpkg包管理器</span><br><span class="line">redhat；rpm文件，rpm包管理器</span><br><span class="line"> redhat Package Manager(rpm)</span><br><span class="line">内核版本一般用偶数版本，奇数版本不稳定测试开发阶段。</span><br><span class="line">1、包文件的组成</span><br><span class="line">文件内容（文件列表、路径，元数据，一些脚本）</span><br><span class="line">RPM包内的文件</span><br><span class="line">RPM的元数据，</span><br><span class="line">安装或卸载时运行的脚本</span><br><span class="line">2、数据库（公共）：/var/lib/rpm（安装好的包的信息）</span><br><span class="line">程序包名称及版本</span><br><span class="line">依赖关系</span><br><span class="line">功能说明</span><br><span class="line">包安装后生成的文件路径及效验码信息</span><br><span class="line">程序包的来源</span><br><span class="line">管理程序包的方式</span><br><span class="line">使用包管理器：rpm</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-b96212c1d29cc0c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="数据库--安装包的信息。不能随意删除，删除将不能管理包。"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-3b62e5794591bfc4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="rpm命令"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用前端工具：yum,dnf</span><br><span class="line">获取程序包的途径:</span><br><span class="line">1、系统发行版的光盘或官方的服务器：</span><br><span class="line">Centos镜像：</span><br><span class="line">https://www.centos.org/download/</span><br><span class="line">http://mirrors.aliyun.com</span><br><span class="line">http://mirrors.sohu.com</span><br><span class="line">http://mirrors.163.com</span><br><span class="line">2、项目官方站点</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a997cd061256b61f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="官方站点"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-fe85cbc2bab0ef19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="？"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7031911550ba2fe6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="md5 效验"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-9be26cd27b761a69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="md5 效验，输入命令。"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3、第三方组织（软件）</span><br><span class="line">光盘里不带的软件放到epel源里（官网），企业版额外的包。</span><br><span class="line">搜索引擎 ：专门搜索安装包；</span><br><span class="line">http://pkgs.org</span><br><span class="line">http://rpmfind.net</span><br><span class="line">http://rpm.pbone.net</span><br><span class="line">https://sourceforge.net/</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">4、自己制作</span><br><span class="line">rpmbuild、FPM工具自作安装包。</span><br><span class="line"></span><br><span class="line">###2、rpm包管理</span><br><span class="line">Centos系统上使用rpm命令管理程序包：</span><br><span class="line">rpm  [option..]  file</span><br><span class="line">       -i  --install ---  安装</span><br><span class="line">      -v或vv(更详细)---  显示过程</span><br><span class="line">      -h--------------- 进度  </span><br><span class="line">      -e--------------- 卸载</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-584768a6de7ce64f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="卸载时只需写包名"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[install-options]</span><br><span class="line">--test:测试安装，但不真正执行安装，即dry run模式、模拟安装</span><br><span class="line">--nodeps:忽落依赖关系（安装时，后续依赖的包安装、否则无法运行）A依赖于B 安装顺序，先安装B后安装A。卸载时，先卸载A，后卸载B。</span><br><span class="line">--replacepkgs | replacefiles 替换、覆盖安装</span><br><span class="line">--oldpackage ：降级</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-faf8441535b9bd69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="降级使用，内核并存"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /boot/grup/grup.conf 执行命令，可以查看当前Linux运行那个内核；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8a8a460125131c0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看运行内核"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-35356da0c3c0bedb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="删除内核"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除以后查看当前运行内核是还是还是删除的在运行，内和放在内存和磁盘两个地方，删除的是磁盘里的。内核还在内存中，才重启后才会消失。（uname -r）</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> rpm &#123;-U|--upgrade&#125; [install-options]  PACKAGE_FILE ...</span><br><span class="line">安装有旧版程序包，则“升级”</span><br><span class="line">如果不存在旧版程序包，则“安装”</span><br><span class="line">升级会覆盖旧内核，生产中最好不使用升级，使用i安装。</span><br><span class="line"> rpm &#123;-F|--freshen&#125; [install-options]  PACKAGE_FILE ...</span><br><span class="line">安装有旧版程序包，则“升级”</span><br><span class="line">如果不存在旧版程序包，则不执行升级操作</span><br><span class="line">--force-----强制安装，只能在安装升级时候用，卸载时不能使用。</span><br><span class="line">rpm -e kernel --nodeps(不检查相关性 忽略依赖关系 不检查依赖性关系)----卸载内核</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--nosignature:不检查来源合法性</span><br><span class="line">--nodigest:不检查包完整性</span><br><span class="line">-noscriptts:不执行程序脚本</span><br><span class="line">%pre:安装前脚本-----nopre</span><br><span class="line">%post:安装后脚本----nopst</span><br><span class="line">%preun:卸载前脚本---nopreun</span><br><span class="line">%postun: 卸载猴脚本---nopostun</span><br></pre></td></tr></table></figure>
<ul>
<li>（1）不要对内核做升级操作：Linux支持多内核版本并存，因此，可以对其直接安装新版本内核。</li>
<li><p>（2）如果源程序包的配置文件安装后增被修改，升级时，新版本的提供的同一个配置文件并不会直接覆盖老版本的配置文件，而把新版本的文件重命名（FILENAME.RPMNEW）后保留。</p>
</li>
<li><p>包查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm&#123;-p| --query&#125;[select-options][query-option]</span><br><span class="line">rpm &#123; - p |——查询&#125;[选项][查询选项]</span><br><span class="line">rpm -p 【包名】</span><br><span class="line">[select-options]</span><br><span class="line">-a；所有包  ----加上管道grep可以模糊搜索</span><br></pre></td></tr></table></figure>
</li>
<li><p>-f:查看指定的文件有那个程序包安生成，来自哪个安装包。</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-55451353f6e88c55.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="用rm删除后可以用rpm -pf查询到文件生成的安装包"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7bab44d450ffd130.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="磁盘上是否每一个文件都来自安装包"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不是每一个文件都来自安装包。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-p rpmfile；针对尚未安装的程序包文件做查询操作</span><br><span class="line"></span><br><span class="line">有那个包所提供</span><br><span class="line">--whatprovides CAPABILITY;查询指定的CAPABILITY背那个包所依赖</span><br><span class="line">--provides:列出指定的程序包所提供的CAPABILITY[性能、能力]</span><br><span class="line">-R：查看指定的程序包所依赖的CAPABILITY</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-683fbc6baf746577.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="指定的能力所依赖的包、包具有的能力、指定的包所依赖的能力"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8eab7888c5457634.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="bash所依赖的库"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rmp2cpio（rpm to cpio） 包文件|cpio -itv 预览包内文件</span><br><span class="line">rpm2cpio (rpm to cpio) 包文件|cpio -id &quot;*.conf&quot; 释放包内文件</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a35b858177b839fc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="rpm2copi命令预览、解包、解压缩进行安装、需注意文件元数据(权限之类)"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">【query-options】</span><br><span class="line">--changelog:查寻rpm包的changelog[变更日志，版本历史]</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-cc7de4e0f594b89b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="bash包更新历史查询"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">没有安装tree包,但可以查询tree安装列表，</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2b34e1def2697869.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="两种查看tree安装包列表"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-c:查询程序的配置文件</span><br><span class="line">-d:查询程序的文档</span><br><span class="line">-i:information</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-cd0e67cffde0d4c7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查询文件列表信息"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-l:查询指定的程序安装后生成的所有文件</span><br><span class="line">--scripts:程序包自带的脚本</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7cf63c7a6ab4132f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查询包相关的脚本"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-qi packege, -qf file, -qc package, -ql package , -qd package</span><br><span class="line"></span><br><span class="line">-qpi package_file , -qpl package_file</span><br><span class="line">-qa</span><br><span class="line">包卸载：</span><br><span class="line">rpm &#123;-e| --erase&#125;[--allmatches][--nodeps][--noscripts][--notriggers][--test]package_name..</span><br><span class="line"></span><br><span class="line">rpm &#123; - e |——消除&#125;[——allmatches][——nodeps][——noscript][——被重置为notrigger][——测试]package_name . .</span><br><span class="line"></span><br><span class="line">包效验（查看属性变化）</span><br><span class="line">rpm &#123;-V|--verify&#125; [select-options] [verify-options]</span><br><span class="line">S file Size differs</span><br><span class="line">M Mode differs (includes permissions and file type)</span><br><span class="line">5 digest (formerly MD5 sum) differs</span><br><span class="line">D Device major/minor number mismatch</span><br><span class="line">L readLink(2) path mismatch</span><br><span class="line">U User ownership differs</span><br><span class="line">G Group ownership differs</span><br><span class="line">T mTime differs</span><br><span class="line">P capabilities differ</span><br><span class="line">rpm &#123; - v |——验证&#125;[选项][verify-options]</span><br><span class="line">年代文件大小不同</span><br><span class="line">M模式不同(包括权限和文件类型)</span><br><span class="line">5摘要(前MD5和)不同</span><br><span class="line">D设备/小数字不匹配</span><br><span class="line">L指向(2)路径不匹配</span><br><span class="line">U用户拥有不同</span><br><span class="line">G组所有权不同</span><br><span class="line">T mTime不同</span><br><span class="line">P能力不同</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-85566ff6f435894f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="定期查看指定文件变化"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">也可以查看所有文件属性变化，(-va）命令</span><br></pre></td></tr></table></figure></p>
<ul>
<li>安装软件包效验<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">包来源合法性验证及完整性验证</span><br><span class="line">完整性验证：SHA256</span><br><span class="line">来晕啊合法性验证：RSA</span><br><span class="line">公钥加密</span><br><span class="line">对称加密：加密,解密使用同一个秘钥</span><br><span class="line">非对称加密：密钥是成对儿的</span><br><span class="line">pablic key:公钥，公开所有人</span><br><span class="line">secret key:私钥，不能公开</span><br><span class="line">导入所需要公钥</span><br><span class="line">rpm -k|checksig rpmfile 检查包的完整性和签名</span><br><span class="line">rpm--import /etc/pki/rpm-gpg/rpm-gpg-key-Centos-7</span><br><span class="line">Centos7发行版光盘提供：RPM-GPG-KEY-Centos7</span><br><span class="line">rpm -qa &quot;gpg -pubkey*&quot;</span><br><span class="line">查看是否是厂家出厂原安装包，-K</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8f316340d829ddcf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="缺少检查工具，md5 not ok"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ff6ead52ab5d2205.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="导入密钥，检测,md5 ok"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">卸载蜜钥，查询装好的蜜钥</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8d67079fe7a57641.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查询蜜钥、卸载"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-fa1307ca0d3c025f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="光盘与磁盘的蜜钥位置"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-72b2d979727ea272.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="消除报警，导入蜜钥"></p>
<ul>
<li><p>rpm数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">数据库重建：</span><br><span class="line">/var/lib/rpm</span><br><span class="line">rpm&#123;--initdb|--rebuilddb&#125;</span><br><span class="line">initdb:初始化</span><br><span class="line">如果事先不存在数据库，新建之</span><br><span class="line">否则，不执行任何操作</span><br><span class="line">rebuilddb；重建已安装的包头的数据库索引目录</span><br><span class="line">！数据库初始化及重建数据都为空，没有意义。</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、库文件移动后的修复过程<br><img src="http://upload-images.jianshu.io/upload_images/6132998-f82fc91abebf98b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="lib64，如ls、cat、bc、cp……通用lib64库，节约空间。不能随意移动库文件否则将无法运用外部命令"></p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-f9eeff69bca12e89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="用mv命令移动库文件后，无法重新启动系统。centos6无法运用图形界面"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">不使用快照的情况下，修复移除lib64库文件导致系统无法启动故障，在VMware下的修复方法。</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0599d6b0f985a32f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="重新启动客户机，用光盘进救援模式"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户机重新启动后，运行光盘，当进度条走动的瞬间按一次Esc键，进入选项界面。（只能按一次，不能重复）</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-bc94d398134e695b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="选择第三项"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c90d71e50ec42636.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="选择第三项，救援模式"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-dc70351d77e096b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="选择语言，默认即可"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-231a20153ad44f3a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="不需要配置网络，选择NO"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-461c3e1c73333564.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="继续 只读 忽略 高级"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-81cc7f009ec8c90e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="初始安装系统时挂载点为根、救援模式时挂载点为/mnt/sysimares."></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-b298523447631eab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="进行下一步，回车得到一个shell，打开字符界面，更改根的位置。当前根位置为/mnt/sysimages,将其改为/，需在字符界面下执行命令 #chroot /mnt/sysmages."></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-9e94ce46a9f2a9cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="您的系统安装在/mn/sysimage目录下"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-03656c0411a560b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="开shell,进入字符界面"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0939d91a8d3a9ec5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="输入#pwd命令显示当前为“/”，“/”为伪根、真正的根为/mnt/sysimage/。将lib64库文件移动还原，执行命令#chroot /mnt/sysimages可以切根“/”。"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-66f411b75f9d8f56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="将库文件还原到lib64下，输入exit 退出"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1da5e541f9d4d9e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="重启，复原。"></p>
<ul>
<li><p>centos7移动lib64库文件，并进行修复。（类似centos6操作）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、重新启动客户机</span><br><span class="line">2、光盘引导进入</span><br><span class="line">3、按ESC键进入</span><br><span class="line">4、选择第三项，检测排错</span><br><span class="line">5、选择第二项，进入救援模式</span><br><span class="line">6、选择1回车</span><br><span class="line">7、c继续</span><br><span class="line">8、回车开启shell</span><br><span class="line">9、不能切根，移动回复lib64库文件</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、卸载内核后，Linux没有启动菜单项，系统无法启动。修复过程；</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-fc7881c0292ee63f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="没有Linux启动项"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">进入救援模式</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2db0f7a041d04faa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="挂在光盘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-838ced63e8a8c7c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="安装内核"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6dd96691fcee129b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="切换到根"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-d88abadd1e7a7f52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="强行安装内核"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6feec0affdf1f56d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="xx"></p>
]]></content>
      
        
        <tags>
            
            <tag> rpm </tag>
            
            <tag> lib64库文件，内核修复 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[修复MBR分区]]></title>
      <url>/2018/01/08/%E4%BF%AE%E6%94%B9MBR%E5%88%86%E5%8C%BA/</url>
      <content type="html"><![CDATA[<pre><code>1、准备工作将/dev/sda磁盘的MBR分区备份到、root目录下mbr文件   中，备份centos6整个虚拟机；
[root@centos6 ~]# dd if=/dev/sda of=mbr bs=1 count=512;
[root@centos6 ~]# hexdump -C -n 512 /dev/sda
[root@centos6 ~]# hexdump -C -n 512 mbr
2、拷贝完成后查看mbr中内容是否齐全；
3、清除/dev/sda、磁盘的MBR分区512字节；
[root@centos6 ~]# dd if=/dev/zero of=/dev/sda bs=1 count=512
[root@centos6 ~]# hexdump -C -n 512 /dev/sda
4、查看/dev/sda磁盘512字节有无变化；
5、重新启动虚拟机，看是否能启用：
[root@centos6 ~]# reboot
6、救援模式无法修复；
7、无法修复后，启用备份文件夹中的centos6;
8、成功启动centos6后，查看磁盘分布：
[root@centos6 ~]# lsblk
[root@centos6 ~]# ls /dev/sd*
[root@centos6 ~]# blkid
[root@centos6 ~]# cat /proc/partitions
9、从破损的虚拟机上找到破损的磁盘路径及文件；
# 查找时间上最近的虚拟磁盘文件；
10、将破损的虚拟机磁盘挂载到已开启centos6上;
# 添加硬盘、选择现有虚拟磁盘选项、浏览、挂载；
11、重新启动centos6；
12、找到破损磁盘名称及centos6磁盘名称；
13、查看centos6磁盘和破损磁盘分区MBR；
[root@centos6 ~]# lsblk
[root@centos6 ~]# blkid
14、用centos6磁盘来修复破损的磁盘；
[root@centos6 ~]# dd if=/dev/sda of=/dev/sdb bs=1 count=512
15、关闭centos6，卸载修复的磁盘；
[root@centos6 ~]# init 0
16、开启已修复的centos6，看是否能够正常运行；
17、移除复制备份的centos6；
18、修复完成；
</code></pre><p><img src="http://upload-images.jianshu.io/upload_images/6132998-b98f6d3db9bc80d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Centos6"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-dcad0d2fb69be177.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="将/dev/sda的MBR分区备份到mbr文件中"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4f0c7fa194a185a8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="破坏/dev/sda"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-76112f24595a7a9e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看MPR分区二进制文件"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c0d79cca6a561f68.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看磁盘状态"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-754a12716017e3c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="
![启用复制备份的Centos6](http://upload-images.jianshu.io/upload_images/6132998-b07c031fbd698a9a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1f67ca56c781a0d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看磁盘状态及二进制mpr文件"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-868a3fd44fc382bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="添加破坏的虚拟机磁盘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-f767b782448f32a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="浏览选择破损的虚拟机光盘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2a43b82170e2fe04.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="选择最近时间最大的虚拟机光盘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4ea526028a7179ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="没有显示破坏的虚拟机磁盘重新启动虚拟机"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8bef0a4442cb195b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="重启Centos6"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2693403153d0694f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="查看磁盘分区"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-d2ea7d995abc4a98.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="修复破损的虚拟机磁盘"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2ae1943f55e29f64.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="关闭centos6"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-5f5f3083627220f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="修复完成后，正常启动"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1767fe513f9ef2c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="结构图"></p>
<p>######MBR<br>    MBR<br>    0 磁道0 扇区：512bytes<br>    446bytes: boot loader<br>    64bytes ：分区表<br>    16bytes:  标识一个分区<br>    2bytes: 55AA</p>
<pre><code>破坏boot loader引导启动程序；
[root@centos6 ~]# dd if=/dev/zero of=/dev/sda bs=1 count=446
[root@centos6 ~]# dd if=mbr of=/dev/sda bs=1 count=446
破坏分区表及修复；
[root@centos6 ~]# dd if=/dev/zero of=/dev/sda bs=1 count=64 skip=446 seek=446
[root@centos6 ~]# dd if=mbr of=/dev/sda bs=1 count=64 skip=446 seek=446
破坏尾标55AA及修复；
[root@centos6 ~]# dd if=/dev/zero of=/dev/sda bs=1 chount=2 skip=510 seek=510
[root@centos6 ~]# dd if=mbr of=/dev/sda bs=1 count=2 skip=510 seek=510
</code></pre>]]></content>
      
        
        <tags>
            
            <tag> 修复MBR分区，故障处理 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Centos6,7修改密码]]></title>
      <url>/2018/01/08/Centos6%EF%BC%8C7%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81/</url>
      <content type="html"><![CDATA[<p><strong>更改roor管理员UID为非零时，centos6、centos7无法正常启动。重启centos6、centos7时系统运行不一样。</strong></p>
<p><strong>一、Centos6</strong></p>
<p>1、centos6用户root地址更改为2000，ctrl+x/y进行保存。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7c130da7c17a569b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>2、更改root用户（UID)地址为2000，进行保存。在SecureCRT上从新开启centos6端口，无法连接centos6。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e33b20b8ee16b228.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>3、在VMwere上切换centos6新端口时，用户无法登入。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c59fc3be995db516.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>4、用户无法登入与链接，系统处于故障状态。重启VMwere上的centos6→快速点击A键，进入编辑界面。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-047c7100cf257e07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>5、输入命令init=/bin/bash回车。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-02bafa043649bd8e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>6、输入命令mount -o remount,rw /  回车。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e2843699c403585f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>7、输入命令nano /etc/passwd，更改root地址UID为0，ctrl+x/y进行保存。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1996b32850346b7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-b3f71a61489de884.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>8、重新启动centos6.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ebdc9c58dbfcb8c4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><strong>二、Centos7</strong></p>
<p>1、centos7用户root地址更改为2000，ctrl+x/y进行保存。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-05c1adbbc1f24212.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>2、root用户无法登，系统处于故障状态。重启VMwere上的centos7→快速点击E键，进入编辑界面。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-5059bea0bd2a2c3d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>3、输入命令init=/bin/bash、按ctrl+x键进行下一步。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-79eb6e3072e39c19.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>4、输入命令mount -o remount,rw /  回车。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1b18a084fb8502fa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>5、输入命令nano /etc/passwd。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-f786db0f75eca9d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>6、更改root地址UID为0，ctrl+x/y进行保存。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-5b86ad56ca0311ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>7、重新启动centos7。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-709ee43b30f30585.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>Centos6重新启动成功,修复完成。</p>
]]></content>
      
        
        <tags>
            
            <tag> centos6 </tag>
            
            <tag> 7修改密码，故障修复 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[vim编辑器]]></title>
      <url>/2018/01/08/vim%E7%BC%96%E8%BE%91%E5%99%A8/</url>
      <content type="html"><![CDATA[<h4 id="vim的三种主要模式；"><a href="#vim的三种主要模式；" class="headerlink" title="vim的三种主要模式；"></a>vim的三种主要模式；</h4><p>命令模式、插入模式、扩展模式</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6871e6d74f94b805.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><strong>1、终端输入</strong> →  <strong>命令模式：</strong></p>
<p>vim /option/… 进入命令模式，光标默认行首。</p>
<p>vim +n /option/…进入命令模式，光标锁定第n行、行首。</p>
<p>vim +/^… /option/…进入命令模式，光标锁定已选定的第一个字符为行首。</p>
<p>vim + /option/…进入命令模式，光标锁定段尾行的第一个字符为行首。</p>
<p><strong>2、命令模式  </strong>→  <strong>插入模式：</strong></p>
<p>i：进入插入模式，光标位置，进行编辑。</p>
<p>a：进入插入模式，光标后一位，进行编辑。</p>
<p>o：进入插入模式，在光标位置下，添加一个新行。</p>
<p>I：进入插入模式，在光标所在的行首输入。</p>
<p>A：进入插入模式，在光标所在的行尾输入。</p>
<p>O：进入插入模式，在光标上一行，行首输入。</p>
<p>Esc键—–退出插入模式—–进入命令模式。</p>
<p><strong>3.1、命令模式 </strong> → <strong> 扩展模式：</strong></p>
<p>Shfit 加：键 …..进入扩展模式   ；</p>
<p>Esc、Enter键——退出扩展模式；</p>
<p><strong>3.2、终端输入</strong>→<strong>扩展模式:</strong></p>
<p>ex  /option/ :进入扩展模式</p>
<p><strong>3.3、扩展模式：</strong></p>
<p>：r————–在扩展模式下将读到文件内容输入到当前文件中。</p>
<p>：w————-在扩展模式下将当前文件内容写入另一个文件中。</p>
<p>：！————在扩展模式下输入！（command）回车，显示命令执行结果，再回车回到命令模式                        界面。</p>
<p>：r！———–在扩展模式下输入r！（command）回车，将命令内容读入到当前文件中。</p>
<p><strong>4、退出vim:</strong></p>
<p>：q ————-在没有进行修改操作时，进入扩展模式输入q退出。</p>
<p>：q! ————在操作时进行了输写修改，不想保存时进入扩展模式输入q!强行退出。</p>
<p>：wq ———–保存退出。</p>
<p>：wq!———–强制保存退出。</p>
<p>：x —————保存退出。</p>
<p>：ZZ————–在命令模式下，保存退出。</p>
<p>：ZQ————–在命令模式下，不保存退出。</p>
<h4 id="5、移动光标"><a href="#5、移动光标" class="headerlink" title="5、移动光标"></a>5、移动光标</h4><p>命令模式下移动光标；（只能在命令模式下移动光标）</p>
<p>← <strong>h 、</strong>↓ <strong>j、</strong> ↑<strong>k、</strong> →<strong> l    ：</strong>光标移动  左、下、上、右   </p>
<p>#h、#j、#k、#l、(#为数字)——执行#次命令（h、j、k、l）、移动#个字符。</p>
<p>w———-跳至下一个单词词首·。</p>
<p>W———-跳至下一个空格后单词词首。</p>
<p>b————跳至前一个单词词首.</p>
<p>B————跳至前第二个空格后词首。</p>
<p>H————跳至页首</p>
<p>M————跳至页中</p>
<p>L———— 跳至页尾</p>
<p>gg———–跳至文件首部，行首。</p>
<p>G————跳至文件尾部，行首。</p>
<p>：#———-跳至#行。</p>
<p>^————–跳至行首的第一个非空白符。</p>
<p>0（数字）–跳至行首。</p>
<p>$————–跳至行尾。</p>
<p>#G————跳至#指定行首。</p>
<p>1G、gg—–跳至第一行行首。</p>
<p>句间移动；</p>
<p>（————-跳至上一句。</p>
<p>）————-跳至下一句。</p>
<p>段落间移动；</p>
<p>{ ————-跳至上一段。</p>
<p>} ————-跳至下一段。</p>
<p>翻屏操作；</p>
<p>ctrl+B——–向首部翻屏</p>
<p>ctrl+F——–向尾部翻屏</p>
<p>ctrl+U——–向首部翻半屏</p>
<p>ctrl+D——–向尾部翻半屏</p>
<p><strong>6、命令界面操作，修改、删除、复制；</strong></p>
<p>x—————删除当前光标字符；</p>
<p>xp————-交换当前所在的字符与光标后面的字符；如：root、orot</p>
<p>~————–转换大小写；</p>
<p>J————–删除当前行的换行符；</p>
<p>r—————替换当前光标所在位置的字符；（输入的字符替换原有的字符）</p>
<p>R————–模式替换（REPLACE）</p>
<p>d($、0、^、w、b)—–删除</p>
<p>y($、0、^、w、b)——复制</p>
<p>c($、0、^、w、b)——修改</p>
<p>p——————————粘贴</p>
<p><strong>7、扩展模式，地址定界、查找、替换</strong></p>
<p>地址定界：（startpos,endpos）</p>
<h1 id="：—————————–第-行。"><a href="#：—————————–第-行。" class="headerlink" title="：—————————–第#行。"></a>：—————————–第#行。</h1><p>#，#：————————- 从左侧第#行到右侧第#行表示的行数。</p>
<p>#,+#：————————–从左侧第#行起，到加上右侧数字的行数。</p>
<p>.：——————————–当前行。</p>
<p>$：——————————-最后一行。</p>
<p>%：——————————全文，相当于1，$</p>
<p>/pat1/,/pat2/：—————–从第一次被/pat1/模式匹配到的行开始，一直到第一次被/pat2/匹配到的行结果。</p>
<p>查找  ：</p>
<p>/：（PATHERN）———–从当前光标处向文件尾部查找。</p>
<p>?：（PATHERN）———-从当前光标处向文件首部查找。</p>
<p>n、N —————————–辅助使用</p>
<p>查找并替换；</p>
<p>s：——————————–在扩展模式下完成查找替换操作。</p>
<pre><code>（s/查找模式/要替换成的内容/修饰符）
</code></pre><p>修饰符：</p>
<p>i：———————————忽略大小写</p>
<p>g:———————————–全局替换</p>
<p>多文件模式；</p>
<p>next：—————————–切换到下一个文件。</p>
<p>provious：———————–切换到上一个文件。</p>
<p>last：——————————切换到最后一个文件。</p>
<p>first：——————————切换到第一个文件。</p>
<p>wqall：—————————-保存所有文件。</p>
<p><strong>8、多窗口模式</strong></p>
<p>多文件：(vim -o a.txt b.txt……)</p>
<p>-o：——————————–水平分割</p>
<p>-O：——————————-垂直分割</p>
<p>在窗口间切换Ctrl+w,Arrow(上下左右箭头)</p>
<p>单文件；</p>
<p>Ctrl+w，s：———————水平分割</p>
<p>Ctrl+w，v：———————垂直分割</p>
<p>窗口属性定义；</p>
<p>set nu ：————————-显示行号</p>
<p>set nonu：———————–取消显示行号</p>
<p>set ai：—————————启用自动缩进功能</p>
<p>set noai：———————– 取消自动缩进功能</p>
<p>set ic：—————————忽略字符的大小写</p>
<p>set noic：————————不忽略字符的大小写</p>
<p>set sm：————————–括号匹配</p>
<p>set nosm:————————–取消括号匹配</p>
]]></content>
      
        
        <tags>
            
            <tag> vim编辑器 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Centos6半自动化安装.md]]></title>
      <url>/2018/01/08/Centos6%E5%8D%8A%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">安装kickstart包；</span><br><span class="line">启用kicstart生成应答文件（可以参考anaconda-ks.cfg）；</span><br><span class="line">准备http://172.16.0.1/centos/6网址,网络光盘；</span><br><span class="line">安装vsftpd服务，将kickstart生成的应答文件放置在ftp共享文件夹下；</span><br><span class="line">开启主机，网卡配置桥接模式；</span><br><span class="line">进入启动选项菜单，按ESC键，输入并调用应答文件；</span><br><span class="line"># linux ks=ftp://172.16.250.134/pub/centos6.cfg</span><br><span class="line">回车运行，开始安装系统；</span><br><span class="line">进入系统选项界面，并回车开启安装完成的系统；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安装kickstart 包；</span><br><span class="line">#yum -y install kickstart</span><br><span class="line">在图形界面下才支持打开；</span><br><span class="line">#system-config-start</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-a96c8470c494dcf5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">网络安装；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-dd68689cc023a580.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以给grub设置密码，防止单用户修改密码；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-00debcc6c9a0dcbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">磁盘分区；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-48e49e6602866a74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">清除mpr,不清除的话，机器上有mbr，会停在那里不运行；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-80420ca418b23f5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">网络，自动获取ip；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-54904ad82780789d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">验证方法，一般不动，基于SHA512验证；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-5da7941cca5c2cb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">防火墙，默认选择禁用SElinux；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1a97754e93f74c64.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">选择界面，初始化选项；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ebec5b30927a5666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">选择安装包组；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8106c9f4c3f30f66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">选择并写入脚本路径；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-71dc7bc4b9d22ff8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">编写脚本创建用户，yum源，设置密码；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0cd01774824f65cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">存盘退出（保存到家目录），并查看家目录确认一下；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-795d8aaf50cffd53.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">检查脚本格式；#ksvalidator  ks.cfg</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6c41b26dc63aa77f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">将应答文件ks.cfg放到ftp上；</span><br><span class="line">将ks.cfg拷贝到/var/ftp/pub/目录下；</span><br><span class="line">检查是否安装ftp服务；</span><br><span class="line">#yum info vsftpd</span><br><span class="line">#rpm ql vsftpd</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1bcb2f8e7960677b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">安装vsftp服务；</span><br><span class="line">#yum install vsftpd</span><br><span class="line">将文件拷贝到ftp共享目录下(/var/ftp/pub)；</span><br><span class="line">#cp ks.cfg /var/ftp/pub/</span><br><span class="line">启用vsftpd服务；</span><br><span class="line">#service vsftpd start</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-dad77b25e20e3491.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看防火墙是否在关闭状态；</span><br><span class="line">#iptables -nvL</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4ff2fd83ccd3cd11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">关闭防火墙；</span><br><span class="line">#service iptables stop</span><br><span class="line">#service iptebles status</span><br><span class="line">#service vsftp status</span><br><span class="line">查看共享文件；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-98d771faef3275d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">应答文件安装完成；</span><br><span class="line">调用linux应答文件启动主机；</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-4f170db6874c1136.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">点击光盘引导；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-d75842ca9e80d15c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">点击ESC键；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-48b331f2c6c49bf0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入调用应答文件；</span><br><span class="line">#linux ks=ftp://192.168.239.141/pub/centos6.cfg</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-eae3e264a35af500.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主机使用桥接模式；</span><br><span class="line">使用网络光盘；http://172.16.0.1/centos/6</span><br><span class="line">仅主机模式下无法获取地址；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-0f607581b7acf6e3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">安装系统，已完成；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-f5cbbc833729c93d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">三秒之内按任意键，选择启动系统选项菜单；</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-158043c240ac55bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">启动成功；</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        
        <tags>
            
            <tag> Centos6半自动化安装 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Centos6手动安装步骤]]></title>
      <url>/2018/01/08/Centos6%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/</url>
      <content type="html"><![CDATA[<p>一、安装Centos6.9</p>
<p>1、选择磁盘空间足够大的本地磁盘，新建ISO、Centos6.9文件夹。将Centos映像光盘拷贝到ISO文件夹里，开启VMware 新建虚拟机。</p>
<p>选择经典 → 稍后安装操作系统 → 选择Linux操作系统 → Centos 64位 → 修改虚拟机名称 →更改虚拟机保存路径安装到指定的位置 → 设置磁盘大小200GB → 将虚拟磁盘存储为单个文件 → 点击完成→虚拟机创建完成;</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-58ad8aea61bb2e5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-909b0432265fe9b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-42c8ce93a0788bd8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-8459601e2cba1334.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-07fb53e506f8ce2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>2、设置硬盘配置，安装操作系统。</p>
<p>（1）将硬件内存设置为2GB、处理器选择2个、网络适配器设置为仅主机模式、新建一个网络适配器设置为桥接模式。CD/DVD选择ISO文件夹中的Centos6文件、硬件设置完成。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-f44e4a1da252020d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p>（2）开启虚拟机安装Centos6操作系统</p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-38b2250611f6065f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2b167e59b7b041f3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-655e699ad4fd0389.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-7633180ca90ec6a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-023998b3bd9808ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-fa1ba8a57103525c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-5adc87529407683a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e5389a4518a48a21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-ba20d0e5b3799df7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e608df4e68ae3f16.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-1d4bc35f12c08b7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-d48829e6d7b47d15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-e4f9000dcea6d6e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-13d5e7d520f4d405.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2ca63d015e15b6de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-3e2eb7a3eecc6afb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-c07167098ef22f6d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-2aadf799b37109d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/6132998-6342f7400d2c1db6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p>
]]></content>
      
        
        <tags>
            
            <tag> Centos6手动安装步骤 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linux系统调优]]></title>
      <url>/2018/01/07/LINUX%E8%B0%83%E4%BC%98/</url>
      <content type="html"><![CDATA[<h3 id="linux系统调优"><a href="#linux系统调优" class="headerlink" title="linux系统调优"></a>linux系统调优</h3><hr>
<ul>
<li>进程调度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">os:</span><br><span class="line">硬件抽象，虚拟计算机</span><br><span class="line">system call---操作系统输出</span><br><span class="line">cpu：</span><br><span class="line">虚拟化，基于时序进行分段运行的，消耗时间片（time slice），</span><br><span class="line">某些进程优先级---打标签</span><br><span class="line">调度器：</span><br><span class="line">也是程序---内核中的进程调度子系统。</span><br><span class="line">调度器中的一种 CFS调度器</span><br><span class="line">调度器：Big O 算法</span><br><span class="line">O（1）从进程中选择一个进程所需要的时长时恒定的；调度进程，优先级。</span><br><span class="line">优先级分为两类：</span><br><span class="line">实时优先级--- 0-99</span><br><span class="line">静态优先级--- 100-139，用户可以手动指定nice值来调整优先级；</span><br><span class="line">Memory:内存</span><br><span class="line">虚拟地址空间</span><br><span class="line">PAE：</span><br><span class="line">32bits,4bits在32位的基础上加入4位变成现今的64G；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cpu调度</span><br><span class="line">0-139</span><br><span class="line">实时优先级；1-99---数值越大优先级越高</span><br><span class="line">动态优先级；100-139--数字越小优先级越高</span><br><span class="line"></span><br><span class="line">linux里调度器有多个不同的调度器；对于同一个进程由优先级较高的调度器进行调度；</span><br><span class="line">用户空间；调度器为CFS完全公平调度</span><br><span class="line">实时进程；调度器为SCHED_FIFO【0-99】</span><br><span class="line"></span><br><span class="line">类别；</span><br><span class="line">实时优先级调度；</span><br><span class="line">SCHED_FIFO ---调度器为先进先出 【0-99】---调度内核级别</span><br><span class="line">SCHED_RR ---轮询调度---同一种级别的进程有轮询的方式进行调度；</span><br><span class="line">用户空间调度；</span><br><span class="line">SCHED_NORMAL,SCHED_OTHER 【100-139】---完全公平调度</span><br><span class="line"></span><br><span class="line">cpu调度进行更改；</span><br><span class="line">动态优先级调度，用户空间调度；</span><br><span class="line">SCHED_FIFO,</span><br><span class="line">nice,renice</span><br><span class="line">实时优先级调度更改；</span><br><span class="line">SCHED_FIFO</span><br><span class="line"># chrt -f [1-99] /path/to/program arguments</span><br><span class="line">SCHED_RR;real-time</span><br><span class="line"># chrt -r [1-99] /path/to/program arguments</span><br></pre></td></tr></table></figure>
<ul>
<li>cpu绑定</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">strace 跟踪进程</span><br><span class="line"></span><br><span class="line">绑定cpu;</span><br><span class="line"># cat /proc/cpuinfo ---查看cpu个数类型</span><br><span class="line"># ps axo psr，comm ---显示哪个程序运在哪个CPU上，</span><br><span class="line"># ps axo psr,comm,pid---显示运行的进程及pid</span><br><span class="line">绑定qpidi进程的cpu</span><br><span class="line"># taskset -p -c 3  11215</span><br><span class="line"># ps axo psr，comm</span><br><span class="line">也可以绑定两个cpu</span><br><span class="line"># taskset -p -c 3,4  11215</span><br><span class="line"># ps axo psr，comm</span><br><span class="line"></span><br><span class="line">中断和IRQ调节，将cpu隔离出来专门记录中断信息；</span><br><span class="line">查看中断文件每个CPU的中断数；</span><br><span class="line"># cat /proc/interrupts--- cpu的io中断号</span><br><span class="line"># ls /proc/irp/---中断文件       </span><br><span class="line"># ls /proc/interrupts/0/---查看中断文件的中的绑定cpu的文件；</span><br><span class="line"># cat /proc/irp/0/smp_affinity</span><br><span class="line">ffffffff,ffffffff----一般情况下默认绑定格式；</span><br><span class="line"></span><br><span class="line">定义中断由第一个cpu处理绑定；</span><br><span class="line"># echo 1 &gt;/proc/irp/32/smp_affinity---定义32号中断由第一个CPU来处理</span><br><span class="line"># cat  /proc/irp/32/smp_affinity</span><br><span class="line">1</span><br><span class="line">要想将所有的中断号绑定在1号CPU需要脚本来实现；</span><br></pre></td></tr></table></figure>
<p>numa—服务实现自动绑定CPU;略<br>numa,numactl,numad<br>nice renlce 查文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">隔离CPU编辑配置文件；</span><br><span class="line">/etc/grub.conf</span><br><span class="line">内容尾部kernel后添加Isolcpus=cpu namber,cpu nameber (注意写上cpu的号码，0，1，2，3)</span><br><span class="line">定义中断smp_affinity；</span><br><span class="line"># echo cpunamber,...&gt;/proc/irp/#编号/smp_affinity/</span><br><span class="line">中断中使用的CPU是处Isolcpus外的CPU；</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">建议使用的监控工具CPU utilinzation;</span><br><span class="line">htop,dstat,glances,sar，sysdig(需要自己编译安装)</span><br><span class="line"># sar -p ALL 1 显示一秒钟所有使用率cpu</span><br><span class="line"># iostat -c 1 ---显示cpu的使用率；查看io状态命令，也可以查看cpu</span><br><span class="line"># uptime ---可以查看cpu使用率，平均负载情况；</span><br><span class="line"># vmstat 1 ----查看 procs运行队列和阻塞队列长度</span><br><span class="line">使用strace命令追踪进程查看所阻塞的进程；</span><br><span class="line">上述命令都是从/proc,/sys目录下剪切出来的，可以查看源文件；</span><br></pre></td></tr></table></figure>
<ul>
<li>linux 内存使用架构；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">linux所有共享库都在/lib64目录下；</span><br><span class="line">进程调用此目录下的代码；</span><br><span class="line">DMA:</span><br><span class="line">cpu跟外部设备IO设备进行交互的方式；</span><br><span class="line">poll:轮询，忙等待；</span><br><span class="line">中断:</span><br><span class="line">由DMA：自带芯片发送起请求到cpu</span><br><span class="line"></span><br><span class="line">与cup相关的工具；代码级时编译安装编写脚本；评估系统性能；</span><br><span class="line">systemtap,oprofile,valgrind</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">内存；</span><br><span class="line">1、大页面和透明大页面；</span><br><span class="line">内存时由块管理，即众所周知的页面，一个页面由4096字节。1MB内存等于256个页面。1GB内存等于256000个页面等等。CPU有内嵌的内存管理单元，这些的单元包含这些页面列表，每个页面都是用页面条目参考；</span><br><span class="line">让系统管理大量内存有两种方法；</span><br><span class="line">-增加内存管理单元中页表数；</span><br><span class="line">-增加页面大小；</span><br><span class="line"> 第一种方法很昂贵，因为现代处理器中的硬件内存管理单元只支持数百或者书签页表条目。另外适用于管理书签页面（MB内存）硬件和内存算法可能无法很好的管理数百万（甚至数十亿）页面。这会造成性能问题；但程序需要使用比内存管理单元支持的更多的页面，该系统同会退回到缓慢的给予软件的内存管理，从而造成整个系统缓慢运行。</span><br><span class="line"></span><br><span class="line"> 红帽企业版LINUX6采用第二种方法，即使用超大页面。</span><br><span class="line"> 简单说，超大页面是2MB和1GB大小的内存模块。2MB使用的页表可管理多GB内存，而1GB页是TB内存的最佳选择。</span><br><span class="line"></span><br><span class="line"> 超大页面必须引导时分配。他们也很难受懂管理，且经常需要更改代码以便可以有效使用。因此红帽企业版LInux也部署了透明超大页（THP）。THP是一个提取城，可自动创建，管理和使用超大页面的大多数方案；</span><br><span class="line"></span><br><span class="line"> 使用Valgtind简要描述内存使用；C编译成精通编写可以研究；</span><br><span class="line"></span><br><span class="line"> 其他工具；systemtap,oprofile，vagraind都需要写脚本，红帽官方有systemtap使用。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2、编译内核参数；</span><br><span class="line">    内存调优，proc文件系统的、proc/sys/vm目录中</span><br><span class="line">    （1）内存调优；memory过量使用，有三种类型；</span><br><span class="line">    overcommit_memory:有三种参数，分别为0,1,2 ；</span><br><span class="line">    0---默认设置。内核执行启发式内存过量使用处理，方法是估算可用内存量，并拒绝明显的无效的请求。遗憾的是因为存是使用启发式而非准确算法进行部署，这个设置有时可能会赵成系统中的可用内存超载。</span><br><span class="line">    1---内核执行无内存过量使用处理，使用之歌设置会增大内存超载的可能性，但也可以增强大量使用内存任务的性能。</span><br><span class="line">    2---内存拒绝等于或者大于总可用swap大小及overcommit_ratio指定的物理RAM比例的内存请求。如果您希望减小内存过度使用的风险，这个设置就是最好的；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    2---模式中的overcommit_ratio为比例参数；</span><br><span class="line">    内存模式为，swap+RAM*overcommit_ratio磁盘使用大小；</span><br><span class="line">    已条有目的的话使用1模式，2模式将不在考虑范围；</span><br><span class="line"></span><br><span class="line">    配置文件；vim /etc/sysctl.conf当中尾部添加</span><br><span class="line">    vm.overcommit_memory = 1</span><br><span class="line">    保存以后使用sysctl -p命令执行；</span><br><span class="line">     (2)nr_hugepages大内存页；</span><br><span class="line">     规定在内存中配置的超大页数。默认为0。只有系统中有足够的连续可用页时方可分配（或者取消分配）超大页。为这个参数保留的页无法用于其他目的。安装文件</span><br><span class="line">     /usr/share/doc/kernel-doc-kernel_version/Documentation/vm/hugetlbpage.txt</span><br><span class="line"></span><br><span class="line">    查看大内存页使用情况；cat /proc/meminfo</span><br><span class="line">     AnonHugepages   110592 ---有内核自动使用维护的；透明匿名的大内存页；</span><br><span class="line">     Hugepages_Total 0   大内存页使用情况为没有使用</span><br><span class="line">     Hugepages_Free  0   </span><br><span class="line">     Hugepages_Rsvd  0</span><br><span class="line">     Hugepages_Surp  0</span><br><span class="line">     Hugepagesize    2048 大内存页的大小为两兆MB</span><br><span class="line"></span><br><span class="line">     配置大内存页；vim /etc/sysctl.conf当中尾部添加</span><br><span class="line">     vm.nr_hugepages = 10 ---添加10个内存页；</span><br><span class="line">     # sysctl -p ---运行一下</span><br><span class="line">     # cat /proc/meminfo ---查看内存页使用情况</span><br><span class="line"></span><br><span class="line">     也可以使用大内存页使用基于内存的文件系统；</span><br><span class="line">     将大内存页进行挂在文件系统实现；</span><br><span class="line">```     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 于容量相关的内核可调参数；</span><br></pre></td></tr></table></figure>
<p>位于参数proc文件系统中/proc/sys/kernel/目录中；<br>msgmax —消息队列；单个消息的大小。<br> -一字节为单规定消息队列中任意信息的最大允许大小。这个值一定不能超过该队列的大小（msgmnb）.默认值为65536字节；<br>msgmnb<br> -以字节为单位规定单一信息队列的最大值。默认为65536字节；<br>msgmni<br> -规定信息队列识别符的最大数量（以及队列的最大数量）。64位架构机器的默认值为1985；32位架机器的默认值为1736.</p>
<p>shmall —共享内存<br>  -字节位单位规定一次在该系统中可使用的共享内存总量。64位架构机器的默认值为4294967296；32位架构机器的默认值为268435456.<br>shmmax<br>  -以字节为单位规定内核可允许的最大共享内存片。64位架构机器的默认值为68719476736；32位架构机器的默认值为4294967295.注：单内核支持的值比这个值要多得多。<br>shmmni<br>  -规定系统范围内最大共享内存片段。在63位和32位架构机器中的默认值都是4096。<br>threads-max<br>  -规定一次内核使用的最大线程（任务）数。默认值与max_threads相同。使用的方程式是；<br>  max_threads=mempages / (8 * THREAD_SIZE / PAGE_SIZE)<br>  threads-max的最小值为20.</p>
<p>  shmmni * shmall =shmmax 多少片乘上片的大小等于总数大小；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-与容量相关的文件系统可调参数；</span><br></pre></td></tr></table></figure></p>
<p>已下可调参数位于proc文件系统的/proc/sys/fs/目录中。<br>aio-max-nr<br> -规定在所有活动异步I/O上下文中可允许的最多事件数。默认值为65536。注：更改这个值不会预先分配或者重新定义内核数据结构的大小。</p>
<p> 使用nginx异步io时根据需求可以调大，消耗内存较大；</p>
<p> file-max<br>  -列出内核分配的文件数量的最大值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- Out-of-Memory kill 可调用参数；</span><br></pre></td></tr></table></figure>
<p>  -内存不足（OOM）指的时所有可用内存，包括swap空间都已经被分配的计算状态。默认情况下，这个状态可赵成系统panic,并停止如预期般工作。当/proc/sys/vm/panic_on_oom参数设定为0会让内核在出现OOM时调用oom_killer功能。通常oom_killer可杀死偷盗进程，并让系统正常运行；</p>
<p>  可在每一个进程中设定一下参数，提高您对被oom_killer功能杀死的进程进行的控制。它位于proc文件系统中/proc/pid/目录下，其中pid是进程id.</p>
<p>  oom_adj<br>   -定义-16到15之间的一个数值以便帮助决定某进程的oom_score。oom_score值越高，被oom_killer杀死的进程数就越多。将oom_adj值设定为-17则为该进程禁用oom_killer。</p>
<pre><code>？写脚本获取id号进行赋值，或者手动执行；

 当内存耗尽时系统将消耗最大的进程kill掉。
</code></pre> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 调整虚拟内存</span><br><span class="line">虚拟内存</span><br></pre></td></tr></table></figure>
<p>```</p>
]]></content>
      
        
        <tags>
            
            <tag> Linux系统调优 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2018/01/07/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
      
        
    </entry>
    
  
  
</search>
